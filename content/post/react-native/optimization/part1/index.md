---
author: Bokmark Ma
title: "ã€ŠReact Native ä¼˜åŒ–ç»ˆææŒ‡å—ã€‹- React Native ä¼˜åŒ– ç¬¬ä¸€éƒ¨åˆ†"
date: 2025-01-21
slug: react-native/optimization/part1
description: æ€§èƒ½ä¼˜åŒ–
categories:
  - React Native
tags:
  - æ€§èƒ½ä¼˜åŒ–
  - React Native
  - ã€ŠReact Native ä¼˜åŒ–ç»ˆææŒ‡å—ã€‹
---

> [ã€ŠReact Native ä¼˜åŒ–ç»ˆææŒ‡å—ã€‹](https://5711799.fs1.hubspotusercontent-na1.net/hubfs/5711799/The%20Ultimate%20Guide%20to%20React%20Native%20Optimization%202024%20Edition.pdf)

# React Native ä¼˜åŒ–ç®€ä»‹

## ä¸€åˆ‡éƒ½å›´ç»•ç€ TTI å’Œ FPSï¼Ÿ

ç­‰ç­‰ï¼Œè¿™äº›å¥‡æ€ªçš„ç¼©å†™åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿï¼åœ¨è€ƒè™‘ä¼˜åŒ–ç§»åŠ¨ç«¯ React Native åº”ç”¨æ—¶ï¼Œé™¤äº†ä»·å€¼ä¸»å¼ å’Œç”¨æˆ·å‚ä¸åº¦ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ‰¿è®¤ä¸¤ä¸ªæœ€é‡è¦çš„æŒ‡æ ‡â€”â€”ç”¨æˆ·åˆ¤æ–­æˆ‘ä»¬çš„åº”ç”¨æ˜¯å¦å¿«é€Ÿæµç•…çš„ä¾æ®â€”â€”åˆ†åˆ«æ˜¯äº¤äº’æ—¶é—´ï¼ˆTTIï¼ŒTime To Interactiveï¼‰å’Œæ¯ç§’å¸§æ•°ï¼ˆFPSï¼ŒFrames Per Secondï¼‰ã€‚

> å‰è€…ï¼ˆTTIï¼‰è¡¡é‡çš„æ˜¯ç”¨æˆ·å¤šå¿«å¯ä»¥å¼€å§‹ä½¿ç”¨ï¼ˆæˆ–ä¸ï¼‰æ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œä¸»è¦å…³æ³¨å¯åŠ¨æ—¶çš„æ€§èƒ½ã€‚æ‰“å¼€ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºåº”è¯¥æ˜¯å¿«é€Ÿçš„ï¼Œè¿™æ¯«æ— ç–‘é—®ã€‚è€Œåè€…ï¼ˆFPSï¼‰åˆ™è¡¡é‡çš„æ˜¯åº”ç”¨ç¨‹åºç•Œé¢å¯¹ç”¨æˆ·äº¤äº’çš„å“åº”é€Ÿåº¦ï¼Œä¸»è¦å…³æ³¨è¿è¡Œæ—¶çš„æ€§èƒ½ã€‚ä½¿ç”¨åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹åº”è¯¥åƒéª‘è‡ªè¡Œè½¦ä¸€æ ·æµç•…â€”â€”é™¤éæ‚¨å¼€å¯äº†çœç”µæ¨¡å¼ã€‚ä¼˜ç§€çš„åº”ç”¨ç¨‹åºå°†å“è¶Šçš„å¯åŠ¨æ€§èƒ½å’Œè¿è¡Œæ€§èƒ½ç»“åˆèµ·æ¥ï¼Œä¸ºç”¨æˆ·æä¾›æœ€ä½³çš„ç«¯åˆ°ç«¯ä½“éªŒã€‚

> æœ¬æŒ‡å—ä¸­çš„å‡ ä¹æ¯æ¡å»ºè®®éƒ½å°†ç›´æ¥æˆ–é—´æ¥å½±å“è¿™ä¸¤ä¸ªæŒ‡æ ‡ã€‚è€Œç”±äº React Native ä¸ºæˆ‘ä»¬æä¾›äº†æ„å»ºåŸç”Ÿ Android å’Œ iOS åº”ç”¨çš„å·¥å…·ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸ŠåŠ å…¥äº†ä¸€äº› JavaScriptï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æœ‰è®¸å¤šæœºä¼šå¯ä»¥ä»ä¸åŒè§’åº¦å½±å“è¿™äº›æŒ‡æ ‡ï¼

> å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†ç¹é‡çš„å·¥ä½œå·²ç»åœ¨æ¡†æ¶å±‚é¢ä¸ºæˆ‘ä»¬å®Œæˆäº†ï¼Œå› æ­¤ä»»ä½• React Native å¼€å‘è€…éƒ½å¯ä»¥ä»ä¸€ä¸ªè‰¯å¥½çš„æ€§èƒ½åŸºçº¿å¼€å§‹ã€‚ç„¶è€Œï¼Œéšç€æ‚¨çš„åº”ç”¨å˜å¾—è¶Šå¤æ‚ï¼Œè¦ç»´æŒå¥åº·çš„ TTI å’Œ FPS åŸºçº¿æ€§èƒ½å¯èƒ½ä¼šå˜å¾—è¶Šå…·æŒ‘æˆ˜æ€§ã€‚

> å¦ç™½è¯´ï¼Œä¼˜åŒ–å¹¶ä¸åªæ˜¯å›´ç»•è¿™ä¸¤ä¸ªæŒ‡æ ‡ã€‚æ¯•ç«Ÿï¼Œå¦‚æœæ‚¨çš„åº”ç”¨åœ¨è¿è¡Œæ—¶å´©æºƒï¼Œæ‚¨è¿˜èƒ½æµ‹é‡äº¤äº’è¿‡ç¨‹ä¸­çš„ FPS å—ï¼Ÿä¼˜åŒ–æ˜¯ä¸€ä¸ªå¤æ‚ä¸”æŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦åœ¨å¤šä¸ªå±‚é¢ä¸æ–­è¿›è¡Œï¼Œæ‰èƒ½è®©äº§å“å–å¾—æˆåŠŸã€‚éšç€æ‚¨æ·±å…¥é˜…è¯»æœ¬æŒ‡å—ï¼Œæ‚¨å°†æ›´æ¸…æ¥šåœ°äº†è§£å“ªäº›å› ç´ ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€å“ªäº›å› ç´ å¯¹æä¾›å’Œæ„ŸçŸ¥æ›´å¥½çš„æ€§èƒ½è‡³å…³é‡è¦ã€ä¸ºä»€ä¹ˆé‡è¦ï¼Œä»¥åŠå¦‚ä½•è§£å†³é˜»ç¢ç”¨æˆ·åœ¨ä½¿ç”¨æ‚¨çš„ React Native åº”ç”¨æ—¶äº«å—æœ€ä½³ä½“éªŒçš„å„ç§æŒ‘æˆ˜ã€‚

### React Native è´Ÿè´£æ¸²æŸ“ï¼Œä½†æ€§èƒ½ä»æ˜¯å…³é”®ã€‚

ä½¿ç”¨ React Nativeï¼Œæ‚¨å¯ä»¥åˆ›å»ºç»„ä»¶æ¥æè¿°ç•Œé¢çš„å¤–è§‚ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒReact Native ä¼šå°†è¿™äº›ç»„ä»¶è½¬æ¢ä¸ºå¹³å°ç‰¹å®šçš„åŸç”Ÿç»„ä»¶ã€‚ä¸å…¶ç›´æ¥ä¸åº•å±‚ API å¯¹è¯ï¼Œæ‚¨æ›´å…³æ³¨çš„æ˜¯åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚

ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ‰€æœ‰ä½¿ç”¨ React Native å¼€å‘çš„åº”ç”¨ç¨‹åºéƒ½åŒæ ·å¿«é€Ÿï¼Œæˆ–è€…èƒ½å¤Ÿæä¾›ç›¸åŒæ°´å¹³çš„ç”¨æˆ·ä½“éªŒã€‚

#### æ¯ç§å£°æ˜å¼æ–¹æ³•ï¼ˆåŒ…æ‹¬ React Nativeï¼‰éƒ½å»ºç«‹åœ¨å‘½ä»¤å¼ API ä¹‹ä¸Šï¼Œè¿™éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚

å½“æ‚¨ä»¥å‘½ä»¤å¼æ–¹å¼æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨ä¼šä»”ç»†åˆ†ææ¯ä¸ªå¯¹å¤–éƒ¨ API çš„è°ƒç”¨ç‚¹ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ç¼–å†™ä»£ç æ—¶ï¼Œæ‚¨ä¼šåœ¨ç‰¹å®šçº¿ç¨‹ä¸­å®‰å…¨åœ°ç¼–å†™ä»£ç ï¼ŒåŒæ—¶æ¸…æ¥šåœ°äº†è§£ä»£ç è¿è¡Œçš„ä¸Šä¸‹æ–‡ä»¥åŠå…¶éœ€è¦çš„èµ„æºã€‚

å°½ç®¡å£°æ˜å¼å’Œå‘½ä»¤å¼æ–¹æ³•åœ¨å®ç°æ–¹å¼ä¸Šå­˜åœ¨è¯¸å¤šå·®å¼‚ï¼Œä½†å®ƒä»¬ä¹‹é—´ä¹Ÿæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ã€‚æ¯ä¸ªå£°æ˜å¼çš„æŠ½è±¡éƒ½å¯ä»¥è¢«åˆ†è§£ä¸ºè‹¥å¹²å‘½ä»¤å¼çš„è°ƒç”¨ã€‚ä¾‹å¦‚ï¼ŒReact Native åœ¨ iOS ä¸Šæ¸²æŸ“åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨çš„ APIï¼Œä¸åŸç”Ÿå¼€å‘è€…è‡ªå·±ä½¿ç”¨çš„ API æ˜¯ç›¸åŒçš„ã€‚

#### React Native ç»Ÿä¸€äº†æ€§èƒ½ï¼Œä½†å¹¶ä¸ä¿è¯æ€§èƒ½æ— å¿§ï¼

è™½ç„¶æ‚¨æ— éœ€æ‹…å¿ƒåº•å±‚ iOS å’Œ Android API è°ƒç”¨çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ‚¨å¦‚ä½•ç»„åˆç»„ä»¶å´å¯èƒ½äº§ç”Ÿå·¨å¤§çš„å½±å“ã€‚æ‚¨æ‰€æœ‰çš„ç»„ä»¶éƒ½ä¼šæä¾›ç›¸åŒæ°´å¹³çš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚

#### ä½†â€œç›¸åŒâ€æ˜¯å¦ç­‰äºâ€œæœ€ä½³â€ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚

è¿™å°±æ˜¯æˆ‘ä»¬çš„æ¸…å•å‘æŒ¥ä½œç”¨çš„æ—¶å€™ã€‚å……åˆ†åˆ©ç”¨ React Native çš„æ½œåŠ›ã€‚å¦‚å‰æ‰€è¿°ï¼ŒReact Native æ˜¯ä¸€ä¸ªå£°æ˜å¼æ¡†æ¶ï¼Œè´Ÿè´£ä¸ºæ‚¨æ¸²æŸ“åº”ç”¨ç¨‹åºã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨æ— éœ€æŒ‡å®šåº”ç”¨ç¨‹åºçš„æ¸²æŸ“æ–¹å¼ã€‚

æ‚¨çš„ä»»åŠ¡æ˜¯å®šä¹‰ UI ç»„ä»¶ï¼Œå…¶ä»–çš„äº¤ç»™æ¡†æ¶å¤„ç†ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ‚¨å¯ä»¥ç†æ‰€å½“ç„¶åœ°å¿½ç•¥åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚ä¸ºäº†åˆ›å»ºå¿«é€Ÿä¸”å“åº”è¿…é€Ÿçš„åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦ä»¥ React Native çš„æ–¹å¼æ€è€ƒã€‚æ‚¨å¿…é¡»äº†è§£æ¡†æ¶å¦‚ä½•ä¸åº•å±‚å¹³å° API è¿›è¡Œäº¤äº’ã€‚

#### å¦‚æœæ‚¨éœ€è¦åœ¨æ€§èƒ½ã€ç¨³å®šæ€§ã€ç”¨æˆ·ä½“éªŒæˆ–å…¶ä»–å¤æ‚é—®é¢˜ä¸Šè·å¾—å¸®åŠ©ï¼Œè¯·è”ç³»æˆ‘ä»¬ï¼

ä½œä¸º React Native æ ¸å¿ƒè´¡çŒ®è€…å’Œç¤¾åŒºé¢†è¢–ï¼Œæˆ‘ä»¬å°†å¾ˆä¹æ„ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚

## ç¬¬ä¸€ç«  é€šè¿‡äº†è§£ React Native çš„å®ç°ç»†èŠ‚æ¥æå‡æ€§èƒ½ã€‚

> åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨æœ€å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯¼è‡´è¿™äº›é—®é¢˜çš„ React Native å®ç°ç»†èŠ‚ã€‚è¿™ä¸ä»…æ˜¯å¯¹ä¸€äº›é«˜çº§ React Native æ¦‚å¿µçš„å¹³æ»‘å¼•å…¥ï¼Œè¿˜å°†é€šè¿‡ä¸€äº›å°çš„è°ƒæ•´å’Œæ›´æ”¹ï¼Œè®©æ‚¨æå‡åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚

> æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°†èšç„¦äºæ€§èƒ½ä¼˜åŒ–ç­–ç•¥æ¸…å•ä¸­çš„ç¬¬ä¸€ä¸ªè¦ç‚¹ï¼šUI çš„é‡æ–°æ¸²æŸ“ã€‚è¿™æ˜¯ React Native ä¼˜åŒ–è¿‡ç¨‹ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘è®¾å¤‡çš„ç”µé‡æ¶ˆè€—ï¼Œä»è€Œæå‡æ‚¨çš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚

### ç¬¬ä¸€èŠ‚ æ³¨æ„ UI çš„é‡æ–°æ¸²æŸ“

> ä¼˜åŒ–çŠ¶æ€æ“ä½œçš„æ¬¡æ•°ï¼Œå¹¶ä½¿ç”¨è®°å¿†åŒ–ç»„ä»¶ï¼Œè®©æ‚¨çš„åº”ç”¨ä»¥æ›´å°‘çš„èµ„æºè¿è¡Œå¾—æ›´å¿«ã€‚

#### é—®é¢˜ï¼šçŠ¶æ€æ›´æ–°ä¸æ­£ç¡®å¯¼è‡´å¤šä½™çš„æ¸²æŸ“å‘¨æœŸï¼Œæˆ–è€…è®¾å¤‡æœ¬èº«æ€§èƒ½ä¸è¶³ã€‚

å¦‚å‰æ‰€è¿°ï¼ŒReact Native ä¼šä¸ºæ‚¨å¤„ç†åº”ç”¨ç¨‹åºçš„æ¸²æŸ“ã€‚æ‚¨åªéœ€è¦å®šä¹‰æ‰€éœ€çš„æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶é€šè¿‡è¿™äº›è¾ƒå°çš„æ„å»ºå—ç»„åˆæˆæœ€ç»ˆçš„ç•Œé¢ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ‚¨æ— æ³•æ§åˆ¶åº”ç”¨ç¨‹åºçš„æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸã€‚

æ¢å¥è¯è¯´ï¼Œå±å¹•ä¸Šçš„å†…å®¹ä½•æ—¶ä»¥åŠå¦‚ä½•é‡ç»˜å®Œå…¨æ˜¯ React Native çš„è´£ä»»ã€‚React ä¼šç›‘æµ‹æ‚¨å¯¹ç»„ä»¶æ‰€åšçš„æ›´æ”¹ï¼Œè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æŒ‰ç…§è®¾è®¡ä»…æ‰§è¡Œå¿…è¦çš„ã€æœ€å°‘é‡çš„å®é™…æ›´æ–°ã€‚

![react native å¦‚ä½•æ›´æ–° dom](opt1-vm.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æˆ–ä¼ å…¥çš„ props å‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶å¯èƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚è¿™æ„å‘³ç€å³ä½¿ç»„ä»¶çš„ props æœªå‘ç”Ÿæ”¹å˜ï¼Œå…¶ render æ–¹æ³•æœ‰æ—¶ä»ç„¶ä¼šè¿è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥æ¥å—çš„æƒè¡¡ï¼Œå› ä¸ºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼ˆä¹‹å‰çš„ props å’Œå½“å‰çš„ propsï¼‰å¯èƒ½ä¼šèŠ±è´¹æ›´å¤šæ—¶é—´ã€‚

##### å¯¹æ€§èƒ½çš„è´Ÿé¢å½±å“ã€ç•Œé¢é—ªçƒä»¥åŠ FPS çš„ä¸‹é™

è™½ç„¶ä¸Šè¿°å¯å‘å¼è§„åˆ™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æ­£ç¡®çš„ï¼Œä½†æ‰§è¡Œè¿‡å¤šçš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä½ç«¯ç§»åŠ¨è®¾å¤‡ä¸Šã€‚

å› æ­¤ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ç•Œé¢å‡ºç°é—ªçƒï¼ˆæ›´æ–°å‘ç”Ÿæ—¶ï¼‰æˆ–å¸§ç‡ä¸‹é™ï¼ˆåŠ¨ç”»è¿›è¡Œä¸­åŒæ—¶å‘ç”Ÿæ›´æ–°ï¼‰ã€‚

> æ³¨æ„ï¼šè¿‡æ—©è¿›è¡Œä¼˜åŒ–å¯èƒ½ä¼šäº§ç”Ÿé€‚å¾—å…¶åçš„æ•ˆæœã€‚ä¸€æ—¦åœ¨åº”ç”¨ä¸­å‘ç°æ‰å¸§æˆ–æ€§èƒ½ä¸ä½³çš„é—®é¢˜ï¼Œåº”ç«‹å³å¼€å§‹ç€æ‰‹è§£å†³è¿™äº›æ€§èƒ½é—®é¢˜ã€‚

ä¸€æ—¦æ‚¨å‘ç°è¿™äº›ç—‡çŠ¶ï¼Œå°±åº”è¯¥æ·±å…¥æ£€æŸ¥æ‚¨çš„åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸï¼Œå¯»æ‰¾é‚£äº›ä¸å¿…è¦çš„ã€æ„æ–™ä¹‹å¤–çš„æ“ä½œã€‚

##### æˆ‘ä»¬å¦‚ä½•çŸ¥é“è¯¥ä¼˜åŒ–ä»€ä¹ˆï¼Ÿ

åœ¨è¿›è¡Œæ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åŸºäºæ•°æ®åšå‡ºå†³ç­–ã€‚è¿™äº›æ•°æ®æ¥æºäºä½¿ç”¨ä¸“ä¸šå·¥å…·æµ‹é‡æ€§èƒ½çš„è¿‡ç¨‹ï¼Œè¿™é€šå¸¸è¢«ç§°ä¸ºæ€§èƒ½åˆ†æï¼ˆprofilingï¼‰ã€‚æœ‰è®¸å¤šå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹ React Native åº”ç”¨è¿›è¡Œæ€§èƒ½åˆ†æï¼Œä¾‹å¦‚ï¼š[react-devtools](https://www.npmjs.com/package/react-devtools)ã€[why-did-you-render](https://legacy.reactjs.org/docs/profiler.html)ã€[Profiler](https://legacy.reactjs.org/docs/profiler.html) ç­‰ã€‚

åœ¨æœ¬æ¬¡ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Flipperï¼Œä¸€ä¸ªç”¨äºè°ƒè¯• iOSã€Android å’Œ React Native åº”ç”¨çš„å¹³å°ã€‚Flipper é›†æˆäº† React DevTools Profiler ä½œä¸ºæ’ä»¶ï¼Œèƒ½å¤Ÿé€šè¿‡æ€§èƒ½åˆ†æç”Ÿæˆ React æ¸²æŸ“ç®¡é“çš„ç«ç„°å›¾ï¼ˆflame graphï¼‰ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›æ•°æ®æ¥åˆ†æåº”ç”¨ç¨‹åºä¸­çš„é‡æ–°æ¸²æŸ“é—®é¢˜ã€‚ä¸‹è½½ Flipper åï¼Œé€‰æ‹© React DevToolsï¼š

![flipper](flipper.png)

è¿™æ˜¯æˆ‘ä»¬å…³äºæ€§èƒ½åˆ†æçš„ä»£ç 

```js
import React, { useEffect, useState } from 'react';
import { View } from 'react-native';
const App = () => {
    const [value, setValue] = useState('');
    const backgroundStyle = {
        backgroundColor: '#fff',
        flex: 1,
        marginTop: 80,
    };
    useEffect(() => {
        setTimeout(() => {
            setValue('update 1');
        }, 3000);
        setTimeout(() => {
            setValue('update 2');
        }, 5000);
    }, []);
    return (
        <View style={backgroundStyle}>
            <ColoredView />
        </View>
    );
};
const ColoredView = () => {
    const style = { backgroundColor: 'red', padding: 10 };
    return <View style={style} />;
};
export default App;
```
åœ¨ Flipper åº”ç”¨ä¸­ï¼Œç¡®ä¿åœ¨è®¾ç½®å›¾æ ‡ä¸­å¯ç”¨äº†â€œè®°å½•æ¯ä¸ªç»„ä»¶æ¸²æŸ“çš„åŸå› ï¼ˆRecord why each component rendered while profilingï¼‰â€é€‰é¡¹ï¼Œç„¶åç‚¹å‡»è“è‰²åœ†å½¢æŒ‰é’®å¼€å§‹æ€§èƒ½åˆ†æã€‚å¤§çº¦ 5 ç§’åï¼Œç‚¹å‡»çº¢è‰²åœ†å½¢æŒ‰é’®åœæ­¢æ€§èƒ½åˆ†æã€‚æ‚¨çš„æ€§èƒ½åˆ†æç»“æœå¯èƒ½ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š

![profiling](flipper-profiling.png)

è¿™ä¸ªæ€§èƒ½åˆ†æç»“æœæ˜¾ç¤ºäº†æŸä¸ªç»„ä»¶æ¸²æŸ“æ‰€èŠ±è´¹çš„æ—¶é—´ã€æ¸²æŸ“çš„æ¬¡æ•°ä»¥åŠå¯¼è‡´æ¸²æŸ“çš„åŸå› ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ`ColoredView` è¢«æ¸²æŸ“äº†ä¸¤æ¬¡ï¼ŒåŸå› æ˜¯å…¶çˆ¶ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“ã€‚è¿™å¯èƒ½æç¤ºæˆ‘ä»¬ï¼Œä¸ `ColoredView` ç›¸å…³çš„ä»£ç å­˜åœ¨æ„å¤–çš„æ€§èƒ½å½±å“ã€‚åŸºäºè¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ€§åœ°åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œä»¥é¿å…é¢å¤–çš„é‡æ–°æ¸²æŸ“ã€‚

ç¬¬ä¸€æ¬¡æŸ¥çœ‹æ€§èƒ½ç«ç„°å›¾å¯èƒ½ä¼šè®©äººæ„Ÿåˆ°æœ‰äº›å›°æƒ‘ã€‚ä¸ºäº†æ›´æ·±å…¥åœ°ç†è§£ React DevToolsï¼Œå¯ä»¥è§‚çœ‹ Ben Awad çš„ç›¸å…³[è§†é¢‘](https://www.youtube.com/watch?v=00RoZflFE34&ab_channel=BenAwad)ï¼Œä»–å¯¹è¿™ä¸€å·¥å…·æœ‰è¯¦ç»†çš„è®²è§£ã€‚æ­¤å¤–ï¼Œä¸è¦é”™è¿‡ React Native EU ä¸Š Alex çš„[æ¼”è®²](https://www.react-native.eu/talks/alexandre-moureaux-performance-issues-the-usual-suspects)ï¼Œè¯¥æ¼”è®²è¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ç«ç„°å›¾è¯†åˆ«å’Œè§£å†³é—®é¢˜ã€‚æ‚¨è¿˜å¯ä»¥è®¿é—® React å®˜æ–¹ç½‘ç«™ï¼Œäº†è§£æœ‰å…³ [React Profiler](https://legacy.reactjs.org/blog/2018/09/10/introducing-the-react-profiler.html) çš„è¯¦ç»†ä¿¡æ¯ã€‚

#### è§£å†³æ–¹æ¡ˆï¼šä¼˜åŒ–çŠ¶æ€æ“ä½œçš„æ¬¡æ•°ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä½¿ç”¨è®°å¿†åŒ–ç»„ä»¶ï¼ˆMemoized Componentsï¼‰ã€‚

åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå› ä¸ºå¤šç§åŸå› é™·å…¥ä¸å¿…è¦çš„æ¸²æŸ“å¾ªç¯ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªå€¼å¾—å•ç‹¬æ¢è®¨çš„è¯é¢˜ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºä¸¤ç§å¸¸è§åœºæ™¯â€”â€”ä½¿ç”¨å—æ§ç»„ä»¶ï¼ˆå¦‚ TextInputï¼‰å’Œå…¨å±€çŠ¶æ€ã€‚

##### å—æ§ç»„ä»¶ä¸éå—æ§ç»„ä»¶

è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªåœºæ™¯å¼€å§‹ã€‚å‡ ä¹æ¯ä¸ª React Native åº”ç”¨éƒ½åŒ…å«è‡³å°‘ä¸€ä¸ªç”±ç»„ä»¶çŠ¶æ€æ§åˆ¶çš„ TextInputï¼Œå¦‚ä¸‹ä»£ç ç‰‡æ®µæ‰€ç¤ºï¼š

```javascript
import React, { useState } from 'react';
import { TextInput, StyleSheet } from 'react-native';
const UselessTextInput = () => {
    const [value, setValue] = useState('Text');
    const onChangeText = (text) => {
        setValue(text);
    };
    return (
        <TextInput
            accessibilityLabel=''Text input field''
            style={styles.textInput}
            onChangeText={onChangeText}
            value={value}
        />
    );
};
const styles = StyleSheet.create({
    textInput: {
    height: 40,
    borderColor: 'gray',
    borderWidth: 1,
    },
});
export default UselessTextInput;
```
> [ä»£ç å‡ºå¤„](https://snack.expo.dev/@callstack-snack/textinput-example)

ä¸Šè¿°ä»£ç ç‰‡æ®µåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ç„¶è€Œï¼Œåœ¨æ€§èƒ½è¾ƒä½çš„è®¾å¤‡ä¸Šï¼Œæˆ–è€…å½“ç”¨æˆ·è¾“å…¥é€Ÿåº¦éå¸¸å¿«æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´è§†å›¾æ›´æ–°å‡ºç°é—®é¢˜ã€‚

è¿™ä¸ªé—®é¢˜æ˜¯ç”± React Native çš„å¼‚æ­¥ç‰¹æ€§å¼•èµ·çš„ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å…¶ä¸­çš„åŸå› ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ç”¨æˆ·åœ¨è¾“å…¥å¹¶å‘ `<TextInput />` ä¸­å¡«å…¥æ–°å­—ç¬¦æ—¶å‘ç”Ÿçš„æ ‡å‡†æ“ä½œé¡ºåºï¼š

![ç”¨æˆ·åœ¨ TextInput ä¸­è¾“å…¥ â€œTESTâ€ æ—¶çš„æ“ä½œæµç¨‹å›¾](inputtest.png)

å½“ç”¨æˆ·å¼€å§‹åœ¨åŸç”Ÿè¾“å…¥æ¡†ä¸­è¾“å…¥æ–°å­—ç¬¦æ—¶ï¼Œä¼šé€šè¿‡ onChangeText å±æ€§å‘ React Native å‘é€ä¸€ä¸ªæ›´æ–°ï¼ˆä¸Šè¿°æµç¨‹å›¾ä¸­çš„æ“ä½œ 1ï¼‰ã€‚React å¤„ç†è¯¥ä¿¡æ¯ï¼Œå¹¶é€šè¿‡è°ƒç”¨ setState ç›¸åº”åœ°æ›´æ–°å…¶çŠ¶æ€ã€‚æ¥ä¸‹æ¥ï¼Œå—æ§ç»„ä»¶ä¼šå°†å…¶ JavaScript çš„å€¼ä¸åŸç”Ÿç»„ä»¶çš„å€¼åŒæ­¥ï¼ˆä¸Šè¿°æµç¨‹å›¾ä¸­çš„æ“ä½œ 2ï¼‰ã€‚

è¿™ç§æ–¹æ³•æœ‰å…¶ä¼˜åŠ¿ã€‚React ä½œä¸ºæ•°æ®çš„å”¯ä¸€æ¥æºï¼Œæ§åˆ¶äº†è¾“å…¥æ¡†çš„å€¼ã€‚è¿™ç§æŠ€æœ¯å¯ä»¥è®©æ‚¨åœ¨ç”¨æˆ·è¾“å…¥æ—¶åŠ¨æ€ä¿®æ”¹è¾“å…¥å†…å®¹ï¼Œä¾‹å¦‚è¿›è¡ŒéªŒè¯ã€æ·»åŠ æ©ç ï¼Œç”šè‡³å®Œå…¨æ›´æ”¹è¾“å…¥å†…å®¹ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œä¸Šè¿°æ–¹æ³•è™½ç„¶æ›´åŠ ç®€æ´ä¸”ç¬¦åˆ React çš„å·¥ä½œæ–¹å¼ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼Œå°¤å…¶æ˜¯åœ¨èµ„æºæœ‰é™æˆ–ç”¨æˆ·è¾“å…¥é€Ÿåº¦éå¸¸å¿«çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—®é¢˜ä¼šå˜å¾—å°¤ä¸ºæ˜æ˜¾ã€‚

![ç”¨æˆ·åœ¨ TextInput ä¸­è¾“å…¥ â€œTESTâ€ æ—¶çš„æ“ä½œæµç¨‹å›¾](inputtest2.png)

å½“é€šè¿‡ `onChangeText` çš„æ›´æ–°åœ¨ React Native å°†æ¯æ¬¡æ›´æ–°åŒæ­¥å›ç•Œé¢ä¹‹å‰åˆ°è¾¾æ—¶ï¼Œç•Œé¢ä¼šå¼€å§‹å‡ºç°é—ªçƒã€‚ç”¨æˆ·è¾“å…¥ T æ—¶ï¼Œç¬¬ä¸€æ¬¡æ›´æ–°ï¼ˆæ“ä½œ 1 å’Œæ“ä½œ 2ï¼‰å¯ä»¥é¡ºåˆ©å®Œæˆï¼Œæ²¡æœ‰é—®é¢˜ã€‚

æ¥ä¸‹æ¥ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 åˆ°è¾¾ï¼Œç”¨æˆ·åœ¨ React Native å¿™äºå…¶ä»–ä»»åŠ¡æ—¶è¾“å…¥äº† E å’Œ Sï¼Œå¯¼è‡´å­—æ¯ E çš„åŒæ­¥ï¼ˆæ“ä½œ 5ï¼‰è¢«å»¶è¿Ÿã€‚ç»“æœï¼ŒåŸç”Ÿè¾“å…¥æ¡†çš„å€¼ä¼šæš‚æ—¶ä» TES æ¢å¤åˆ° TEï¼Œå‡ºç°çŸ­æš‚çš„å›é€€ç°è±¡ã€‚

æ­¤æ—¶ï¼Œç”¨æˆ·è¾“å…¥é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œåœ¨è¾“å…¥æ¡†çš„å€¼çŸ­æš‚å›é€€ä¸º TE çš„ç¬é—´åˆè¾“å…¥äº†å¦ä¸€ä¸ªå­—ç¬¦ã€‚ç»“æœï¼Œæ–°çš„æ›´æ–°ï¼ˆæ“ä½œ 6ï¼‰åˆ°è¾¾ï¼Œè¾“å…¥æ¡†çš„å€¼å˜æˆäº† TETã€‚è¿™å¹¶éç”¨æˆ·çš„æœ¬æ„â€”â€”ç”¨æˆ·å¹¶æœªé¢„æ–™åˆ°è¾“å…¥æ¡†çš„å€¼ä¼šä» TES å˜å› TEã€‚

æœ€åï¼Œæ“ä½œ 7 å°†è¾“å…¥æ¡†çš„å€¼åŒæ­¥å›ç”¨æˆ·å‡ æ¬¡è¾“å…¥å‰çš„æ­£ç¡®å€¼ï¼ˆæ“ä½œ 4 ä¼ é€’çš„ TESï¼‰ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå€¼å¾ˆå¿«è¢«å¦ä¸€æ¬¡æ›´æ–°ï¼ˆæ“ä½œ 8ï¼‰è¦†ç›–ï¼Œå°†è¾“å…¥æ¡†çš„å€¼åŒæ­¥ä¸º TETï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆçš„è¾“å…¥å€¼ã€‚

é—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚å¦‚æœæ“ä½œ 5 åœ¨æ“ä½œ 4 ä¹‹å‰æ‰§è¡Œï¼Œäº‹æƒ…å°±ä¼šé¡ºåˆ©è¿›è¡Œã€‚æ­¤å¤–ï¼Œå¦‚æœç”¨æˆ·åœ¨è¾“å…¥æ¡†çš„å€¼æ˜¯ TE è€Œé TES æ—¶æ²¡æœ‰è¾“å…¥ Tï¼Œç•Œé¢å¯èƒ½ä¼šå‡ºç°é—ªçƒï¼Œä½†è¾“å…¥å€¼ä»å°†ä¿æŒæ­£ç¡®ã€‚

è§£å†³åŒæ­¥é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å®Œå…¨ç§»é™¤ TextInput çš„ value å±æ€§ã€‚è¿™æ ·ï¼Œæ•°æ®æµå°†æ˜¯å•å‘çš„ï¼Œä»…ä»åŸç”Ÿç«¯æµå‘ JavaScript ç«¯ï¼Œä»è€Œæ¶ˆé™¤äº†ä¹‹å‰æè¿°çš„åŒæ­¥é—®é¢˜ã€‚

```javascript
import React, { useState } from 'react';
import { Text, TextInput, View, StyleSheet } from 'reactnative';

const PizzaTranslator = () => {
    const [value, setValue] = useState('');

    const onChangeText = (text) => {
        setValue(text);
    };

    return (
        <View style={styles.container}>
            <TextInput
                accessibilityLabel=''Text input field''
                placeholder=''Type here to translate!''
                onChangeText={onChangeText}
                defaultValue={value}
                style={styles.textInput}
            />
            <Text style={styles.label}>
            {value
            .split(' ')
            .map((word) => word && 'ğŸ•â€™)
            .join(' ')}
            </Text>
        </View>
    );
};

export default PizzaTranslator;

const styles = StyleSheet.create({
    container: {
    padding: 10,
    },
    textInput: {
        height: 40,    
    },
    label: {
        padding: 10,
        fontSize: 42,
    },
});
```
ç„¶è€Œï¼Œæ­£å¦‚ @nparashuram åœ¨ä»–çš„ YouTube è§†é¢‘ä¸­æåˆ°çš„ï¼ˆè¿™æ˜¯å­¦ä¹  React Native æ€§èƒ½çš„ä¼˜ç§€èµ„æºï¼‰ï¼Œ[ä»…é è¿™ç§è§£å†³æ–¹æ³•åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸å¤Ÿçš„](https://www.youtube.com/watch?v=83ffAY-CmL4&t=1483s&ab_channel=InfiniteRed)ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿›è¡Œè¾“å…¥éªŒè¯æˆ–æ·»åŠ æ©ç æ—¶ï¼Œæ‚¨ä»ç„¶éœ€è¦æ§åˆ¶ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶æ›´æ”¹æœ€ç»ˆæ˜¾ç¤ºåœ¨ TextInput ä¸­çš„å†…å®¹ã€‚

##### å…¨å±€çŠ¶æ€

å¦ä¸€ä¸ªå¸¸è§çš„æ€§èƒ½é—®é¢˜åŸå› æ˜¯ç»„ä»¶ä¸åº”ç”¨ç¨‹åºå…¨å±€çŠ¶æ€çš„ä¾èµ–å…³ç³»ã€‚æœ€ç³Ÿç³•çš„æƒ…å†µæ˜¯ï¼Œåƒ TextInput æˆ– CheckBox è¿™æ ·çš„å•ä¸ªæ§ä»¶çš„çŠ¶æ€å˜åŒ–å¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºçš„é‡æ–°æ¸²æŸ“ã€‚è¿™é€šå¸¸æ˜¯ç”±äºç³Ÿç³•çš„å…¨å±€çŠ¶æ€ç®¡ç†è®¾è®¡é€ æˆçš„ã€‚

é¦–å…ˆï¼Œæ‚¨çš„çŠ¶æ€ç®¡ç†åº“åº”è¯¥èƒ½å¤Ÿç¡®ä¿åªæœ‰åœ¨å®šä¹‰çš„ç‰¹å®šæ•°æ®å­é›†å‘ç”Ÿæ›´æ”¹æ—¶æ‰æ›´æ–°ç»„ä»¶â€”â€”è¿™æ—¶å¯ä»¥ä½¿ç”¨ useSelector é’©å­ï¼ˆæ¨èä½¿ç”¨å®ƒè€Œä¸æ˜¯ connect å‡½æ•°ï¼Œå› ä¸ºå®ƒæ›´ç®€å•æ˜“ç”¨ï¼‰ã€‚

å…¶æ¬¡ï¼Œå¦‚æœç»„ä»¶ä½¿ç”¨çš„æ•°æ®ä¸å­˜å‚¨åœ¨çŠ¶æ€ä¸­çš„æ•°æ®å½¢çŠ¶ä¸åŒï¼Œå³ä½¿æ•°æ®å®é™…ä¸Šæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿå¯èƒ½è§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥å®ç°ä¸€ä¸ªé€‰æ‹©å™¨ï¼ˆselectorï¼‰ï¼Œåœ¨ä¼ é€’çš„ä¾èµ–é›†åˆæœªå˜åŒ–æ—¶è®°å¿†æ´¾ç”Ÿç»“æœã€‚åœ¨ Redux Toolkit ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `createSelector` åˆ›å»ºè®°å¿†åŒ–é€‰æ‹©å™¨ï¼ˆmemoized selectorï¼‰ã€‚

```javascript
import { createSelector } from '@reduxjs/toolkit';

const selectVisibilityFilter = (state) => state.visibilityFilter;
const selectAllTodos = (state) => state.todos;
const selectVisibleTodos = createSelector(
  [selectVisibilityFilter, selectAllTodos],
  (filter, todos) => {
    switch (filter) {
      case 'SHOW_COMPLETED':
        return todos.filter((t) => t.completed);
      case 'SHOW_UNCOMPLETED':
        return todos.filter((t) => !t.completed);
      default:
        return todos;
    }
  }
);
```

ä¸€ç§å¸¸è§çš„æ€§èƒ½ä¼˜åŒ–è¯¯åŒºæ˜¯è®¤ä¸ºå¯ä»¥ç”¨åŸºäº React Context çš„è‡ªå®šä¹‰å®ç°æ›¿ä»£çŠ¶æ€ç®¡ç†åº“ã€‚èµ·åˆï¼Œè¿™ç§æ–¹æ³•å¯èƒ½æ˜¾å¾—å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå‡å°‘äº†çŠ¶æ€ç®¡ç†åº“å¸¦æ¥çš„æ ·æ¿ä»£ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ²¡æœ‰æ­£ç¡®å®ç°è®°å¿†åŒ–çš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒï¼Œä¼šå¯¼è‡´å·¨å¤§çš„æ€§èƒ½é—®é¢˜ã€‚æœ€ç»ˆï¼Œæ‚¨å¯èƒ½ä¼šä¸å¾—ä¸å°†çŠ¶æ€ç®¡ç†é‡æ„ä¸º Reduxï¼Œå› ä¸ºä¸ä¸ºå½“å‰æ–¹æ¡ˆå®ç°è‡ªå®šä¹‰é€‰æ‹©å™¨ç›¸æ¯”ï¼Œä½¿ç”¨ Redux ä¼šæ›´ç®€å•ã€æ›´é«˜æ•ˆã€‚

æ‚¨è¿˜å¯ä»¥åœ¨å•ä¸ªç»„ä»¶çº§åˆ«ä¼˜åŒ–åº”ç”¨ç¨‹åºã€‚ä½¿ç”¨ React.memo æˆ– React.useMemo å¯èƒ½ä¼šä¸ºæ‚¨èŠ‚çœå¤§é‡çš„é‡æ–°æ¸²æŸ“æ¬¡æ•°ï¼Œè€Œ React Profiler å¯ä»¥ç²¾ç¡®åœ°å‘Šè¯‰æ‚¨å…·ä½“èŠ‚çœäº†å¤šå°‘æ¬¡ã€‚å°½é‡é¿å…æå‰å®ç°è¿™äº›æŠ€æœ¯ï¼Œå› ä¸ºè¿™å¯èƒ½å±äºè¿‡æ—©ä¼˜åŒ–ã€‚åœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œè®°å¿†åŒ–å¯èƒ½ä¼šå› ä¸ºå¢åŠ å†…å­˜ä½¿ç”¨è€Œå¯¼è‡´åº”ç”¨æ€§èƒ½ä¸‹é™ï¼Œè¿™åœ¨ JavaScript å·¥å…·ä¸­æ˜¯æ— æ³•æµ‹é‡çš„ã€‚å› æ­¤ï¼Œå§‹ç»ˆç¡®ä¿å¯¹æ›´æ”¹å‰åçš„æ€§èƒ½è¿›è¡Œåˆ†æï¼Œä»¥ç¡®è®¤è¿™äº›æ›´æ”¹ç¡®å®ä½¿åº”ç”¨ç¨‹åºè¿è¡Œå¾—æ›´å¿«ã€‚

##### çŠ¶æ€è§„èŒƒåŒ–ï¼ˆRedux Toolkitï¼‰ï¼š

åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦å¤„ç†å®ä½“ï¼ˆentitiesï¼‰ï¼Œå³æ•°æ®é›†åˆï¼Œå…¶ä¸­æ¯æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ªç‰¹å®šå­—æ®µçš„å”¯ä¸€ IDï¼Œä¾‹å¦‚ Userã€Postã€Todoã€Commentã€‚çŠ¶æ€è§„èŒƒåŒ– æ˜¯ä¸€ç§æ¨èçš„æ–¹æ³•ï¼Œç”¨äºåœ¨ Redux å­˜å‚¨ä¸­ä»¥æ ‡å‡†åŒ–å’Œæœ‰ç»„ç»‡çš„æ–¹å¼ç®¡ç†å®ä½“ã€‚è¿™ç§æ–¹æ³•å¯¹ CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ“ä½œæä¾›äº†æå¤§å¸®åŠ©ï¼ŒåŒæ—¶ä¿æŒäº†é«˜æ€§èƒ½ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å­˜å‚¨çš„ä¸€éƒ¨åˆ†è§†ä¸ºæ•°æ®åº“ï¼Œå¹¶ä»¥è§„èŒƒåŒ–çš„å½¢å¼å­˜å‚¨è¿™äº›æ•°æ®ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨çš„æ¡Œä¸Šæœ‰ä¸€å †é‡è¦çš„æ–‡ä»¶ã€‚å¦‚æœæ‚¨èŠ±æ—¶é—´å°†è¿™äº›æ–‡ä»¶åˆ†ç±»æ•´ç†ï¼Œæ”¾å…¥æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ç»™æ¯ä¸ªæ–‡ä»¶å¤¹è´´ä¸Šä¸€ä¸ªå”¯ä¸€çš„ ID æ ‡ç­¾ï¼ŒåŒæ—¶è®°å½•è¿™äº›æ–‡ä»¶å¤¹åœ¨ä¹¦æ¶ä¸Šçš„æ’åºåˆ—è¡¨ï¼Œé‚£ä¹ˆä»¥åæŸ¥æ‰¾æ‰€éœ€æ–‡ä»¶ä¼šå˜å¾—æ›´åŠ å¿«æ·ã€‚è¿™ç§æ–¹æ³•æ¯”æ¯æ¬¡éƒ½åœ¨ä¸€å †æœªæ•´ç†çš„æ–‡ä»¶ä¸­ç¿»æ‰¾è¦é«˜æ•ˆå¾—å¤šï¼Œè™½ç„¶å‰æœŸéœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´è¿›è¡Œå‡†å¤‡ã€‚

ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸€ç»„åšå®¢æ–‡ç« è¿›è¡Œç»„ç»‡ç®¡ç†â€”â€”éœ€è¦å°†æ•°ç»„è½¬æ¢ä¸ºä¸€ä¸ªä»¥ ID ä¸ºé”®çš„å®ä½“æ˜ å°„è®°å½•ï¼ˆå¯¹åº”å¸¦æœ‰ ID çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œä»¥åŠä¸€ä¸ªç”¨äºæŒ‡ç¤ºé¡ºåºçš„ ID æ•°ç»„ï¼ˆå¯¹åº”ä¹¦æ¶ä¸Šçš„æ–‡ä»¶å¤¹åˆ—è¡¨ï¼‰ã€‚

ä»¥ä¸‹æ˜¯æ ‡å‡†åŒ–å­˜å‚¨æ•°æ®çš„ç¤ºä¾‹ï¼š
```javascript
const blogPosts = {
  posts: {
    byId: {
      post1: {
        id: 'post1',
        author: 'user1',
        body: '......',
        comments: ['comment1', 'comment2'],
      },
      post2: {
        id: 'post2',
        author: 'user2',
        body: '......',
        comments: ['comment3', 'comment4'],
      },
    },
    allIds: ['post1', 'post2'],
  },
  comments: {
    byId: {
      comment1: {
        id: 'comment1',
        author: 'user2',
        comment: '.....',
      },
      comment2: {
        id: 'comment2',
        author: 'user3',
        comment: '.....',
      },
    },
    allIds: ['comment1', 'comment2'],
  },
};
```
ç”±äºå¯ä»¥é€šè¿‡ ID å¿«é€Ÿè®¿é—®æ¯ä¸ªå®ä½“ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ç§é«˜æ•ˆçš„æ–¹æ³•æ¥ç®¡ç†å¤§é‡æ•°æ®ã€‚ä¸ä»…é€‰æ‹©æ“ä½œå¿«é€Ÿï¼Œæ·»åŠ ã€æ’å…¥æ›´æ–°ï¼ˆupsertï¼‰ã€æ›´æ–°ä»¥åŠåˆ é™¤æ“ä½œä¹ŸåŒæ ·é«˜æ•ˆã€‚

åœ¨ Redux Toolkit ä¸­ï¼Œæä¾›äº† `createEntityAdapter` æ–¹æ³•ï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†è¿™ç§æœºåˆ¶ï¼Œå¹¶è¿”å›ä¸€ç»„ä¸“ç”¨å·¥å…·ï¼ŒåŒ…æ‹¬ CRUD å‡½æ•°ã€é€‰æ‹©å™¨ï¼ˆselectorsï¼‰å’Œæ’åºè¾…åŠ©å·¥å…·ï¼ˆsorting helpersï¼‰ã€‚

```javascript
import {
 createEntityAdapter,
 createSlice,
PayloadAction,
 nanoid,
} from ''@reduxjs/toolkit'';
import { RootState } from ''../../store'';
export interface Todo {
 id: string;
 name: string;
 completed: boolean;
}
const todoEntity = createEntityAdapter<Todo>();
export const todoSlice = createSlice({
 name: ''todo'',
 initialState: todoEntity.getInitialState(),
 reducers: {
 addTodo(state, { payload: { name } }: PayloadAction<{
name: string }>) {
 todoEntity.addOne(state, {
 name,
 id: nanoid(),
 completed: false,
 });
 },
 removeTodo(state, { payload }: PayloadAction<string>) {
 todoEntity.removeOne(state, payload);
 },
 updateValue(state, action: PayloadAction<Todo>) {
 todoEntity.upsertOne(state, action);
 },
 updateBy(state, { payload: { id } }: PayloadAction<{ id:
string }>) {
const previousValue = state.entities[id]?.completed;
if (typeof previousValue === ''boolean'') {
 todoEntity.updateOne(state, {
 id,
 changes: { completed: !previousValue },
 });
 }
 },
 },
});
export const todoActions = todoSlice.actions;
export type TodoSlice = {
 [todoSlice.name]: ReturnType<(typeof todoSlice)[''reducer'']>;
};
const globalizedTodoSelector = (state: RootState) => state[todoSlice.name];
const entitySelectors = todoEntity.getSelectors<RootState>((state) =>
 globalizedTodoSelector(state),
);
export const todoSelectors = {
 ...entitySelectors,
};
```
å®ä½“é€‚é…å™¨ï¼ˆentity adapterï¼‰çš„ä¸»è¦å†…å®¹æ˜¯ç”¨äºå¤„ç†å®ä½“çŠ¶æ€å¯¹è±¡çš„å¢åˆ æ”¹æ“ä½œçš„ä¸€ç»„ç”Ÿæˆçš„ reducer å‡½æ•°ï¼ŒåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š

```javascript
const todoEntity = createEntityAdapter<Todo>()
```
å®ä½“é€‚é…å™¨åŒ…å«ä¸€ä¸ª getSelectors() å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ç»„é€‰æ‹©å™¨ï¼Œè¿™äº›é€‰æ‹©å™¨å¯ä»¥è¯»å–å®ä½“çŠ¶æ€å¯¹è±¡çš„å†…å®¹ã€‚ä»¥ä¸‹æ˜¯è¿™äº›é€‰æ‹©å™¨çš„è¯¦ç»†è¯´æ˜ï¼š

```javascript
const entitySelectors = todoEntity.
getSelectors<RootState>((state) =>
state[todoSlice.name])
```

##### åŸå­çŠ¶æ€ï¼ˆAtomic Stateï¼‰

Redux æœ€åˆæ¨å¹¿å•ä¸€å­˜å‚¨ï¼ˆå•ä¸€æ•°æ®æµï¼Œè‡ªä¸Šè€Œä¸‹çš„æ€ç»´æ¨¡å‹ï¼‰æ¨¡å¼ã€‚ç„¶è€Œï¼Œéšç€åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å¤æ‚ï¼Œè¿™ç§æ–¹æ³•å˜å¾—ç¬¨é‡ã€‚ç°åœ¨ï¼ŒçŠ¶æ€ç®¡ç†çš„è¶‹åŠ¿æ­£åœ¨è½¬å‘æ›´ä¸ºåˆ†æ•£ã€åŸå­åŒ–çš„è®¾è®¡ã€‚

ä¸ºä»€ä¹ˆä¸å†å€¾å‘äºå•ä¸€å­˜å‚¨ï¼Ÿ
- å¯¹äºæŸäº›åº”ç”¨æ¥è¯´ï¼Œå®ƒå¯èƒ½æ˜¾å¾—è¿‡äºå¤æ‚ã€‚
- ä»£ç è¿‡äºå†—é•¿ã€‚
- éœ€è¦ä½¿ç”¨å¤§é‡è®°å¿†åŒ–æŠ€æœ¯æ¥é¿å…é‡æ–°æ¸²æŸ“ã€‚
- è‡ªä¸Šè€Œä¸‹çš„æ¨¡å¼è™½ç„¶ç›´è§‚ï¼Œä½†æ€§èƒ½è¾ƒå·®ã€‚
- å½“åº”ç”¨ç¨‹åºè§„æ¨¡æ‰©å¤§æ—¶ï¼Œæ›´å¤šçš„çŠ¶æ€éœ€è¦ç®¡ç†ï¼ŒåŒæ—¶è¿˜éœ€è¦å¤„ç†å±€éƒ¨ UI çŠ¶æ€ï¼ˆä¾‹å¦‚åŠ è½½çŠ¶æ€ã€é”™è¯¯ä¿¡æ¯ã€æç¤ºæ¶ˆæ¯ç­‰ï¼‰ã€‚

å¦‚æœä¸ç•™æ„ Redux å­˜å‚¨ï¼Œå®ƒå¯èƒ½ä¼šå¸æ”¶æ‰€æœ‰çš„çŠ¶æ€ï¼Œä»è€Œå½¢æˆéš¾ä»¥ç»´æŠ¤çš„â€œå·¨çŸ³å¼â€ç»“æ„ã€‚è‡ªä¸Šè€Œä¸‹çš„è®¾è®¡ä¼šå°†å¤§å¤šæ•°çŠ¶æ€é›†ä¸­åœ¨é¡¶å±‚ç»„ä»¶ä¸­ï¼Œè¿™å¯¼è‡´çˆ¶ç»„ä»¶çš„çŠ¶æ€æ›´æ–°å¯èƒ½ä¼šå¼•å‘å…¶æ‰€æœ‰å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

ç†æƒ³æƒ…å†µä¸‹ï¼ŒçŠ¶æ€åº”å°½å¯èƒ½æœ¬åœ°åŒ–åˆ°ç»„ä»¶ä¸­ï¼Œä»¥ä¾¿æ›´çµæ´»åœ°å¤ç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä»åº•éƒ¨å‘ä¸Šæ„å»ºï¼ˆbottom-upï¼‰ï¼Œè€Œä¸æ˜¯è‡ªä¸Šè€Œä¸‹æ„å»ºï¼ˆtop-downï¼‰ã€‚

è€ƒè™‘ä¸€ä¸ªå¾…åŠäº‹é¡¹åˆ—è¡¨ï¼ˆTODO Listï¼‰ï¼Œå®ƒæœ‰ä¸€äº›ç­›é€‰å™¨é€‰é¡¹ï¼Œæ¯”å¦‚â€œæ˜¾ç¤ºå…¨éƒ¨â€ã€â€œåªæ˜¾ç¤ºæ´»åŠ¨é¡¹â€æˆ–â€œåªæ˜¾ç¤ºå·²å®Œæˆé¡¹â€ã€‚æˆ‘ä»¬ä¼šè¯†åˆ«å‡ºé¡¶çº§ç»„ä»¶ TodoListï¼Œä½†ä¸ä¼šä»è¿™é‡Œå¼€å§‹è®¾è®¡ã€‚ç›¸åï¼Œæˆ‘ä»¬ä¼šå…ˆè¯†åˆ«å‡ºå®ƒçš„å­ç»„ä»¶ï¼Œä»æ„å»ºè¾ƒå°çš„ç»„ä»¶å¼€å§‹ï¼Œé€æ­¥ç»„åˆæˆæ›´å¤æ‚çš„å…ƒç´ ã€‚

æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­æ˜¾ç¤ºæ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®ç”±å¦ä¸€ä¸ªç»„ä»¶ç®¡ç†ã€‚ä¸ºäº†é¿å…ä½¿ç”¨çˆ¶çŠ¶æ€å¹¶å‘ä¸‹ä¼ é€’æ•°æ®å’Œæ“ä½œï¼ˆè‡ªä¸Šè€Œä¸‹çš„æ–¹æ³•ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·æ¥å­˜å‚¨æ•°æ®ï¼Œä½¿å…¶å¯è®¿é—®ï¼Œå¹¶æä¾›æ“ä½œæ–¹æ³•ã€‚

**Zustand**

[Zustand](https://github.com/pmndrs/zustand) é€šå¸¸è¢«ç”¨ä½œä¸€ç§è‡ªä¸Šè€Œä¸‹çš„æ¨¡å¼ï¼Œä½†ç”±äºå®ƒçš„ç®€å•æ€§å’Œéçº¦æŸæ€§ï¼ˆunopinionatedï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒä»¥è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼æ„å»ºç»„ä»¶ã€‚

**Store**

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºå­˜æ”¾è¿‡æ»¤å™¨ï¼ˆfilterï¼‰ä»¥åŠæš´éœ²çš„ä¿®é¥°ç¬¦ï¼ˆmodifiersï¼‰ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ä¸­ç®¡ç†å’Œä½¿ç”¨å®ƒä»¬ã€‚

```javascript
export const useHomeStore = create((set) => ({
    filter: filterType.all,
    showAll: () => set({ filter: filterType.all }),
    showOnlyCompleted: () => set({ filter: filterType.completed }),
    showOnlyActive: () => set({ filter: filterType.active }),
}));
```

**Show all filter button**
ä»¥ä¸‹æ˜¯æ›´æ–°ç‰¹å®šé¡¹ç›®ï¼ˆä¾‹å¦‚ç¥¨æ®ï¼‰ä»¥é¿å…å…¶å­ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ç¤ºä¾‹å®ç°
```javascript
const ShowAllItem = () => {
 const showAll = useHomeStore((state) => state.showAll);
 return <Menu.Item onPress={showAll} title=''Show All'' />;
};
```

**Todo item**
ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¿‡æ»¤åŠŸèƒ½ç¤ºä¾‹ï¼ŒTodoItemList ç»„ä»¶ä»…åœ¨è¿‡æ»¤æ¡ä»¶æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ï¼Œè€Œä¸ä¼šå› æ— å…³çŠ¶æ€å˜åŒ–è€Œå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼š

```javascript
export const TodoItemList = ({ item }) => {
    const filter = useHomeStore((state) => state.filter);
    if (!shouldBeShown(filter, item.done)) {
        return null;
    }
    return (
        <View>
            <Text>{item.title}</Text>
            <Text>{item.description}</Text>
        </View>
    );
};
```

**Jotai**

Jotai æ˜¯ä¸“ä¸ºè‡ªä¸‹è€Œä¸Šçš„çŠ¶æ€ç®¡ç†æ–¹æ³•è®¾è®¡çš„ï¼Œå…¶è¯­æ³•ç®€æ´æ˜äº†ã€‚Jotai åŸºäº atom çš„æ¦‚å¿µï¼Œå°†æ¯ä¸ª atom è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„â€œå­˜å‚¨å•å…ƒâ€ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä¸åŒçš„ Hookï¼Œä½¿ atom çš„çŠ¶æ€å˜ä¸ºåªè¯»æˆ–å¯å˜ï¼Œä»è€Œå®ç°çµæ´»çš„çŠ¶æ€ç®¡ç†ã€‚

**Store**
æˆ‘ä»¬ä½¿ç”¨ `useAtomValue` æ¥è¯»å–è¿‡æ»¤å™¨çš„å€¼ï¼Œä½¿ç”¨ `useSetAtom` æ¥è®¾ç½®æ–°å€¼ã€‚è¿™åœ¨æ€§èƒ½æ˜¯ä¸€ä¸ªå…³æ³¨ç‚¹æ—¶å°¤å…¶æœ‰ç”¨ã€‚

```javascript
const filter = atom(filterType.all);

export const useCurrentFilter = () => useAtomValue(filter);
export const useUpdateFilter = () => useSetAtom(filter);
```

**FilterMenuItem**
```javascript
const FilterMenuItem = ({ title, filterType }) => {
    const setUpdateFilter = useUpdateFilter();
    const handleShowAll = () => setUpdateFilter(filterType);
    return <Menu.Item onPress={handleShowAll} title={title} />;
};
```

**TodoItem**
```javascript
export const TodoItemList = ({ item }) => {
    const filter = useCurrentFilter();
    if (!shouldBeShown(filter, item.done)) {
        return null;
    }
    return (
        <View>
            <Text>{item.title}</Text>
            <Text>{item.description}</Text>
        </View>
    );
};
```

é€šè¿‡è¿™ç§è‡ªä¸‹è€Œä¸Šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é˜²æ­¢çˆ¶ç»„ä»¶çš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶é¿å…å¯¹å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚æ­¤å¤–ï¼Œè¿™ç§æ–¹æ³•é€šå¸¸è¿˜èƒ½å‡å°‘å¯¹è®°å¿†åŒ–çš„è¿‡åº¦ä½¿ç”¨ã€‚

##### æœªæ¥ï¼šReact Forget

æ‰‹åŠ¨å†…å­˜ç®¡ç†å¯¹å¤§å¤šæ•°å¼€å‘è€…æ¥è¯´å¹¶ä¸æœ‰è¶£â€”â€”æ— è®ºæ˜¯é€šè¿‡ C è¯­è¨€æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œè¿˜æ˜¯åœ¨ React ä¸­æ‰‹åŠ¨å¯¹ç»„ä»¶å’Œå€¼è¿›è¡Œè®°å¿†åŒ–ã€‚æˆ‘ä»¬é€šå¸¸ä¼šé€‰æ‹©ä½¿ç”¨æ›´é«˜çº§çš„è¯­è¨€æˆ–æ™ºèƒ½ç¼–è¯‘å™¨æ¥æ›¿æˆ‘ä»¬å¤„ç†è¿™äº›ç¹ççš„ä»»åŠ¡ã€‚

React Forget æ˜¯ React çš„ä¸€ç§â€œè‡ªåŠ¨è®°å¿†åŒ–ç¼–è¯‘å™¨â€ï¼Œæ—¨åœ¨æå‡ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æ€§èƒ½ï¼Œç”šè‡³å¯èƒ½å®Œå…¨æ¶ˆé™¤ä½¿ç”¨ memo()ã€useCallback() å’Œ useMemo() çš„éœ€æ±‚ã€‚è¿™ä¸ªç¼–è¯‘å™¨ä¸ä»…èƒ½å¤Ÿå¯¹ useMemo() çš„ç»“æœè¿›è¡Œè®°å¿†åŒ–å¤„ç†ï¼Œè¿˜èƒ½å¯¹ç»„ä»¶è¿”å›çš„ React å…ƒç´ å¯¹è±¡è¿›è¡Œè®°å¿†åŒ–ä¼˜åŒ–ã€‚

React Forget çš„åç§°æ¥æºäºå…¶è®¾è®¡ç†å¿µï¼šè¯¥å·¥å…·ä¼šè‡ªåŠ¨å¤„ç†ç»„ä»¶çº§åˆ«çš„ä¼˜åŒ–å’Œè®°å¿†åŒ–ä»»åŠ¡ï¼Œä»è€Œè®©å¼€å‘è€…å¯ä»¥â€œå¿˜è®°â€è¿™äº›æ‰‹åŠ¨ä¼˜åŒ–å¸¦æ¥çš„è´Ÿæ‹…å’Œé¢å¤–çš„æ ·æ¿ä»£ç ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ€§èƒ½ä¼˜åŒ–çš„ç»†èŠ‚é—®é¢˜ã€‚

**æ³¨æ„ï¼š å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆªè‡³æ’°å†™æœ¬ç« èŠ‚æ—¶ï¼ŒReact Forget ä»å¤„äºå¼€å‘é˜¶æ®µï¼Œå°šæœªå‘å…¬ä¼—æ­£å¼å‘å¸ƒã€‚**
**åœ¨ React Conf 2021 å¤§ä¼šä¸Šï¼Œ@Huxpro æä¾›äº†ä¸€æ®µç²¾å½©çš„è§†é¢‘ï¼Œè¯¦ç»†æè¿°äº† React Forget çš„åº•å±‚å·¥ä½œåŸç†ã€‚åˆ°äº† 2023 å¹´ï¼Œæˆ‘ä»¬ä» React Advanced 2023 å¤§ä¼šä¸Šè·å¾—äº†æ¥è‡ª Meta çš„ Joe Savona å’Œ Mofei Zhang çš„æœ€æ–°æ¶ˆæ¯ï¼Œä»–ä»¬åˆ†äº«äº† React Forget åœ¨ Instagram ç½‘ç«™ä¸Šçš„å¼€å‘ä¸å®éªŒè¿›å±•æƒ…å†µã€‚**

è®©æˆ‘ä»¬å›é¡¾ä¸Šä¸€ç« å…³äºåŸå­çŠ¶æ€çš„å¾…åŠäº‹é¡¹åˆ—è¡¨åº”ç”¨ç¤ºä¾‹ä»£ç ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•ç”¨æœªæ¥çš„ React Forget ç¼–è¯‘å™¨å¯¹å…¶è¿›è¡Œç®€åŒ–ã€‚

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª TodoListItem ç»„ä»¶ï¼Œå¸Œæœ›å°†å…¶ç”¨äº TodoList ç»„ä»¶ä¸­ã€‚ä¸ºäº†é¿å…åœ¨æ·»åŠ å¾…åŠäº‹é¡¹ã€æ›´æ”¹å¯è§æ€§æˆ–ä¸»é¢˜è®¾ç½®æ—¶å‘ç”Ÿå¤šæ¬¡ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ç”¨ React.memo åŒ…è£¹å®ƒã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å…³æ³¨ç»„ä»¶å†…éƒ¨çš„æ‰€æœ‰å‡½æ•°ï¼Œä¾‹å¦‚ handleChangeï¼Œè¿™äº›å‡½æ•°åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè¢«é‡æ–°åˆ›å»ºã€‚éœ€è¦è®°å¿†åŒ–å’Œæ‰‹åŠ¨å¤„ç†çš„å†…å®¹ç›¸å½“å¤šï¼Œè¿™ç§é‡å¤æ“ä½œå¾ˆå®¹æ˜“è®©äººæ„Ÿåˆ°çƒ¦èºã€‚

```javascript
const MemoizedTodo = React.memo(TodoListItem);

const TodoList = ({ visibility, themeSettings }) => {
    const [todos, setTodos] = useState(initialTodos);

    const handleChange = useCallback((todo) => {
        setTodos((todos) => getUpdated(todos, todo));
    }, []);

    const doneTodosNumber = useMemo(getDoneTodos(todos, visibility),[]));

    return (
        <View>
            <FlatList data={todos} renderItem={MemoizedTodo} />
            <Text>Done: {doneTodosNumber}</Text>
            <TouchableOpacity onPress={handleChange}>
            <Text>Change</Text>
            </TouchableOpacity>
        </View>
    );
};
```
React Forget çš„ç›®æ ‡æ˜¯å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…¶æ‰¿è¯ºæ˜¯ï¼Œä¸Šè¿°ç¤ºä¾‹ä»£ç å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

```javascript
const TodoList = ({ visibility, themeSettings }) => {
    const [todos, setTodos] = useState(initialTodos);
    const handleChange = setTodos((todos) => getUpdated(todos, todo));
    const doneTodosNumber = getDoneTodos(todos, visibility);
    return (
        <View>
        <FlatList data={todos} renderItem={TodoListItem} />
        <Text>Done: {doneTodosNumber}</Text>
        <TouchableOpacity onPress={handleChange}>
        <Text>Change</Text>
        </TouchableOpacity>
        </View>
    );
};
```
å¹¶ä¸”ï¼Œå®ƒçš„è¡Œä¸ºå°†ä¸ä¹‹å‰æ‰‹åŠ¨è®°å¿†åŒ–çš„ç¤ºä¾‹å®Œå…¨ç›¸åŒã€‚

ä¸å†éœ€è¦ä½¿ç”¨ useCallback æˆ– React.memoï¼Œä»£ç å°†ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–ã€‚è¿™ç§æ–¹å¼ç®€æ´é«˜æ•ˆï¼Œéå¸¸ä»¤äººæ»¡æ„ã€‚

ä½œä¸ºæœ¬ä¹¦çš„ä½œè€…ï¼Œæˆ‘ä»¬å¯¹ React Forget æ„Ÿåˆ°éå¸¸æœŸå¾…ï¼Œè¿«ä¸åŠå¾…åœ°å¸Œæœ›å®ƒèƒ½å¤Ÿæ­£å¼å‘å¸ƒã€‚å±Šæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå°†å¤§éƒ¨åˆ†ä¸æ‰‹åŠ¨è®°å¿†åŒ–ç®¡ç†ç›¸å…³çš„å†…å®¹ç§»é™¤ã€‚

#### ä¼˜åŠ¿ï¼šæ›´å°‘çš„èµ„æºæ¶ˆè€—å’Œæ›´å¿«çš„åº”ç”¨æ€§èƒ½

ä½ åº”è¯¥å§‹ç»ˆå°†åº”ç”¨æ€§èƒ½æ”¾åœ¨å¿ƒä¸Šï¼Œä½†ä¹Ÿè¦è­¦æƒ•è¿‡æ—©ä¼˜åŒ–ã€‚æœ‰äººè¯´â€œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºâ€ï¼Œè¿™è¯å¹¶ä¸å®Œå…¨æ­£ç¡®ï¼Œä½†ä¹Ÿä¸æ˜¯å®Œå…¨é”™è¯¯ã€‚è¿‡æ—©çš„è®°å¿†åŒ–å¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„å†…å­˜å ç”¨ï¼Œè€Œå®é™…å¸¦æ¥çš„æ€§èƒ½æå‡å´å¾®ä¹å…¶å¾®ï¼Œä¸æŠ•å…¥çš„ç²¾åŠ›ä¸æˆæ¯”ä¾‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¡¡é‡å¹¶è¯†åˆ«å…·æœ‰æ˜¾è‘—å½±å“çš„é—®é¢˜è‡³å…³é‡è¦ã€‚

å¤§å¤šæ•°éš¾ä»¥è§£å†³çš„æ€§èƒ½é—®é¢˜éƒ½æºäºçŠ¶æ€ç®¡ç†æ–¹é¢çš„ä¸è‰¯æ¶æ„å†³ç­–ã€‚ä¸åŒçš„åº“åœ¨æƒè¡¡å–èˆä¸Šå„æœ‰ç‰¹ç‚¹ã€‚ç¡®ä¿ä½ å’Œä½ çš„å›¢é˜Ÿç†è§£è¿™äº›æƒè¡¡ï¼Œå¹¶é€‰æ‹©æœ€é€‚åˆä½ ä»¬å·¥ä½œæ–¹å¼çš„å·¥å…·ã€‚

å¯¹äºä¸€äº›äººæ¥è¯´ï¼Œå¯èƒ½æ›´ä¹ æƒ¯ Redux çš„è¯¦ç»†æ“ä½œï¼Œè€Œå¦ä¸€äº›äººå¯èƒ½æ›´å–œæ¬¢ Zustand çš„ç®€æ´æ˜“ç”¨ï¼Œå› ä¸ºå®ƒèƒ½é¿å…é¢å¤–é‡æ–°æ¸²æŸ“çš„å¤æ‚æ€§ã€‚

ç»¼åˆè€ƒè™‘è¿™äº›å› ç´ ï¼Œä½ çš„åº”ç”¨åº”è¯¥èƒ½å¤Ÿå‡å°‘ä¸å¿…è¦çš„æ“ä½œï¼Œæ¶ˆè€—æ›´å°‘çš„èµ„æºæ¥å®Œæˆä»»åŠ¡ã€‚è¿™ä¸ä»…å¯ä»¥é™ä½ç”µæ± æ¶ˆè€—ï¼Œè¿˜èƒ½è®©ç”¨æˆ·åœ¨ä¸ç•Œé¢äº¤äº’æ—¶è·å¾—æ›´é«˜çš„æ»¡æ„åº¦ã€‚

### ç¬¬äºŒèŠ‚ ä¸ºç‰¹å®šå¸ƒå±€ä½¿ç”¨ä¸“ç”¨ç»„ä»¶
> äº†è§£å¦‚ä½•ä½¿ç”¨ä¸“ç”¨çš„é«˜é˜¶ React Native ç»„ä»¶æå‡ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨æ€§èƒ½
#### é—®é¢˜ï¼šæ‚¨ä¸äº†è§£ React Native æä¾›çš„é«˜é˜¶ç»„ä»¶ã€‚
åœ¨ React Native åº”ç”¨ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯ç»„ä»¶ã€‚åœ¨ç»„ä»¶å±‚çº§çš„æœ«ç«¯ï¼Œæœ‰ä¸€äº›æ‰€è°“çš„åŸç”Ÿç»„ä»¶ï¼ˆprimitive componentsï¼‰ï¼Œä¾‹å¦‚ Textã€View æˆ– TextInputã€‚è¿™äº›ç»„ä»¶ç”± React Native å®ç°ï¼Œå¹¶ç”±ç›®æ ‡å¹³å°æä¾›ï¼Œç”¨äºæ”¯æŒæœ€åŸºæœ¬çš„ç”¨æˆ·äº¤äº’ã€‚

å½“æˆ‘ä»¬æ„å»ºåº”ç”¨æ—¶ï¼Œä¼šå°†å…¶ç”±è¾ƒå°çš„æ„å»ºå—ç»„æˆã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åŸç”Ÿç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œè¦åˆ›å»ºä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ— TextInput ç»„ä»¶æ¥æ³¨å†Œç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª Touchable ç»„ä»¶æ¥å¤„ç†ç”¨æˆ·äº¤äº’ã€‚ä»æˆ‘ä»¬åœ¨åº”ç”¨ä¸­åˆ›å»ºçš„ç¬¬ä¸€ä¸ªç»„ä»¶å¼€å§‹ï¼Œè¿™ç§æ–¹æ³•è´¯ç©¿åº”ç”¨å¼€å‘çš„å§‹ç»ˆï¼Œç›´åˆ°å¼€å‘çš„æœ€ç»ˆé˜¶æ®µã€‚

é™¤äº†åŸç”Ÿç»„ä»¶ä¹‹å¤–ï¼ŒReact Native è¿˜æä¾›äº†ä¸€ç»„é«˜é˜¶ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ç»è¿‡è®¾è®¡å’Œä¼˜åŒ–ï¼Œç”¨äºç‰¹å®šçš„ç›®çš„ã€‚å¦‚æœä¸äº†è§£æˆ–æœªä½¿ç”¨è¿™äº›é«˜é˜¶ç»„ä»¶ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨çš„çŠ¶æ€ä¸­å¡«å……äº†å®é™…ç”Ÿäº§æ•°æ®æ—¶ã€‚åº”ç”¨æ€§èƒ½å·®å¯èƒ½ä¼šä¸¥é‡æŸå®³ç”¨æˆ·ä½“éªŒï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·å¯¹äº§å“ä¸æ»¡æ„ï¼Œå¹¶è½¬å‘æ‚¨çš„ç«äº‰å¯¹æ‰‹ã€‚

##### æœªä½¿ç”¨ä¸“ç”¨ç»„ä»¶ä¼šéšç€æ•°æ®å¢é•¿å½±å“åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

å¦‚æœæ‚¨æœªä½¿ç”¨ä¸“ç”¨ç»„ä»¶ï¼Œå°±æ”¾å¼ƒäº†æ€§èƒ½æ”¹è¿›çš„æœºä¼šï¼Œå¹¶å¯èƒ½åœ¨åº”ç”¨æŠ•å…¥ç”Ÿäº§æ—¶é¢ä¸´ç”¨æˆ·ä½“éªŒä¸‹é™çš„é£é™©ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›é—®é¢˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½æ— æ³•å¯Ÿè§‰ï¼Œå› ä¸ºæ¨¡æ‹Ÿæ•°æ®é€šå¸¸è¾ƒå°ï¼Œæ— æ³•åæ˜ ç”Ÿäº§æ•°æ®åº“çš„è§„æ¨¡ã€‚ä¸“ç”¨ç»„ä»¶æ›´å…¨é¢ï¼Œæ‹¥æœ‰æ›´å¹¿æ³›çš„ APIï¼Œèƒ½å¤Ÿè¦†ç›–å¤§å¤šæ•°ç§»åŠ¨åœºæ™¯çš„éœ€æ±‚ã€‚

#### è§£å†³æ–¹æ¡ˆï¼šå§‹ç»ˆä½¿ç”¨ä¸“ç”¨ç»„ä»¶ï¼Œä¾‹å¦‚åˆ—è¡¨ä½¿ç”¨ FlatListã€‚

è®©æˆ‘ä»¬ä»¥é•¿åˆ—è¡¨ä¸ºä¾‹ã€‚å‡ ä¹æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šåœ¨æŸäº›æ—¶å€™åŒ…å«ä¸€ä¸ªåˆ—è¡¨ã€‚åˆ›å»ºå…ƒç´ åˆ—è¡¨æœ€å¿«é€Ÿä¸”æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç»“åˆä½¿ç”¨ ScrollView å’Œ View è¿™ç±»åŸç”Ÿç»„ä»¶ã€‚

ç„¶è€Œï¼Œå½“æ•°æ®é‡å¢é•¿æ—¶ï¼Œè¿™ç§æ–¹æ³•ä¼šå¾ˆå¿«å˜å¾—é—®é¢˜é‡é‡ã€‚å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ã€å®ç°æ— é™æ»šåŠ¨ä»¥åŠè¿›è¡Œå†…å­˜ç®¡ç†ï¼Œæ­£æ˜¯ React Native æä¾› FlatList è¿™ä¸€ä¸“ç”¨ç»„ä»¶çš„åˆè¡·ï¼ŒFlatList ä¸“ä¸ºæ˜¾ç¤ºå’Œæ“ä½œæ­¤ç±»æ•°æ®ç»“æ„è€Œè®¾è®¡ã€‚

å¯¹æ¯”åŸºäº ScrollView æ·»åŠ æ–°åˆ—è¡¨å…ƒç´ çš„æ€§èƒ½ï¼š
```javascript
import React, { useCallback, useState } from 'react';
import { ScrollView, View, Text, Button, StyleSheet } from 'react-native';

const objects = [
    ['avocado', 'ğŸ¥‘'],
    ['apple', 'ğŸ'],
    ['orange', 'ğŸŠ'],
    ['cactus', 'ğŸŒµ'],
    ['eggplant', 'ğŸ†'],
    ['strawberry', 'ğŸ“'],
    ['coconut', 'ğŸ¥¥'],
];

const getRandomItem = () => {
    const item = objects[~~(Math.random() * objects.length)];
    return {
        name: item[0],
        icon: item[1],
        id: Date.now() + Math.random(),
    };
};

const _items = Array.from(new Array(5000)).map(getRandomItem);

const List = () => {
    const [items, setItems] = useState(_items);
    const addItem = useCallback(() => {
        setItems([getRandomItem()].concat(items));
     }, [items]);
    return (
        <View style={styles.container}>
            <Button title=''add item'' onPress={addItem} />
            <ScrollView>
                {items.map(({ name, icon, id }) => (
                    <View style={styles.itemContainer} key={id}>
                        <Text style={styles.name}>{name}</Text>
                        <Text style={styles.icon}>{icon}</Text>
                    </View>
                ))}
            </ScrollView>
        </View>
    );
};
const styles = StyleSheet.create({
    container: {
        marginTop: 30,
    },
    itemContainer: {
        borderWidth: 1,
        margin: 3,
        padding: 5,
        flexDirection: 'row',
    },
    name: {
        fontSize: 20,
        width: 150,
    },
    icon: {
        fontSize: 20,
    },
});
export default List;
```
æ¢æˆ`FlatList`ã€‚
```javascript
import React' { useCallback' useState } from 'react';
import { View' Text' Button' FlatList' StyleSheet } from 'react-native';

const objects = [
    'avocado ğŸ¥‘',
    'apple ğŸ',
    'orage ğŸŠ',
    'cactus ğŸŒµ',
    'eggplant ğŸ†',
    'strawberry ğŸ“',
    'coconut ğŸ¥¥',
];

const getRandomItem = () => {
    const item = objects[~~(Math.random() * objects.length)].split(' ');
    return {
        name: item[0],
        icon: item[1],
        id: Date.now() + Math.random(),
    };
};

const _items = Array.from(new Array(5000)).map(getRandomItem);
const List = () => {
    const [items, setItems] = useState(_items);

    const addItem = useCallback(() => {
        setItems([getRandomItem()].concat(items));
    }, [items]);

    const keyExtractor = useCallback(({ id }) => id.toString(), []);
    
    const renderItem = useCallback(({ item: { name, icon } }) => (
            <View style={styles.itemContainer}>
                <Text style={styles.name}>{name}</Text>
                <Text style={styles.icon}>{icon}</Text>
            </View>
        ),
        [],
    );
    return (
        <View style={styles.container}>
            <Button title=''add item'' onPress={addItem} />
            <FlatList
            data={items}
            keyExtractor={keyExtractor}
            renderItem={renderItem}
            />
        </View>
    );
};

const styles = StyleSheet.create({
    container: {
        marginTop: 30,
    },
    itemContainer: {
        borderWidth: 1,
        margin: 3,
        padding: 5,
        flexDirection: 'row',
    },
    name: {
        fontSize: 20,
        width: 150,
    },
    icon: {
        fontSize: 20,
    },
});
export default List;
```

å·®å¼‚éå¸¸æ˜¾è‘—ï¼Œä¸æ˜¯å—ï¼Ÿåœ¨ä¸€ä¸ªåŒ…å« 5000 ä¸ªåˆ—è¡¨é¡¹çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ ScrollView çš„ç‰ˆæœ¬ç”šè‡³æ— æ³•æµç•…æ»šåŠ¨ã€‚

æœ€ç»ˆï¼ŒFlatList ä¹Ÿä¼šä½¿ç”¨ ScrollView å’Œ View ç»„ä»¶ã€‚é‚£ä¹ˆï¼Œå…³é”®åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

å…³é”®åœ¨äº FlatList å†…éƒ¨æŠ½è±¡çš„é€»è¾‘ã€‚å®ƒåŒ…å«äº†è®¸å¤šå¯å‘å¼ç®—æ³•å’Œé«˜çº§ JavaScript è®¡ç®—ï¼Œç”¨äºå‡å°‘å±å¹•æ˜¾ç¤ºæ•°æ®æ—¶å‘ç”Ÿçš„ä¸å¿…è¦æ¸²æŸ“ï¼Œå¹¶ç¡®ä¿æ»šåŠ¨ä½“éªŒå§‹ç»ˆä»¥ 60FPS çš„é€Ÿåº¦è¿è¡Œã€‚ç„¶è€Œï¼Œä»…ä»…ä½¿ç”¨ FlatList åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½è¿˜ä¸å¤Ÿã€‚

FlatList çš„æ€§èƒ½ä¼˜åŒ–ä¾èµ–äºä¸æ¸²æŸ“å±å¹•ä¸Šä¸å¯è§çš„å…ƒç´ ã€‚ç„¶è€Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æœ€è€—è´¹èµ„æºçš„éƒ¨åˆ†æ˜¯ å¸ƒå±€æµ‹é‡ã€‚FlatList éœ€è¦æµ‹é‡æ‚¨çš„å¸ƒå±€ï¼Œä»¥ç¡®å®šæ»šåŠ¨åŒºåŸŸä¸­åº”è¯¥ä¸ºå³å°†åŠ è½½çš„å…ƒç´ é¢„ç•™å¤šå°‘ç©ºé—´ã€‚

å¯¹äºå¤æ‚çš„åˆ—è¡¨å…ƒç´ ï¼Œè¿™å¯èƒ½ä¼šæ˜¾è‘—å‡æ…¢ä¸ FlatList çš„äº¤äº’ã€‚æ¯æ¬¡ FlatList éœ€è¦æ¸²æŸ“ä¸‹ä¸€æ‰¹æ•°æ®æ—¶ï¼Œéƒ½å¿…é¡»ç­‰å¾…æ‰€æœ‰æ–°é¡¹æ¸²æŸ“å®Œæˆåå†æµ‹é‡å®ƒä»¬çš„é«˜åº¦ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å®ç° getItemHeight() æ–¹æ³•ï¼Œæå‰å®šä¹‰å…ƒç´ çš„é«˜åº¦ï¼Œè€Œæ— éœ€è¿›è¡Œæµ‹é‡ã€‚ä½†å¯¹äºé«˜åº¦ä¸å›ºå®šçš„å…ƒç´ ï¼Œè¿™å¹¶ä¸ç®€å•ã€‚å¯ä»¥æ ¹æ®æ–‡æœ¬è¡Œæ•°å’Œå…¶ä»–å¸ƒå±€çº¦æŸè®¡ç®—å‡ºé«˜åº¦å€¼ã€‚

æˆ‘ä»¬å»ºè®®ä½¿ç”¨ react-native-text-size åº“æ¥ä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰åˆ—è¡¨é¡¹ä¸­æ˜¾ç¤ºæ–‡æœ¬çš„é«˜åº¦ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œè¿™æ˜¾è‘—æå‡äº† Android å¹³å° ä¸Š FlatList æ»šåŠ¨äº‹ä»¶çš„å“åº”é€Ÿåº¦ã€‚

##### FlashListï¼šFlatList çš„ç»§ä»»è€…
å¦‚å‰æ‰€è¿°ï¼Œä¸ ScrollView ç›¸æ¯”ï¼ŒFlatList åœ¨å¤„ç†å¤§åˆ—è¡¨æ—¶æ˜¾è‘—æé«˜äº†æ€§èƒ½ã€‚å°½ç®¡ FlatList å·²è¢«è¯æ˜æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚

å¼€å‘è€…å’Œç”¨æˆ·ç»å¸¸ä¼šé‡åˆ°ä¸€äº›å¸¸è§é—®é¢˜ï¼Œä¾‹å¦‚æ»šåŠ¨æ—¶å‡ºç°ç©ºç™½åŒºåŸŸã€æ»šåŠ¨å¡é¡¿ï¼Œä»¥åŠåˆ—è¡¨å“åº”ä¸å¤Ÿè¿…é€Ÿã€‚è¿™äº›é—®é¢˜å‡ ä¹æ¯å¤©éƒ½ä¼šå‘ç”Ÿã€‚FlatList çš„è®¾è®¡ä¼šåœ¨å†…å­˜ä¸­ä¿ç•™æŸäº›å…ƒç´ ï¼Œè¿™å¢åŠ äº†è®¾å¤‡çš„å¼€é”€ï¼Œæœ€ç»ˆå¯¼è‡´åˆ—è¡¨å˜æ…¢ã€‚è€Œç©ºç™½åŒºåŸŸçš„å‡ºç°åˆ™æ˜¯å› ä¸º FlatList æœªèƒ½è¶³å¤Ÿå¿«åœ°æ¸²æŸ“åˆ—è¡¨é¡¹ã€‚

å°½ç®¡æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡è½»è¿™äº›é—®é¢˜ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»ç„¶å¸Œæœ›åˆ—è¡¨æ›´åŠ æµç•…å’Œå¿«é€Ÿå“åº”ã€‚ä½¿ç”¨ FlatList æ—¶ï¼ŒJS çº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨å¿™ç¢Œï¼Œæˆ‘ä»¬ä¹Ÿæ€»æ˜¯å¸Œæœ›åœ¨æ»šåŠ¨åˆ—è¡¨æ—¶ï¼ŒJS çº¿ç¨‹èƒ½å¤Ÿä¿æŒ 60FPS çš„è¡¨ç°ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åº”å¯¹è¿™äº›é—®é¢˜å‘¢ï¼Ÿå¦‚æœä¸ç”¨ FlatListï¼Œé‚£ä¹ˆè¯¥é€‰æ‹©ä»€ä¹ˆå‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼ŒShopify å¼€å‘äº†ä¸€ç§ä¼˜ç§€çš„ FlatList æ›¿ä»£æ–¹æ¡ˆï¼Œåä¸º FlashListã€‚

FlashList ä¼šå›æ”¶è§†å£å¤–çš„è§†å›¾ï¼Œå¹¶å°†å…¶é‡æ–°ç”¨äºå…¶ä»–åˆ—è¡¨é¡¹ã€‚å¦‚æœåˆ—è¡¨åŒ…å«ä¸åŒç±»å‹çš„é¡¹ï¼ŒFlashList ä¼šä½¿ç”¨å›æ”¶æ± ï¼Œæ ¹æ®ç±»å‹æ¥å¤ç”¨åˆ—è¡¨é¡¹ã€‚è¿™ç§æœºåˆ¶è¦æ±‚åˆ—è¡¨é¡¹å°½é‡ä¿æŒè½»é‡åŒ–ï¼Œå¹¶é¿å…ä»»ä½•å‰¯ä½œç”¨ï¼Œå¦åˆ™ä¼šå½±å“åˆ—è¡¨çš„æ€§èƒ½ã€‚

å…³é”®å±æ€§
- estimatedItemSize
  - è¿™æ˜¯åˆ—è¡¨é¡¹çš„è¿‘ä¼¼å¤§å°ï¼Œç”¨äºå¸®åŠ© FlashList å†³å®šåˆå§‹åŠ è½½å’Œæ»šåŠ¨æ—¶éœ€è¦æ¸²æŸ“çš„åˆ—è¡¨é¡¹æ•°é‡ã€‚
  - å¦‚æœåˆ—è¡¨é¡¹å¤§å°ä¸åŒï¼Œå¯ä»¥å¯¹å…¶å¤§å°å–å¹³å‡å€¼ã€‚
  - å¦‚æœåœ¨åˆæ¬¡æ¸²æŸ“æ—¶æœªæä¾›è¯¥å€¼ï¼ŒFlashList ä¼šé€šè¿‡è­¦å‘Šæç¤ºè·å–å»ºè®®å€¼ï¼Œä¹‹åå¯ä»¥å°†å…¶ç”¨äºåç»­æ¸²æŸ“ã€‚
  - å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ React Native åº”ç”¨ä¸­çš„å¼€å‘å·¥å…·ï¼ˆå…ƒç´ æ£€æŸ¥å™¨ï¼‰æ¥è·å–è¯¥å€¼ã€‚
- overrideItemLayout
  - æ­¤å±æ€§ä¼˜å…ˆäº estimatedItemSizeã€‚
  - å¦‚æœåˆ—è¡¨é¡¹å¤§å°ä¸åŒä¸”å·²çŸ¥å…·ä½“å¤§å°ï¼Œå»ºè®®ä½¿ç”¨è¯¥å±æ€§ç›´æ¥æä¾›å€¼ï¼Œè€Œä¸æ˜¯é‡‡ç”¨å¹³å‡å€¼ã€‚

æµ‹é‡ FlashList æ€§èƒ½æ—¶ï¼Œè¯·ç¡®ä¿ æå‰æ‰“å¼€ JS åŒ…çš„å‘å¸ƒæ¨¡å¼ã€‚åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ŒFlashList å¯èƒ½çœ‹èµ·æ¥æ¯” FlatList æ…¢ï¼Œå…¶ä¸»è¦åŸå› æ˜¯å¼€å‘æ¨¡å¼ä¸­ windowSize éå¸¸å°ä¸”å›ºå®šã€‚

æ‚¨å¯ä»¥åˆ©ç”¨ FlashList å†…ç½®çš„å›è°ƒå‡½æ•°æ¥æµ‹é‡æ€§èƒ½ï¼š
- onBlankAreaï¼šæ£€æµ‹åˆ—è¡¨æ»šåŠ¨æ—¶å‡ºç°çš„ç©ºç™½åŒºåŸŸã€‚
- onLoadï¼šæµ‹é‡åˆ—è¡¨åŠ è½½æ—¶é—´ã€‚

æ›´å¤šå¯ç”¨çš„è¾…åŠ©å·¥å…·å¯ä»¥å‚è€ƒæ–‡æ¡£ä¸­çš„ Metrics éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•ä¼˜åŒ–å’Œåˆ†æåˆ—è¡¨æ€§èƒ½ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ BamLab çš„ Flashlight å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ç”Ÿæˆ FPS çš„æ€§èƒ½æŠ¥å‘Šã€‚åŒæ—¶ï¼Œå®ƒè¿˜èƒ½ç»˜åˆ¶å‡ºä¸€æ®µæ—¶é—´å†…çš„ CPU ä½¿ç”¨å›¾è¡¨ï¼Œè®©æˆ‘ä»¬èƒ½å¤ŸéªŒè¯ç‰¹å®šæ“ä½œå¯¹è¯¥æŒ‡æ ‡çš„å½±å“ã€‚

ç›®å‰ï¼ŒFlashlight ä»…æ”¯æŒ Androidï¼Œä½†å¼€å‘å›¢é˜Ÿæ­£åœ¨åŠªåŠ›å®ç°å¯¹ iOS çš„æ”¯æŒã€‚

![flashlist](flashlist.png)

ä½¿ç”¨ Flashlight æ— éœ€åœ¨åº”ç”¨ä¸­å®‰è£…ä»»ä½•å†…å®¹ï¼Œä½¿å¾—è¯¥å·¥å…·æ›´åŠ æ˜“äºä½¿ç”¨ã€‚å®ƒè¿˜å¯ä»¥æµ‹é‡ç”Ÿäº§ç¯å¢ƒåº”ç”¨çš„æ€§èƒ½ï¼Œå¹¶ç”Ÿæˆéå¸¸ç¾è§‚çš„ç½‘é¡µæŠ¥å‘Šï¼Œè¿™äº›æŠ¥å‘ŠåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š
- æ€» CPU ä½¿ç”¨ç‡
- æ¯ä¸ªçº¿ç¨‹çš„ CPU ä½¿ç”¨ç‡
- RAM åˆ©ç”¨ç‡

ä½¿ç”¨ Flashlight æœ‰ä¸¤ç§æ–¹å¼ï¼šæ‚¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œï¼š
- `â€¢ curl https://get.flashlight.dev | bash `
- æˆ–è€…é€šè¿‡ flashlight.dev åœ¨äº‘ç«¯è¿è¡Œã€‚

é€šè¿‡ä½¿ç”¨ä¸“ç”¨ç»„ä»¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°†å§‹ç»ˆä»¥æœ€å¿«çš„é€Ÿåº¦è¿è¡Œã€‚æ‚¨å¯ä»¥è‡ªåŠ¨åˆ©ç”¨ React Native æä¾›çš„æ‰€æœ‰æ€§èƒ½ä¼˜åŒ–ï¼Œå¹¶è®¢é˜…æœªæ¥çš„æ›´æ–°ã€‚åŒæ—¶ï¼Œæ‚¨è¿˜èŠ‚çœäº†å¤§é‡ä»å¤´é‡æ–°å®ç°å¸¸è§ UI æ¨¡å¼çš„æ—¶é—´ï¼Œæ¯”å¦‚ç²˜æ€§åˆ†æ®µæ ‡é¢˜å’Œä¸‹æ‹‰åˆ·æ–°ç­‰åŠŸèƒ½ã€‚å¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨ FlashListï¼Œè¿™äº›åŠŸèƒ½å·²é»˜è®¤æ”¯æŒã€‚

### ç¬¬ä¸‰èŠ‚ åœ¨é€‰æ‹©å¤–éƒ¨åº“ä¹‹å‰è¯·ä¸‰æ€è€Œåè¡Œã€‚
> ä½¿ç”¨æ­£ç¡®çš„ JavaScript åº“å¯ä»¥å¸®åŠ©æ‚¨æå‡åº”ç”¨çš„é€Ÿåº¦å’Œæ€§èƒ½ã€‚

#### é—®é¢˜ï¼šæ‚¨åœ¨æœªæ£€æŸ¥åº“å†…å®¹çš„æƒ…å†µä¸‹é€‰æ‹©äº†åº“ã€‚

JavaScript å¼€å‘å°±åƒæ˜¯ç”¨å°å‹æ¨¡å—æ­å»ºåº”ç”¨ç¨‹åºï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œè¿™ä¸æ„å»º React Native åº”ç”¨éå¸¸ç›¸ä¼¼ã€‚ä¸å…¶ä»å¤´åˆ›å»º React ç»„ä»¶ï¼Œå¼€å‘è€…é€šå¸¸ä¼šå¯»æ‰¾èƒ½å¤Ÿå¸®åŠ©å®ç°ç›®æ ‡çš„ JavaScript åº“ã€‚JavaScript ç”Ÿæ€ç³»ç»Ÿæå€¡è¿™ç§å¼€å‘æ–¹å¼ï¼Œå¹¶é¼“åŠ±å›´ç»•å°è€Œå¯é‡ç”¨çš„æ¨¡å—æ¥æ„å»ºåº”ç”¨ç¨‹åºã€‚

è¿™ç§ç”Ÿæ€ç³»ç»Ÿå…·æœ‰è®¸å¤šä¼˜åŠ¿ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›ä¸¥é‡çš„ç¼ºé™·ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯å¼€å‘è€…åœ¨é¢å¯¹æ”¯æŒç›¸åŒåŠŸèƒ½çš„å¤šä¸ªåº“æ—¶ï¼Œå¾€å¾€éš¾ä»¥é€‰æ‹©ã€‚åœ¨ä¸ºä¸‹ä¸€ä¸ªé¡¹ç›®é€‰æ‹©åº“æ—¶ï¼Œä»–ä»¬é€šå¸¸ä¼šç ”ç©¶ä¸€äº›æŒ‡æ ‡ï¼Œæ¯”å¦‚ GitHub æ˜Ÿæ ‡æ•°ã€é—®é¢˜æ•°é‡ã€è´¡çŒ®è€…æ•°é‡ä»¥åŠ PR æ´»è·ƒåº¦ï¼Œä»¥åˆ¤æ–­åº“æ˜¯å¦å¥åº·ä¸”ç»´æŠ¤è‰¯å¥½ã€‚

ç„¶è€Œï¼Œä»–ä»¬å¾€å¾€å¿½ç•¥äº†åº“çš„å¤§å°ã€æ”¯æŒçš„åŠŸèƒ½æ•°é‡ä»¥åŠå¤–éƒ¨ä¾èµ–ã€‚å¼€å‘è€…å‡è®¾ï¼Œæ—¢ç„¶ React Native æ˜¯åŸºäº JavaScript å¹¶æ‹¥æŠ±ç°æœ‰å·¥å…·é“¾çš„ï¼Œä»–ä»¬å¯ä»¥æŒ‰ç…§å¼€å‘ Web åº”ç”¨çš„çº¦æŸå’Œæœ€ä½³å®è·µè¿›è¡Œæ“ä½œã€‚

äº‹å®ä¸Šï¼Œè¿™ç§å‡è®¾å¹¶ä¸æˆç«‹ï¼Œå› ä¸ºç§»åŠ¨å¼€å‘ä¸ Web å¼€å‘æœ¬è´¨ä¸Šæ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„ä¸€å¥—è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œåœ¨ Web åº”ç”¨ä¸­ï¼Œèµ„æºæ–‡ä»¶çš„å¤§å°è‡³å…³é‡è¦ï¼Œè€Œåœ¨ React Native ä¸­ï¼Œèµ„æºæ–‡ä»¶å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå…¶é‡è¦æ€§å¹¶ä¸ç›¸åŒã€‚

å…³é”®åŒºåˆ«åœ¨äºç§»åŠ¨è®¾å¤‡çš„æ€§èƒ½ä»¥åŠç”¨äºæ‰“åŒ…å’Œç¼–è¯‘åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚è™½ç„¶è®¾å¤‡æ€§èƒ½é™åˆ¶æ˜¯æ— æ³•ç›´æ¥æ”¹å˜çš„ï¼Œä½†æ‚¨å¯ä»¥æ§åˆ¶è‡ªå·±çš„ JavaScript ä»£ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»£ç è¶Šå°‘ï¼Œå¯åŠ¨æ—¶é—´å°±è¶Šå¿«ã€‚è€Œå½±å“ä»£ç æ•´ä½“å¤§å°çš„æœ€é‡è¦å› ç´ ä¹‹ä¸€å°±æ˜¯æ‰€é€‰çš„åº“ã€‚

##### å¤æ‚çš„åº“ä¼šå‰Šå¼±åº”ç”¨ç¨‹åºçš„é€Ÿåº¦

ä¸å®Œå…¨åŸç”Ÿçš„åº”ç”¨ç¨‹åºä¸åŒï¼ŒReact Native åº”ç”¨åŒ…å«ä¸€ä¸ªéœ€è¦åŠ è½½åˆ°å†…å­˜ä¸­çš„ JavaScript åŒ…ã€‚éšåï¼Œè¿™äº›ä»£ç ä¼šè¢« JavaScript è™šæ‹Ÿæœºè§£æå’Œæ‰§è¡Œã€‚å› æ­¤ï¼ŒJavaScript ä»£ç çš„æ€»ä½“å¤§å°æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚

![nterpretation with conventional engine engine](nativemodules.png)

åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨ä¼šä¿æŒåœ¨åŠ è½½çŠ¶æ€ã€‚æˆ‘ä»¬é€šå¸¸å°†è¿™ä¸€è¿‡ç¨‹ç§°ä¸º TTIï¼ˆTime to Interactiveï¼‰ï¼Œå³ä»ç‚¹å‡»åº”ç”¨å›¾æ ‡åˆ°åº”ç”¨å®Œå…¨å¯äº¤äº’ä¹‹é—´çš„æ—¶é—´ï¼Œé€šå¸¸ä»¥æ¯«ç§’ä¸ºå•ä½è¡¡é‡ï¼ˆå¸Œæœ›å°½é‡çŸ­ï¼‰ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œé»˜è®¤çš„ React Native æ‰“åŒ…å·¥å…· Metro ç›®å‰ä¸æ”¯æŒ Tree Shakingï¼ˆæ ‘æ‘‡ä¼˜åŒ–ï¼‰ã€‚å¦‚æœæ‚¨å¯¹è¿™ä¸€æ¦‚å¿µä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥é˜…è¯»ç›¸å…³æ–‡ç« è¿›è¡Œäº†è§£ã€‚

è¿™æ„å‘³ç€ï¼Œä» NPM æ‹‰å–å¹¶å¯¼å…¥åˆ°é¡¹ç›®ä¸­çš„æ‰€æœ‰ä»£ç éƒ½ä¼šåŒ…å«åœ¨ç”Ÿäº§ç¯å¢ƒçš„ JavaScript åŒ…ä¸­ï¼ŒåŠ è½½åˆ°å†…å­˜å¹¶è¢«è§£æã€‚è¿™å¯èƒ½ä¼šå¯¹åº”ç”¨çš„æ€»å¯åŠ¨æ—¶é—´äº§ç”Ÿè´Ÿé¢å½±å“ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Hermes å¼•æ“ æ—¶æƒ…å†µæœ‰æ‰€ä¸åŒï¼Œå®ƒä¼šè‡ªåŠ¨å°†æ‰€éœ€çš„å­—èŠ‚ç åˆ†é¡µåŠ è½½åˆ°å†…å­˜ä¸­ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… Hermes ç« èŠ‚ã€‚

##### å¦‚ä½•åˆ†æåŒ…çš„å¤§å°

å¯†åˆ‡å…³æ³¨åŒ…çš„å¤§å°éå¸¸é‡è¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ react-native-bundle-visualizer é€šè¿‡ GUI æ¥åˆ†æåŒ…çš„å†…å®¹ã€‚é€šè¿‡è¯¥å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è¯¦ç»†äº†è§£åŒ…ä¸­æ·»åŠ çš„ä»»ä½•åº“ï¼Œä»è€Œå†³å®šæ˜¯å¦å€¼å¾—ä¿ç•™æˆ–ç§»é™¤è¯¥åº“ã€‚è¯¥å·¥å…·ä¼šæ ¹æ®åº”ç”¨åŒ…ç”Ÿæˆå¦‚ä¸‹å½¢å¼çš„è¾“å‡ºï¼š

![memory](memory.png)

#### è§£å†³æ–¹æ¡ˆï¼šæ›´åŠ ç²¾æŒ‘ç»†é€‰ï¼Œä½¿ç”¨æ›´å°å‹ã€æ›´ä¸“ç”¨çš„åº“ã€‚

è§£å†³è¿™ä¸€é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä»ä¸€å¼€å§‹å°±ä¸ºé¡¹ç›®è®¾è®¡åˆé€‚çš„æ¶æ„ç­–ç•¥ã€‚

å¦‚æœæ‚¨æ‰“ç®—å¼•å…¥ä¸€ä¸ªå¤æ‚çš„åº“ï¼Œè¯·å…ˆæ£€æŸ¥æ˜¯å¦æœ‰æ›´å°çš„æ›¿ä»£åº“å¯ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚

ä¾‹å¦‚ï¼šæ—¥æœŸæ“ä½œæ˜¯æœ€å¸¸è§çš„æ“ä½œä¹‹ä¸€ã€‚å‡è®¾æ‚¨éœ€è¦è®¡ç®—æ—¶é—´çš„å·®å€¼ï¼Œä¸å…¶å¼•å…¥æ•´ä¸ª `moment.js` åº“ï¼ˆ67.9 KBï¼‰æ¥è§£ææ—¥æœŸï¼Œä¸å¦‚é€‰æ‹©æ›´è½»é‡çš„æ›¿ä»£æ–¹æ¡ˆã€‚

```javascript
import moment from 'moment';

const date = moment('12-25-1995', 'MM-DD-YYYY');
```
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ day.jsï¼ˆä»… 2KBï¼‰ï¼Œå®ƒä½“ç§¯æ›´å°ï¼Œä»…æä¾›æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ã€‚

```javascript
import dayjs from 'dayjs';

const date = dayjs('12-25-1995', 'MM-DD-YYYY');
```
å¦‚æœæ²¡æœ‰æ›¿ä»£åº“ï¼Œä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™æ˜¯æ£€æŸ¥æ˜¯å¦å¯ä»¥åªå¯¼å…¥åº“çš„ä¸€éƒ¨åˆ†ã€‚

ä¾‹å¦‚ï¼Œè®¸å¤šåº“ï¼ˆå¦‚ lodashï¼‰å·²ç»æ‹†åˆ†æˆæ›´å°çš„å·¥å…·é›†ï¼Œå¹¶æ”¯æŒæ— æ³•è¿›è¡Œæ­»ä»£ç æ¶ˆé™¤çš„ç¯å¢ƒã€‚

å‡è®¾æ‚¨éœ€è¦ä½¿ç”¨ lodash çš„ map æ–¹æ³•ï¼Œä¸å…¶å¯¼å…¥æ•´ä¸ªåº“ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼š
```javascript
import { map } from 'lodash';

const square = (x) => x * x;
map([4, 8], square);
```
æ‚¨å¯ä»¥ä»…å¯¼å…¥å•ä¸ªæ¨¡å—åŒ…ï¼š
```javascript
import map from 'lodash/map';

const square = (x) => x * x;
map([4, 8], square);
```
è¿™æ ·ï¼Œæ‚¨å¯ä»¥äº«å—åˆ° lodash åŒ…ä¸­çš„ç‰¹å®šå·¥å…·ï¼Œè€Œæ— éœ€å°†æ•´ä¸ªåº“åŠ è½½åˆ°åº”ç”¨ç¨‹åºçš„åŒ…ä¸­ã€‚

å¦‚æœæ‚¨å¸Œæœ›éšæ—¶äº†è§£ä¾èµ–é¡¹å¯¹åŒ…å¤§å°çš„å½±å“ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èä½¿ç”¨ import-cost çš„ VSCode æ’ä»¶ï¼Œæˆ–è€…è®¿é—® Bundlephobia ç½‘ç«™è¿›è¡Œæ£€æŸ¥ã€‚

#### ä¼˜åŠ¿ï¼šæ‚¨çš„åº”ç”¨å ç”¨æ›´å°ï¼ŒåŠ è½½é€Ÿåº¦æ›´å¿«ã€‚

ç§»åŠ¨ç«¯æ˜¯ä¸€ä¸ªç«äº‰å¼‚å¸¸æ¿€çƒˆçš„ç¯å¢ƒï¼Œä¼—å¤šåº”ç”¨éƒ½æ—¨åœ¨å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå¹¶äº‰å¤ºåŒæ ·çš„ç”¨æˆ·ç¾¤ä½“ã€‚æ›´å¿«çš„å¯åŠ¨æ—¶é—´ã€æ›´æµç•…çš„äº¤äº’ä»¥åŠæ•´ä½“çš„è§†è§‰å’Œæ“ä½œä½“éªŒï¼Œå¯èƒ½æ˜¯æ‚¨è„±é¢–è€Œå‡ºçš„å”¯ä¸€é€”å¾„ã€‚

æ‚¨ä¸åº”ä½ä¼°é€‰æ‹©åˆé€‚åº“çš„é‡è¦æ€§ã€‚å¯¹ç¬¬ä¸‰æ–¹ä¾èµ–çš„é€‰æ‹©æ›´ä¸ºè°¨æ…ï¼Œèµ·åˆå¯èƒ½çœ‹ä¼¼æ— å…³ç´§è¦ã€‚ä½†æ‰€æœ‰èŠ‚çœä¸‹æ¥çš„æ¯«ç§’æ—¶é—´ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå°†ç´¯è®¡æˆä¸ºæ˜¾è‘—çš„ä¼˜åŠ¿ã€‚

### ç¬¬å››èŠ‚ å§‹ç»ˆè®°å¾—ä½¿ç”¨ä¸“ä¸ºç§»åŠ¨å¹³å°è®¾è®¡çš„åº“ã€‚

> ä½¿ç”¨ä¸“ä¸ºç§»åŠ¨å¹³å°è®¾è®¡çš„åº“ï¼Œå¯åŒæ—¶åœ¨å¤šä¸ªå¹³å°ä¸Šæ›´å¿«åœ°æ„å»ºåŠŸèƒ½ï¼ŒåŒæ—¶ä¸å½±å“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

#### é—®é¢˜ï¼šæ‚¨ä½¿ç”¨äº†æœªé’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–çš„ Web åº“ã€‚
å¦‚å‰æ‰€è¿°ï¼ŒReact Native çš„æœ€å¤§ä¼˜åŠ¿ä¹‹ä¸€æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ JavaScript ç¼–å†™ç§»åŠ¨åº”ç”¨ï¼Œé‡ç”¨éƒ¨åˆ† React ç»„ä»¶ï¼Œå¹¶ç»“åˆæ‚¨å–œçˆ±çš„çŠ¶æ€ç®¡ç†åº“å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚

å°½ç®¡ React Native æä¾›äº†ç±»ä¼¼ Web çš„åŠŸèƒ½ä»¥å®ç°ä¸ Web çš„å…¼å®¹æ€§ï¼Œä½†é‡è¦çš„æ˜¯è¦ç†è§£å®ƒå¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„è¿è¡Œç¯å¢ƒã€‚React Native æœ‰è‡ªå·±çš„ä¸€å¥—æœ€ä½³å®è·µã€å¿«é€Ÿä¼˜åŒ–æ–¹å¼å’Œçº¦æŸæ¡ä»¶ã€‚

ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ— éœ€è¿‡å¤šæ‹…å¿ƒåº”ç”¨å¯¹ CPU èµ„æºçš„æ•´ä½“éœ€æ±‚ã€‚æ¯•ç«Ÿï¼Œå¤§å¤šæ•°ç½‘ç«™éƒ½è¿è¡Œåœ¨è¿æ¥ç”µæºæˆ–é…å¤‡å¤§å®¹é‡ç”µæ± çš„è®¾å¤‡ä¸Šã€‚

ç„¶è€Œï¼Œç§»åŠ¨ç«¯çš„æƒ…å†µåˆ™å®Œå…¨ä¸åŒã€‚ç§»åŠ¨è®¾å¤‡çš„ç§ç±»ç¹å¤šï¼Œæ¶æ„å’Œå¯ç”¨èµ„æºå„å¼‚ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›è®¾å¤‡ä¾èµ–ç”µæ± è¿è¡Œï¼Œè€Œåº”ç”¨ç¨‹åºçš„è€—ç”µé‡é€šå¸¸æ˜¯å¼€å‘è€…éœ€è¦é‡ç‚¹è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ã€‚

æ¢å¥è¯è¯´â€”â€”ä¼˜åŒ–å‰å°å’Œåå°çš„ç”µæ± æ¶ˆè€—æ–¹å¼ï¼Œå¯èƒ½ä¼šå¯¹åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒäº§ç”Ÿå†³å®šæ€§çš„å½±å“ã€‚

##### æœªä¼˜åŒ–çš„åº“ä¼šå¯¼è‡´ç”µæ± æ¶ˆè€—åŠ å‰§å¹¶å‡æ…¢åº”ç”¨é€Ÿåº¦ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šé™åˆ¶æ‚¨çš„åº”ç”¨åŠŸèƒ½ã€‚

è™½ç„¶ React Native å…è®¸åœ¨ç§»åŠ¨ç«¯è¿è¡Œä¸æµè§ˆå™¨ä¸­ç›¸åŒçš„ JavaScriptï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨åº”è¯¥æ¯æ¬¡éƒ½è¿™æ ·åšã€‚å’Œä»»ä½•è§„åˆ™ä¸€æ ·ï¼Œæ€»æœ‰ä¾‹å¤–ã€‚

å¦‚æœåº“ä¸¥é‡ä¾èµ–ç½‘ç»œï¼ˆå¦‚å®æ—¶æ¶ˆæ¯ä¼ é€’ï¼‰æˆ–éœ€è¦æ¸²æŸ“é«˜çº§å›¾å½¢ï¼ˆå¦‚ 3D ç»“æ„ã€å›¾è¡¨ï¼‰ï¼Œé€šå¸¸æ›´é€‚åˆé€‰æ‹©ä¸“ä¸ºç§»åŠ¨ç«¯è®¾è®¡çš„åº“ã€‚

ç§»åŠ¨ç«¯åº“æœ€åˆåœ¨ Web ç¯å¢ƒä¸­å¼€å‘ï¼Œå‡è®¾äº†æµè§ˆå™¨çš„èƒ½åŠ›å’Œé™åˆ¶ã€‚å¦‚æœä½¿ç”¨æµè¡Œ SDK çš„ Web ç‰ˆæœ¬ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„ CPU å’Œå†…å­˜æ¶ˆè€—ã€‚

æŸäº›æ“ä½œç³»ç»Ÿï¼ˆå¦‚ iOSï¼‰ä»¥ä¸æ–­åˆ†æåº”ç”¨èµ„æºæ¶ˆè€—è€Œé—»åï¼Œå…¶ç›®çš„æ˜¯ä¼˜åŒ–ç”µæ± å¯¿å‘½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨æ³¨å†Œäº†åå°æ´»åŠ¨ï¼Œä½†è¿™äº›æ´»åŠ¨æ¶ˆè€—äº†è¿‡å¤šèµ„æºï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šè°ƒæ•´åº”ç”¨çš„åå°è¿è¡Œé—´éš”ï¼Œä»è€Œé™ä½æ‚¨æœ€åˆæœŸæœ›çš„åå°æ›´æ–°é¢‘ç‡ã€‚

#### è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä¸“é—¨ä¸ºç‰¹å®šå¹³å°è®¾è®¡çš„åº“ç‰ˆæœ¬ã€‚

ä»¥ Firebase ä¸ºä¾‹ï¼ŒFirebase æ˜¯è°·æ­Œæä¾›çš„ä¸€ä¸ªç§»åŠ¨å¹³å°ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ›´å¿«é€Ÿåœ°æ„å»ºåº”ç”¨ã€‚å®ƒæ˜¯ç”±ä¸€ç³»åˆ—å·¥å…·å’Œåº“ç»„æˆçš„ï¼Œèƒ½å¤Ÿåœ¨æ‚¨çš„åº”ç”¨ä¸­å³æ—¶å¯ç”¨æŸäº›åŠŸèƒ½ã€‚

Firebase æä¾›äº†é€‚ç”¨äº Web å’Œç§»åŠ¨ç«¯ï¼ˆåˆ†åˆ«æ˜¯ iOS å’Œ Androidï¼‰çš„ SDKã€‚æ¯ä¸ª SDK éƒ½æ”¯æŒ Realtime Databaseï¼ˆå®æ—¶æ•°æ®åº“ï¼‰ã€‚

![firebase](firebase.png)

å¾—ç›Šäº React Nativeï¼Œæ‚¨å¯ä»¥è¿è¡Œå…¶ Web ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¸ä¼šé‡åˆ°å¤§çš„é—®é¢˜ï¼š

```javascript
import { getDatabase, onValue, ref } from firebasedatabase;

const database = getDatabase();

onValue(ref(database, î€¯users123î€¯), (snapshot) => {
    console.log(snapshot.val());
})
```
ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯æ‚¨åº”è¯¥é€‰æ‹©çš„åšæ³•ã€‚è™½ç„¶ä¸Šè¿°ç¤ºä¾‹å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†å…¶æ€§èƒ½å¹¶ä¸å¦‚ç§»åŠ¨ç«¯ç‰ˆæœ¬ã€‚æ­¤å¤–ï¼ŒWeb ç‰ˆæœ¬çš„ SDK æ‰€åŒ…å«çš„åŠŸèƒ½ä¹Ÿæ›´å°‘â€”â€”è¿™å¹¶ä¸æ„å¤–ï¼Œå› ä¸º Web ç¯å¢ƒä¸ç§»åŠ¨ç«¯ä¸åŒï¼Œå› æ­¤ Firebase.js ä¸ä¼šæ”¯æŒç§»åŠ¨ç«¯çš„ä¸“ç”¨åŠŸèƒ½ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸“ç”¨çš„ Firebase åº“æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è¿™äº›åº“åœ¨åŸç”Ÿ SDK çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€å±‚è½»é‡å°è£…ï¼Œèƒ½å¤Ÿå®ç°ä¸å…¶ä»–åŸç”Ÿåº”ç”¨ç›¸åŒçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

![React Native Firebase](react-firebase.png)
ä»¥ä¸‹æ˜¯ä¸Šè¿°ç¤ºä¾‹çš„å®ç°æ–¹å¼ï¼š
```javascript
import database from '@react-native-firebasedatabase';

database().ref('users123').on('value', (snapshot) => {
    console.log(snapshot.val());
});
```
å¦‚æ‚¨æ‰€è§ï¼Œå·®å¼‚éå¸¸å°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº“çš„ä½œè€…åœ¨æ¨¡ä»¿ API æ–¹é¢åšå¾—éå¸¸å‡ºè‰²ï¼Œä»è€Œå‡å°‘äº†åœ¨ Web å’Œç§»åŠ¨ç«¯ç¯å¢ƒä¹‹é—´åˆ‡æ¢æ—¶å¯èƒ½äº§ç”Ÿçš„å›°æƒ‘ã€‚

#### ä¼˜åŠ¿ï¼šæä¾›æœ€å¿«é€Ÿã€æ€§èƒ½æœ€ä½³çš„æ”¯æŒï¼ŒåŒæ—¶ä¸æŸå®³ç”µæ± å¯¿å‘½ã€‚
React Native çš„æ ¸å¿ƒç†å¿µæ˜¯ä¸ºæ‚¨æä¾›æ„å»ºåº”ç”¨çš„æ§åˆ¶æƒå’Œè‡ªç”±åº¦ã€‚

å¯¹äºç®€å•çš„éœ€æ±‚å’Œæœ€å¤§åŒ–çš„ä»£ç å¤ç”¨ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨åº“çš„ Web ç‰ˆæœ¬ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿä»¥è¾ƒä½çš„å¼€å‘æˆæœ¬è®¿é—®ä¸æµè§ˆå™¨ä¸­ç›¸åŒçš„åŠŸèƒ½ã€‚

å¯¹äºæ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°é€šè¿‡åŸç”ŸåŠŸèƒ½æ‰©å±• React Nativeï¼Œå¹¶ç›´æ¥ä¸ç§»åŠ¨ç«¯ SDK äº¤äº’ã€‚è¿™ç§â€œé€ƒç”Ÿèˆ±å£â€æ­£æ˜¯ React Native å˜å¾—é«˜åº¦çµæ´»ä¸”é€‚åˆä¼ä¸šçº§åº”ç”¨çš„åŸå› ã€‚

å®ƒè®©æ‚¨èƒ½å¤ŸåŒæ—¶åœ¨å¤šä¸ªå¹³å°ä¸Šæ›´å¿«é€Ÿåœ°æ„å»ºåŠŸèƒ½ï¼Œè€Œä¸å½±å“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒâ€”â€”è¿™æ˜¯å…¶ä»–æ··åˆæ¡†æ¶æ— æ³•ä¼åŠçš„ã€‚

### ç¬¬äº”èŠ‚ åœ¨åŸç”Ÿä¸ JavaScript ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚

> åœ¨åŸç”Ÿä¸ JavaScript ä¹‹é—´å¯»æ±‚å’Œè°ï¼Œä»¥æ„å»ºé«˜æ•ˆè¿è¡Œä¸”ç»´æŠ¤æˆæœ¬ä½çš„åº”ç”¨ã€‚

#### é—®é¢˜ï¼šåœ¨å¼€å‘åŸç”Ÿæ¨¡å—æ—¶ï¼Œæ‚¨åœ¨åŸç”Ÿä¸ JavaScript æŠ½è±¡ä¹‹é—´åˆ’åˆ†çš„ç•Œé™ä¸å½“ã€‚

åœ¨ä½¿ç”¨ React Native æ—¶ï¼Œæ‚¨å¤§éƒ¨åˆ†æ—¶é—´ä¼šç¼–å†™ JavaScriptã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€äº›åŸç”Ÿä»£ç ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ SDK å°šæœªæä¾›å®˜æ–¹çš„ React Native æ”¯æŒæ—¶ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŸç”Ÿæ¨¡å—ï¼Œå°†åº•å±‚åŸç”Ÿæ–¹æ³•å°è£…å¹¶å¯¼å‡ºåˆ° React Native ç¯å¢ƒä¸­ã€‚

æ‰€æœ‰åŸç”Ÿæ–¹æ³•éƒ½éœ€è¦å®é™…çš„å‚æ•°æ¥è¿è¡Œã€‚React Native åŸºäºä¸€ç§åä¸º æ¡¥ï¼ˆbridgeï¼‰ çš„æŠ½è±¡å±‚æ„å»ºï¼Œè¯¥æ¡¥æä¾›äº† JavaScript å’ŒåŸç”Ÿä¸–ç•Œä¹‹é—´çš„åŒå‘é€šä¿¡ã€‚

***æ³¨æ„ï¼šç›®å‰æ­£åœ¨åŠªåŠ›å°†å¼‚æ­¥æ¡¥æ¥é€šä¿¡è½¬å‘åŒæ­¥é€šä¿¡ã€‚æ‚¨å¯ä»¥åœ¨ New Architectureï¼ˆæ–°æ¶æ„ï¼‰ ç« èŠ‚ä¸­äº†è§£æ›´å¤šç›¸å…³å†…å®¹ã€‚***

å› æ­¤ï¼ŒJavaScript å¯ä»¥æ‰§è¡ŒåŸç”Ÿ APIï¼Œå¹¶ä¼ é€’å¿…è¦çš„ä¸Šä¸‹æ–‡ä»¥æ¥æ”¶æœŸæœ›çš„è¿”å›å€¼ã€‚è¿™ç§é€šä¿¡æœ¬èº«æ˜¯å¼‚æ­¥çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è°ƒç”¨æ–¹åœ¨ç­‰å¾…æ¥è‡ªåŸç”Ÿç«¯çš„ç»“æœæ—¶ï¼ŒJavaScript ä»ç„¶åœ¨è¿è¡Œï¼Œå¹¶å¯èƒ½å·²ç»å¼€å§‹å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚

![bridge](jsi.png)

é€šè¿‡æ¡¥æ¥ä¼ é€’çš„ JavaScript è°ƒç”¨æ•°é‡å¹¶ä¸æ˜¯ç¡®å®šçš„ï¼Œä¼šéšç€åº”ç”¨ä¸­çš„äº¤äº’æ•°é‡è€Œå˜åŒ–ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦æ—¶é—´ï¼Œå› ä¸º JavaScript çš„å‚æ•°éœ€è¦è¢«åºåˆ—åŒ–ä¸º JSON æ ¼å¼ï¼Œè¿™æ˜¯ä¸¤ç«¯å¯ä»¥ç†è§£çš„é€šç”¨æ ¼å¼ã€‚

ä¾‹å¦‚ï¼Œå½“æ¡¥æ¥æ­£å¿™äºå¤„ç†æ•°æ®æ—¶ï¼Œå¦ä¸€ä¸ªè°ƒç”¨å¯èƒ½ä¼šè¢«é˜»å¡å¹¶éœ€è¦ç­‰å¾…ã€‚å¦‚æœè¯¥äº¤äº’ä¸æ‰‹åŠ¿æˆ–åŠ¨ç”»ç›¸å…³ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°ä¸¢å¸§çš„æƒ…å†µâ€”â€”æ“ä½œæœªèƒ½åŠæ—¶å®Œæˆï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·ç•Œé¢å‡ºç°å¡é¡¿ç°è±¡ã€‚

![bridge](jsi2.png)

æŸäº›åº“ï¼ˆä¾‹å¦‚ Animatedï¼‰æä¾›äº†ç‰¹æ®Šçš„è§£å†³æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ NativeDriverï¼Œå®ƒä¼šå°†åŠ¨ç”»åºåˆ—åŒ–ï¼Œå¹¶åœ¨åŠ¨ç”»å¼€å§‹æ—¶ä¸€æ¬¡æ€§ä¼ é€’ç»™åŸç”Ÿçº¿ç¨‹ã€‚åœ¨åŠ¨ç”»è¿è¡ŒæœŸé—´ï¼Œä¸ä¼šé€šè¿‡æ¡¥æ¥è¿›è¡Œé€šä¿¡ï¼Œä»è€Œé¿å…äº†åœ¨æ‰§è¡Œå…¶ä»–ä»»åŠ¡æ—¶å¯èƒ½å¯¼è‡´çš„å¸§ä¸¢å¤±ã€‚

å› æ­¤ï¼Œä¿æŒæ¡¥æ¥é€šä¿¡çš„é«˜æ•ˆå’Œå¿«é€Ÿéå¸¸é‡è¦ã€‚

##### æ¡¥æ¥é€šä¿¡çš„æµé‡è¶Šå¤šï¼Œç•™ç»™å…¶ä»–ä»»åŠ¡çš„ç©ºé—´å°±è¶Šå°‘ã€‚

é€šè¿‡æ¡¥æ¥ä¼ é€’æ›´å¤šæµé‡æ„å‘³ç€ React Native åœ¨è¯¥æ—¶åˆ»å¯ç”¨äºä¼ è¾“å…¶ä»–é‡è¦å†…å®¹çš„ç©ºé—´ä¼šå‡å°‘ã€‚ç»“æœï¼Œæ‚¨çš„åº”ç”¨åœ¨æ‰§è¡ŒåŸç”Ÿè°ƒç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¹æ‰‹åŠ¿æˆ–å…¶ä»–äº¤äº’å˜å¾—ä¸å¤Ÿå“åº”ã€‚

å¦‚æœæ‚¨åœ¨é€šè¿‡æ¡¥æ¥æ‰§è¡ŒæŸäº›åŸç”Ÿè°ƒç”¨æ—¶ï¼Œå‘ç°ç”¨æˆ·ç•Œé¢æ€§èƒ½ä¸‹é™æˆ– CPU æ¶ˆè€—æ˜¾è‘—å¢åŠ ï¼Œæ‚¨åº”è¯¥ä»”ç»†æ£€æŸ¥è‡ªå·±å¯¹å¤–éƒ¨åº“çš„ä½¿ç”¨æƒ…å†µã€‚å¾ˆå¯èƒ½ä¼ è¾“çš„æ•°æ®é‡è¶…å‡ºäº†å®é™…éœ€è¦çš„èŒƒå›´ã€‚

#### è§£å†³æ–¹æ¡ˆï¼šåœ¨ JavaScript ç«¯ä½¿ç”¨é€‚å½“çš„æŠ½è±¡å±‚â€”â€”æå‰éªŒè¯å’Œæ£€æŸ¥æ•°æ®ç±»å‹ã€‚

åœ¨æ„å»ºåŸç”Ÿæ¨¡å—æ—¶ï¼Œç›´æ¥å°†è°ƒç”¨ä»£ç†åˆ°åŸç”Ÿç«¯å¹¶è®©å…¶å®Œæˆå…¶ä½™æ“ä½œæ˜¯å¾ˆè¯±äººçš„åšæ³•ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚å‚æ•°æ— æ•ˆï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ¡¥æ¥å¾€è¿”è°ƒç”¨ï¼Œä»…ä»…æ˜¯ä¸ºäº†å‘ç°æˆ‘ä»¬æä¾›çš„å‚æ•°ä¸æ­£ç¡®ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç›´æ¥å°†è°ƒç”¨ä»£ç†åˆ°åº•å±‚åŸç”Ÿæ¨¡å—çš„ JavaScript æ¨¡å—ç¤ºä¾‹ï¼š

```javascript
import { NativeModules } from 'react-native';
const { ToastExample } = NativeModules;

export const show = (message, duration) => {
    ToastExample.show(message, duration);
};
```
å¦‚æœå‚æ•°ä¸æ­£ç¡®æˆ–ç¼ºå¤±ï¼ŒåŸç”Ÿæ¨¡å—å¾ˆå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å½“å‰ç‰ˆæœ¬çš„ React Native å¹¶æœªæä¾›ä¸€ç§æŠ½è±¡æœºåˆ¶æ¥ç¡®ä¿ JavaScript å‚æ•°ä¸åŸç”Ÿä»£ç æ‰€éœ€çš„å‚æ•°ä¿æŒä¸€è‡´ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨ä¼šè¢«åºåˆ—åŒ–ä¸º JSONï¼Œä¼ é€’åˆ°åŸç”Ÿç«¯å¹¶æ‰§è¡Œã€‚å³ä½¿æœªä¼ é€’å®Œæˆæ‰€éœ€çš„å…¨éƒ¨å‚æ•°ï¼Œè¯¥æ“ä½œä»ä¼šå¼€å§‹ã€‚ç„¶è€Œï¼Œå½“åŸç”Ÿç«¯å¤„ç†è°ƒç”¨å¹¶ä»åŸç”Ÿæ¨¡å—æ¥æ”¶åˆ°å¼‚å¸¸æ—¶ï¼Œé”™è¯¯æ‰ä¼šè¢«æ•è·ã€‚

åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œæ‚¨æµªè´¹äº†ç­‰å¾…å¼‚å¸¸è¿”å›çš„æ—¶é—´ï¼Œè€Œè¿™äº›é—®é¢˜æœ¬å¯ä»¥åœ¨è°ƒç”¨ä¹‹å‰å°±æ£€æŸ¥åˆ°ã€‚

```javascript
import { NativeModules } from 'react-native';
const { ToastExample } = NativeModules;

export const show = (message, duration) => {
    if (typeof message !== 'string' || message.length > 100) {
        throw new Error('Invalid Toast content');
    }

    if (!Number.isInteger(duration) || duration > 20000) {
        throw new Error('Invalid Toast duration');
    }

    ToastExample.show(message, duration);
};
```

ä¸Šè¿°é—®é¢˜ä¸ä»…ä»…å±€é™äºåŸç”Ÿæ¨¡å—æœ¬èº«ã€‚åŒæ ·éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ª React Native çš„åŸç”Ÿç»„ä»¶éƒ½æœ‰å…¶å¯¹åº”çš„åŸç”Ÿå®ç°ï¼Œæ¯æ¬¡æ¸²æŸ“å‘ç”Ÿæ—¶ï¼Œç»„ä»¶çš„å±æ€§éƒ½ä¼šé€šè¿‡æ¡¥æ¥ä¼ é€’â€”â€”ä¸è¿‡ä¹Ÿä¸å®Œå…¨æ˜¯è¿™æ ·ã€‚åœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶å¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚

React Native çš„æ¸²æŸ“å™¨è¶³å¤Ÿæ™ºèƒ½ï¼Œå®ƒä¼šå¯¹ JavaScript ç«¯ React ç»„ä»¶å±‚çº§è¿›è¡Œâ€œdiffâ€æ“ä½œï¼Œä»…é€šè¿‡æ¡¥æ¥ä¼ é€’å¿…è¦çš„ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´æ–°åŸç”Ÿè§†å›¾å±‚çº§ã€‚

ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ style å±æ€§å¯¹ç»„ä»¶ï¼ˆå¦‚ View æˆ– Textï¼‰è¿›è¡Œæ ·å¼è®¾ç½®æ—¶ï¼Œä»…å˜åŒ–çš„éƒ¨åˆ†ä¼šè¢«ä¼ é€’ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨å†…è”æ ·å¼çš„ç¤ºä¾‹ï¼š

```javascript
import React from 'react';
import { View } from 'react-native';
const App = () => {
    return (
        <View
            style={{
                flex: 1,
                justifyContent: 'center',
                alignItems: 'center',
            }}>
                <View
                style={{
                    backgroundColor: 'coral',
                    width: 200,
                    height: 200,
                }}
                />
        </View>
    );
};
export default App;
```

å³ä½¿ style å±æ€§ä»¥å†…è”å¯¹è±¡çš„å½¢å¼ä¼ é€’ï¼Œå®ƒä¹Ÿä¸ä¼šå¼•å‘æ€§èƒ½é—®é¢˜ã€‚æ— è®ºæ˜¯åŸºäº props åŠ¨æ€æ›´æ”¹æ ·å¼ï¼Œè¿˜æ˜¯é‡æ–°æ¸²æŸ“ App ç»„ä»¶ï¼Œéƒ½ä¸ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ã€‚

View ä¼šå°†å…¶å±æ€§å‡ ä¹ç›´æ¥ä¼ é€’ç»™åº•å±‚çš„åŸç”Ÿè¡¨ç¤ºã€‚è€Œå¾—ç›Šäº React Native æ¸²æŸ“å™¨çš„ä¼˜åŒ–ï¼Œæ— è®ºæˆ‘ä»¬åœ¨ JavaScript ç«¯å¤šé¢‘ç¹é‡æ–°æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œåªæœ‰æ›´æ–° style å±æ€§æ‰€éœ€çš„æœ€å°æ•°æ®é‡ä¼šé€šè¿‡æ¡¥æ¥ä¼ é€’ã€‚è¿™ç§æœºåˆ¶æœ‰æ•ˆä¿è¯äº†æ€§èƒ½ï¼ŒåŒæ—¶å‡å°‘äº†æ¡¥æ¥é€šä¿¡çš„å¼€é”€ã€‚

åœ¨ React Native ä¸­ï¼Œæˆ‘ä»¬æœ‰æ›´ä¼˜é›…çš„æ–¹å¼å¤„ç†æ ·å¼ï¼Œé‚£å°±æ˜¯é€šè¿‡ StyleSheet APIã€‚å®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼äº CSS æ ·å¼è¡¨çš„ä¸“ç”¨æŠ½è±¡å·¥å…·ã€‚å°½ç®¡å®ƒåœ¨æ€§èƒ½ä¸Šæ²¡æœ‰ä¼˜åŠ¿ï¼Œä½†å®ƒå› å¼€å‘å’Œç»´æŠ¤çš„ä¾¿åˆ©æ€§è€Œå€¼å¾—ä¸€æã€‚

å½“æˆ‘ä»¬ä½¿ç”¨ TypeScript æˆ– Flow å¼€å‘åº”ç”¨æ—¶ï¼ŒStyleSheet æ˜¯ç±»å‹åŒ–çš„ï¼Œèƒ½å¤Ÿè®©ä»£ç ç¼–è¾‘å™¨æä¾›è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚è¿™ç§ç±»å‹å®‰å…¨å’Œè‡ªåŠ¨è¡¥å…¨çš„æ”¯æŒå¯ä»¥æå‡å¼€å‘æ•ˆç‡ï¼Œå¹¶å‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚

#### ä¼˜åŠ¿ï¼šä»£ç åº“æ›´é«˜æ•ˆä¸”æ›´æ˜“äºç»´æŠ¤

æ— è®ºæ‚¨å½“å‰æ˜¯å¦é¢ä¸´æ€§èƒ½æŒ‘æˆ˜ï¼Œå›´ç»•åŸç”Ÿæ¨¡å—å®æ–½ä¸€å¥—æœ€ä½³å®è·µå§‹ç»ˆæ˜¯æ˜æ™ºçš„é€‰æ‹©ï¼Œå› ä¸ºè¿™ä¸ä»…å…³ä¹é€Ÿåº¦ï¼Œè¿˜ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒã€‚å½“ç„¶ï¼Œä¿æŒé€‚é‡çš„æ¡¥æ¥é€šä¿¡æµé‡æœ€ç»ˆå°†æœ‰åŠ©äºæ‚¨çš„åº”ç”¨æ€§èƒ½æ›´ä½³ã€è¿è¡Œæ›´æµç•…ã€‚æ­£å¦‚æ‚¨æ‰€è§ï¼Œæœ¬èŠ‚æåˆ°çš„æŸäº›æŠ€æœ¯å·²ç»åœ¨ React Native å†…éƒ¨è¢«ç§¯æåº”ç”¨ï¼Œä¸ºæ‚¨æä¾›å¼€ç®±å³ç”¨çš„ä»¤äººæ»¡æ„çš„æ€§èƒ½è¡¨ç°ã€‚äº†è§£è¿™äº›æŠ€æœ¯å°†å¸®åŠ©æ‚¨åœ¨é«˜è´Ÿè½½ä¸‹åˆ›å»ºæ€§èƒ½æ›´å¥½çš„åº”ç”¨ç¨‹åºã€‚

***ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æŒ‡å‡ºçš„é¢å¤–ä¼˜åŠ¿ï¼šç»´æŠ¤æ€§ã€‚***

å°†å¤æ‚çš„æŠ½è±¡ï¼ˆå¦‚éªŒè¯ï¼‰ä¿ç•™åœ¨ JavaScript å±‚ï¼Œå°†ä½¿åŸç”Ÿå±‚éå¸¸è½»é‡ï¼Œä»…ä»…æ˜¯å¯¹åº•å±‚åŸç”Ÿ SDK çš„å°è£…ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„æ¨¡å—çš„åŸç”Ÿéƒ¨åˆ†å°†æ›´åƒæ˜¯ä»æ–‡æ¡£ä¸­å¤åˆ¶ç²˜è´´è¿‡æ¥çš„ä»£ç â€”â€”ç›´è§‚ä¸”å…·ä½“ã€‚

æŒæ¡è¿™ç§å¼€å‘åŸç”Ÿæ¨¡å—çš„æ–¹æ³•ï¼Œæ˜¯è®¸å¤š JavaScript å¼€å‘è€…èƒ½å¤Ÿè½»æ¾ä¸ºå…¶åº”ç”¨æ‰©å±•é¢å¤–åŠŸèƒ½çš„åŸå› ï¼Œè€Œæ— éœ€ç²¾é€š Objective-C æˆ– Javaã€‚

### ç¬¬å…­èŠ‚ ä»¥ 60FPS åŠ¨ç”»æ•ˆæœè¿è¡Œâ€”â€”æ— è®ºä»»ä½•æƒ…å†µ

> ä½¿ç”¨åŸç”Ÿè§£å†³æ–¹æ¡ˆå®ç°æµç•…çš„åŠ¨ç”»å’Œä»¥æ‰‹åŠ¿é©±åŠ¨çš„ç•Œé¢ï¼Œä¿æŒ 60FPSã€‚

#### é—®é¢˜ï¼šç”± JS é©±åŠ¨çš„åŠ¨ç”»å ç”¨äº†æ¡¥æ¥æµé‡ï¼Œå¯¼è‡´åº”ç”¨å˜æ…¢ã€‚

ç§»åŠ¨ç«¯ç”¨æˆ·ä¹ æƒ¯äº†æµç•…ä¸”è®¾è®¡ç²¾è‰¯çš„ç•Œé¢ï¼Œè¿™äº›ç•Œé¢èƒ½å¤Ÿå¿«é€Ÿå“åº”äº¤äº’å¹¶æä¾›åŠæ—¶çš„è§†è§‰åé¦ˆã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºéœ€è¦åœ¨å¤šä¸ªåœ°æ–¹æ³¨å†Œå¤§é‡åŠ¨ç”»ï¼Œè¿™äº›åŠ¨ç”»å¿…é¡»åœ¨å…¶ä»–å·¥ä½œåŒæ—¶è¿›è¡Œæ—¶ä¿æŒè¿è¡Œã€‚

æ­£å¦‚æˆ‘ä»¬ä»ä¸Šä¸€èŠ‚äº†è§£åˆ°çš„ï¼Œæ¡¥æ¥ä¼ é€’çš„ä¿¡æ¯é‡æ˜¯æœ‰é™çš„ï¼Œå½“å‰å¹¶æ²¡æœ‰å†…ç½®çš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚ä½•è®¾è®¡å’Œæ„å»ºæ‚¨çš„åº”ç”¨ï¼Œä½¿ä¸šåŠ¡é€»è¾‘å’ŒåŠ¨ç”»èƒ½å¤ŸåŒæ—¶æ— ç¼è¿è¡Œï¼Œè¿™éœ€è¦æ‚¨æå‰è§„åˆ’ã€‚è¿™ä¸æˆ‘ä»¬é€šå¸¸è¿›è¡ŒåŠ¨ç”»çš„æ–¹å¼æœ‰æ‰€ä¸åŒã€‚

ä¾‹å¦‚ï¼Œåœ¨ iOS ä¸Šï¼Œå†…ç½® API æä¾›äº†æ— ä¸ä¼¦æ¯”çš„æ€§èƒ½ï¼Œå¹¶å§‹ç»ˆä»¥é€‚å½“çš„ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬æ— éœ€è¿‡å¤šæ‹…å¿ƒåŠ¨ç”»æ˜¯å¦èƒ½ä¿æŒ 60FPS çš„æµç•…è¿è¡Œã€‚

ç„¶è€Œï¼Œåœ¨ React Native ä¸­ï¼Œæƒ…å†µç¨æœ‰ä¸åŒã€‚å¦‚æœæ‚¨æ²¡æœ‰ä»é¡¶å±‚å‡ºå‘é¢„å…ˆè§„åˆ’åŠ¨ç”»ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„å·¥å…·æ¥è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œé‚£ä¹ˆè¿Ÿæ—©ä¼šé‡åˆ°æ‰å¸§çš„é—®é¢˜ã€‚

***å¡é¡¿æˆ–ç¼“æ…¢çš„åŠ¨ç”»ä¼šå½±å“ç”¨æˆ·å¯¹åº”ç”¨çš„æ„ŸçŸ¥ï¼Œä½¿å…¶çœ‹èµ·æ¥è¿Ÿç¼“ä¸”ä¸å®Œå–„ã€‚***

åœ¨å½“ä»Šä¼—å¤šåº”ç”¨ä¸­ï¼Œæä¾›æµç•…ä¸”å…·æœ‰äº¤äº’æ€§çš„ç”¨æˆ·ç•Œé¢å¯èƒ½æ˜¯å¸å¼•å®¢æˆ·é€‰æ‹©æ‚¨çš„åº”ç”¨çš„å”¯ä¸€é€”å¾„ä¹‹ä¸€ã€‚

å¦‚æœæ‚¨çš„åº”ç”¨æ— æ³•æä¾›ä¸ç”¨æˆ·äº¤äº’ï¼ˆä¾‹å¦‚æ‰‹åŠ¿ï¼‰è‰¯å¥½é…åˆçš„å“åº”å¼ç•Œé¢ï¼Œä¸ä»…å¯èƒ½å½±å“æ–°å®¢æˆ·çš„ä½“éªŒï¼Œè¿˜ä¼šé™ä½æŠ•èµ„å›æŠ¥ç‡ï¼ˆROIï¼‰å¹¶å‰Šå¼±ç”¨æˆ·æ»¡æ„åº¦ã€‚

ç§»åŠ¨ç”¨æˆ·å–œæ¬¢ç´§éšå…¶äº’åŠ¨çš„ç•Œé¢ï¼Œè¿™äº›ç•Œé¢åº”è®¾è®¡ç²¾è‰¯ï¼Œè€ŒåŠ¨ç”»å§‹ç»ˆæµç•…è¿è¡Œæ˜¯æ„å»ºè¿™ç§ä½“éªŒçš„åŸºæœ¬è¦ç´ ä¹‹ä¸€ã€‚


#### è§£å†³æ–¹æ¡ˆï¼šå¦‚æœå¯èƒ½ï¼Œä½¿ç”¨åŸç”Ÿä¸”æ­£ç¡®çš„åŠ¨ç”»ã€‚

> One-off animations
å¯ç”¨ native driver æ˜¯å¿«é€Ÿæå‡åŠ¨ç”»æ€§èƒ½çš„æœ€ç®€å•æ–¹æ³•ã€‚ç„¶è€Œï¼Œå¯ä»¥ä¸ native driver ä¸€èµ·ä½¿ç”¨çš„æ ·å¼å±æ€§é›†æ˜¯æœ‰é™çš„ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ native driver æ“ä½œéå¸ƒå±€å±æ€§ï¼Œå¦‚ transforms å’Œ opacityã€‚ä½†å®ƒä¸æ”¯æŒæ“ä½œè¯¸å¦‚ colorsã€height ç­‰å±æ€§ã€‚ä¸è¿‡ï¼Œè¿™äº›æ”¯æŒçš„å±æ€§è¶³ä»¥å®ç°åº”ç”¨ä¸­å¤§å¤šæ•°åŠ¨ç”»ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨åªéœ€è¦æ˜¾ç¤º/éšè—æŸäº›å…ƒç´ æˆ–æ›´æ”¹å…¶ä½ç½®ã€‚

```javascript
const fadeAnim = useRef(new Animated.Value(0)).current;

const fadeIn = () => {
    Animated.timing(fadeAnim, {
        toValue: 1,
        duration: 1000,
        useNativeDriver: true, // enables native driver
    }).start();
};

// [...]

<Animated.View style={{ opacity: fadeAnim }} />
```

å¯¹äºæ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ React Native Reanimated åº“ã€‚å®ƒçš„ API ä¸åŸºç¡€çš„ Animated åº“å…¼å®¹ï¼ŒåŒæ—¶å¼•å…¥äº†ä¸€å¥—åŸºäºç°ä»£ hooks çš„æ¥å£ï¼Œç”¨äºå¯¹åŠ¨ç”»è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚

æ›´é‡è¦çš„æ˜¯ï¼ŒReanimated æä¾›äº†ä½¿ç”¨ native driver åŠ¨ç”»æ‰€æœ‰å¯èƒ½çš„æ ·å¼å±æ€§çš„èƒ½åŠ›ã€‚å› æ­¤ï¼ŒåŠ¨ç”» height æˆ– color å°†ä¸å†æ˜¯é—®é¢˜ã€‚ä¸è¿‡ï¼Œtransform å’Œ opacity åŠ¨ç”»ä»ä¼šç¨å¿«ä¸€äº›ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é€šè¿‡ GPU åŠ é€Ÿçš„ã€‚

æ‚¨å¯ä»¥åœ¨ Reanimated Playground ä¸­å°è¯•ä¸åŒçš„ç»„åˆæ¥æµ‹è¯•åŠ¨ç”»æ•ˆæœå’Œæ€§èƒ½ã€‚

##### æ‰‹åŠ¿é©±åŠ¨çš„åŠ¨ç”»
é€šè¿‡æ‰‹åŠ¿æ§åˆ¶åŠ¨ç”»æ˜¯åŠ¨ç”»æ•ˆæœä¸­æœ€ç†æƒ³çš„ä½“éªŒä¹‹ä¸€ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè¿™éƒ¨åˆ†äº¤äº’æœ€å…·å¸å¼•åŠ›ï¼Œå¯ä»¥å¢å¼ºç”¨æˆ·çš„æ»¡æ„åº¦ï¼Œå¹¶è®©åº”ç”¨æ˜¾å¾—æ›´åŠ æµç•…å’Œå“åº”è¿…é€Ÿã€‚

ç„¶è€Œï¼ŒåŸç”Ÿçš„ React Native åœ¨å°†æ‰‹åŠ¿ä¸åŸç”Ÿé©±åŠ¨åŠ¨ç”»ç›¸ç»“åˆæ—¶åŠŸèƒ½è¾ƒä¸ºæœ‰é™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ©ç”¨ ScrollView çš„æ»šåŠ¨äº‹ä»¶å®ç°å¹³æ»‘çš„å¯æŠ˜å å¤´éƒ¨æ•ˆæœã€‚ä½†å¯¹äºæ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œæ‚¨å¯ä»¥å€ŸåŠ©ä¸€ä¸ªå¼ºå¤§çš„åº“â€”â€”React Native Gesture Handlerï¼Œå®ƒå…è®¸æ‚¨åŸç”Ÿå¤„ç†ä¸åŒçš„æ‰‹åŠ¿å¹¶å°†å…¶ä¸åŠ¨ç”»æ’å€¼ç»“åˆèµ·æ¥ã€‚é€šè¿‡ä¸ Animated é…åˆï¼Œæ‚¨å¯ä»¥æ„å»ºå¯æ»‘åŠ¨çš„å…ƒç´ ã€‚

å°½ç®¡è¿™ç§æ–¹æ³•ä»éœ€è¦ä½¿ç”¨ JavaScript å›è°ƒï¼Œä½†æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼

æœ€ä½³å·¥å…·ç»„åˆï¼šGesture Handler å’Œ Reanimated

React Native Gesture Handler å’Œ Reanimated æ˜¯å¤„ç†æ‰‹åŠ¿é©±åŠ¨åŠ¨ç”»çš„æœ€å¼ºå¤§ç»„åˆã€‚å®ƒä»¬è¢«è®¾è®¡ä¸ºæ— ç¼åä½œï¼Œèƒ½å¤Ÿåœ¨å®Œå…¨åŸç”Ÿç«¯è®¡ç®—å¤æ‚çš„æ‰‹åŠ¿é©±åŠ¨åŠ¨ç”»ã€‚

å€ŸåŠ©æ‚¨çš„åˆ›æ„å’Œ Reanimated çš„å¼ºå¤§åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥ä»¥è®¾å¤‡çš„æœ€ä½³é€Ÿåº¦åˆ›å»ºç²¾å½©çš„æ‰‹åŠ¿é©±åŠ¨åŠ¨ç”»ã€‚æ— è®ºæ˜¯æ»‘åŠ¨åˆ—è¡¨ã€å¤æ‚çš„äº¤äº’å¼å¡ç‰‡ï¼Œè¿˜æ˜¯æ›´é«˜é˜¶çš„æ‰‹åŠ¿åŠ¨ç”»ï¼Œè¿™å¥—å·¥å…·ç»„åˆéƒ½å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œè®©æ‚¨çš„åº”ç”¨æ‹¥æœ‰é¡¶å°–çš„ç”¨æˆ·ä½“éªŒã€‚

```javascript
import React from 'react';
import { StyleSheet, View } from 'react-native';
import { PanGestureHandler } from 'react-native-gesture-handler';
import Animated, {
 useAnimatedGestureHandler,
 useAnimatedStyle,
 useSharedValue,
 withSpring,
} from 'react-native-reanimated';

const Snappable = (props) => {
    const startingPosition = 0;
    const x = useSharedValue(startingPosition);
    const y = useSharedValue(startingPosition);

    const animatedStyle = useAnimatedStyle(() => {
        return {
            transform: [{ translateX: x.value }, { translateY: y.value }],
        };
    });

    const eventHandler = useAnimatedGestureHandler({
        onStart: (event, ctx) => {
            ctx.startX = x.value;
            ctx.startY = y.value;
        },
        onActive: (event, ctx) => {
            x.value = ctx.startX + event.translationX;
            y.value = ctx.startY + event.translationY;
        },
        onEnd: (event, ctx) => {
            x.value = withSpring(startingPosition);
            y.value = withSpring(startingPosition);
        },
    });
    return (
        <PanGestureHandler onGestureEvent={eventHandler}>
            <Animated.View style={animatedStyle}>{props.children}</Animated.View>
        </PanGestureHandler>
    );
};

const Example = () => {
    return (
        <View style={styles.container}>
            <Snappable>
                <View style={styles.box} />
            </Snappable>
        </View>
    );
};

export default Example;
```

```javascript
const BOX_SIZE = 100;

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    box: {
        width: BOX_SIZE,
        height: BOX_SIZE,
        borderColor: '#F5FCFF',
        alignSelf: 'center',
        backgroundColor: 'plum',
        margin: BOX_SIZE / 2,
    },
});
```
ä½çº§åˆ«çš„æ‰‹åŠ¿å¤„ç†å¯èƒ½å¹¶ä¸å®¹æ˜“ï¼Œä½†å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›ç¬¬ä¸‰æ–¹åº“åˆ©ç”¨äº†ä¸Šè¿°å·¥å…·ï¼Œå¹¶æä¾›äº† callbackNode å±æ€§ã€‚callbackNode æ˜¯ä¸€ä¸ªç”±ç‰¹å®šæ‰‹åŠ¿è¡Œä¸ºæ´¾ç”Ÿçš„ Animated.Valueï¼Œå…¶å€¼èŒƒå›´é€šå¸¸ä¸º 0 åˆ° 1ï¼Œè¡¨ç¤ºæ‰‹åŠ¿çš„è¿›åº¦ã€‚æ‚¨å¯ä»¥å°†è¿™äº›å€¼æ’å€¼åˆ°å±å¹•ä¸Šçš„åŠ¨ç”»å…ƒç´ ä¸­ï¼Œä»è€Œå®ç°åŠ¨æ€æ•ˆæœã€‚

ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä»¥ä¸‹åº“ï¼Œå®ƒä»¬æš´éœ²äº† callbackNodeï¼š
	â€¢	reanimated-bottom-sheetï¼šç”¨äºåˆ›å»ºåŠ¨æ€çš„åº•éƒ¨å¼¹å‡ºæ¡†ï¼Œæ”¯æŒæ‰‹åŠ¿é©±åŠ¨çš„å±•å¼€å’Œæ”¶èµ·ã€‚
	â€¢	react-native-tab-viewï¼šç”¨äºå®ç°å…·æœ‰æµç•…åˆ‡æ¢æ•ˆæœçš„æ ‡ç­¾è§†å›¾ç»„ä»¶ï¼Œå¯ç»“åˆæ‰‹åŠ¿è¿›è¡Œåˆ‡æ¢åŠ¨ç”»ã€‚

è¿™äº›åº“ç®€åŒ–äº†å¤æ‚çš„æ‰‹åŠ¿å¤„ç†è¿‡ç¨‹ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿè½»æ¾å®ç°æµç•…çš„æ‰‹åŠ¿é©±åŠ¨åŠ¨ç”»ã€‚

```javascript
import * as React from 'react';
import { StyleSheet, Text, View } from 'react-native';
import Animated from 'react-native-reanimated';
import BottomSheet from 'reanimated-bottom-sheet';
import Lorem from './Lorem';

const { Value, interpolateNode: interpolate } = Animated;

const Example = () => {
    const gestureCallbackNode = new Value(0);

    const renderHeader = () => (
        <View style={styles.headerContainer}>
            <Text style={styles.headerTitle}>Drag me</Text>
        </View>
    );
    const renderInner = () => (
        <View style={styles.innerContainer}>
            <Animated.View
                style={{
                opacity: interpolate(gestureCallbackNode, {
                    inputRange: [0, 1],
                    outputRange: [1, 0],
                }),
                transform: [
                    {
                        translateY: interpolate(gestureCallbackNode, {
                            inputRange: [0, 1],
                            outputRange: [0, 100],
                            }),
                        },
                ],
                }}>
                <Lorem /> 
            </Animated.View>
        </View>
    );
    return (
    <View style={styles.container}>
        <BottomSheet
            callbackNode={gestureCallbackNode}
            snapPoints={[50, 400]}
            initialSnap={1}
            renderHeader={renderHeader}
            renderContent={renderInner}
        />
    </View>
    );
};
export default Example;

const styles = StyleSheet.create({
    container: {
     flex: 1,
    },
    headerContainer: {
        width: '100%',
        backgroundColor: 'lightgrey',
        height: 40,
        borderWidth: 2,
    },
    headerTitle: {
        textAlign: 'center',
        fontSize: 20,
        padding: 5,
    },
    innerContainer: {
      backgroundColor: 'lightblue',
    },
});
```

##### ä¸ºæ‚¨çš„ JavaScript æ“ä½œè®¾ç½®è¾ƒä½çš„ä¼˜å…ˆçº§

å¹¶éæ€»èƒ½å®Œå…¨æ§åˆ¶åŠ¨ç”»çš„å®ç°æ–¹å¼ã€‚ä¾‹å¦‚ï¼ŒReact Navigation ä½¿ç”¨äº† React Native Gesture Handler å’Œ Animated çš„ç»„åˆï¼Œè¿™ç§å®ç°ä»éœ€è¦ JavaScript æ¥æ§åˆ¶åŠ¨ç”»çš„è¿è¡Œæ—¶é€»è¾‘ã€‚å› æ­¤ï¼Œå¦‚æœå¯¼èˆªåˆ°çš„å±å¹•åŠ è½½äº†ä¸€ä¸ªå¤æ‚çš„ UIï¼Œå¯èƒ½ä¼šå¯¼è‡´åŠ¨ç”»å‡ºç°é—ªçƒã€‚

å¹¸è¿çš„æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ InteractionManager æ¥æ¨è¿Ÿè¿™äº›ç¹é‡ä»»åŠ¡çš„æ‰§è¡Œã€‚è¿™ä¸€å®ç”¨å·¥å…·å…è®¸å°†è€—æ—¶çš„å·¥ä½œå®‰æ’åœ¨æ‰€æœ‰äº¤äº’/åŠ¨ç”»å®Œæˆä¹‹åã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥è®© JavaScript åŠ¨ç”»è¿è¡Œå¾—æ›´æµç•…ã€‚

***æ³¨æ„ï¼šåœ¨ä¸ä¹…çš„å°†æ¥ï¼Œæ‚¨å°†èƒ½å¤Ÿç›´æ¥é€šè¿‡ React è‡ªèº«çš„æ¸²æŸ“å™¨å±‚ï¼ˆä½¿ç”¨ Fabricï¼‰å®ç°ç±»ä¼¼çš„è¡Œä¸ºï¼Œå€ŸåŠ© startTransition APIã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… New Architecture ç« èŠ‚ã€‚***


```javascript
import React, { useState, useRef } from 'react';
import {
 Text,
 View,
 StyleSheet,
 Button,
 Animated,
 InteractionManager,
 Platform,
} from 'react-native';
import Constants from 'expo-constants';

const ExpensiveTaskStates = {
 notStared: 'not started',
 scheduled: 'scheduled',
 done: 'done',
};

const App = () => {
    const animationValue = useRef(new Animated.Value(100));
    const [animationState, setAnimationState] = useState(false);
    const [expensiveTaskState, setExpensiveTaskState] = useState(
        ExpensiveTaskStates.notStared,
    );
    const startAnimationAndScheduleExpensiveTask = () => {
        Animated.timing(animationValue.current, {
            duration: 2000,
            toValue: animationState ? 100 : 300,
            useNativeDriver: false,
            }).start(() => {
            setAnimationState((prev) => !prev);
        });
        setExpensiveTaskState(ExpensiveTaskStates.scheduled);
        InteractionManager.runAfterInteractions(() => {
        setExpensiveTaskState(ExpensiveTaskStates.done);
        });
    };

    return (
        <View style={styles.container}>
            {Platform.OS === 'web' ? (
                    <Text style={styles.infoLabel}>
                    â—InteractionManager works only on native platforms.
                    Open example on
                    iOS or Androidâ—
                    </Text>
                ) : (
                <>
                    <Button
                        title=''Start animation and schedule expensive
                        task''
                        onPress={startAnimationAndScheduleExpensiveTask}
                    />
                    <Animated.View
                     style={[styles.box, { width: animationValue. current }]}>
                        <Text>Animated box</Text>
                    </Animated.View>
                    <Text style={styles.paragraph}>
                        Expensive task status: {expensiveTaskState}
                    </Text>
                </>
            )}
        </View>
    );
};

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        paddingTop: Constants.statusBarHeight,
        padding: 8,
    },
    paragraph: {
        margin: 24,
        fontSize: 18,
        textAlign: 'center',
    },
    box: {
        backgroundColor: 'coral',
        marginVertical: 20,
        height: 50,
    },
    infoLabel: {
        textAlign: 'center',
    },
});

export default App;
```

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨å¯ä»¥å…ˆæ˜¾ç¤ºä¸€ä¸ªå ä½ç¬¦ï¼Œç­‰å¾…åŠ¨ç”»å®Œæˆåå†æ¸²æŸ“å®é™…çš„ UIã€‚è¿™ç§æ–¹å¼å¯ä»¥è®© JavaScript åŠ¨ç”»è¿è¡Œå¾—æ›´åŠ æµç•…ï¼Œå¹¶é¿å…å…¶ä»–æ“ä½œå¯¹åŠ¨ç”»é€ æˆçš„ä¸­æ–­ã€‚é€šå¸¸ï¼Œè¿™ç§æ–¹æ³•è¶³å¤Ÿå¹³æ»‘ï¼Œå¯ä»¥æä¾›å‡ºè‰²çš„ç”¨æˆ·ä½“éªŒã€‚

#### ä¼˜åŠ¿ï¼šäº«å—æµç•…çš„åŠ¨ç”»æ•ˆæœå’Œä»¥æ‰‹åŠ¿é©±åŠ¨çš„ç•Œé¢ï¼Œä¿æŒ 60FPS çš„æ€§èƒ½è¡¨ç°ã€‚
åœ¨ React Native ä¸­ï¼Œæ²¡æœ‰ä¸€ç§ç»Ÿä¸€çš„æ­£ç¡®æ–¹å¼æ¥å®ç°åŠ¨ç”»ã€‚æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿä¸­æœ‰è®¸å¤šä¸åŒçš„åº“å’Œæ–¹æ³•å¯ä»¥ç”¨äºå¤„ç†äº¤äº’ã€‚æœ¬èŠ‚æå‡ºçš„å»ºè®®åªæ˜¯ä¸€äº›æ¨èï¼Œå¸Œæœ›é¼“åŠ±æ‚¨ä¸è¦å°†æµç•…çš„ç•Œé¢è§†ä¸ºç†æ‰€å½“ç„¶çš„ç»“æœã€‚

æ›´é‡è¦çš„æ˜¯ï¼Œåœ¨å¤´è„‘ä¸­æ„å»ºåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰äº¤äº’çš„å…¨å±€å›¾æ™¯ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›äº¤äº’ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒJavaScript é©±åŠ¨çš„åŠ¨ç”»å®Œå…¨èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚ä½†åŒæ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›äº¤äº’å¿…é¡»ä¾èµ–åŸç”ŸåŠ¨ç”»ï¼ˆæˆ–å®Œå…¨çš„åŸç”Ÿè§†å›¾ï¼‰æ‰èƒ½å®ç°æµç•…æ•ˆæœã€‚

é‡‡ç”¨è¿™æ ·çš„æ€è·¯ï¼Œæ‚¨åˆ›å»ºçš„åº”ç”¨ç¨‹åºå°†æ›´åŠ æµç•…ä¸”å“åº”è¿…é€Ÿã€‚è¿™æ ·çš„åº”ç”¨ä¸ä»…ä¼šè®©ç”¨æˆ·ä½¿ç”¨èµ·æ¥æ„Ÿåˆ°æ„‰æ‚¦ï¼Œä¹Ÿä¼šè®©æ‚¨åœ¨å¼€å‘å’Œè°ƒè¯•æ—¶å……æ»¡ä¹è¶£ã€‚

##### ä½¿ç”¨ Reanimated

ä½¿ç”¨ React Native Reanimated çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯ï¼Œå®ƒèƒ½å¤Ÿç›´æ¥åœ¨åŸç”Ÿçº¿ç¨‹ä¸Šæ‰§è¡ŒåŠ¨ç”»ï¼Œè€Œä¸æ˜¯ä¾èµ– JavaScript çº¿ç¨‹ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨è¾ƒæ—§æˆ–è¾ƒæ…¢çš„è®¾å¤‡ä¸Šï¼Œèƒ½å¤Ÿæä¾›æ›´æµç•…çš„åŠ¨ç”»æ•ˆæœã€‚

åœ¨ä½¿ç”¨ React Native æä¾›çš„ Animated æ—¶ï¼Œæ‚¨åªèƒ½åœ¨åŸç”Ÿçº¿ç¨‹ä¸ŠåŠ¨ç”» transforms å’Œ opacityï¼Œå…¶ä½™å±æ€§éœ€è¦åœ¨ JavaScript çº¿ç¨‹ä¸Šå®Œæˆã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´åŠ¨ç”»å¡é¡¿å’Œç¼“æ…¢ï¼ˆå¦‚å‰æ–‡æ‰€è¿°ï¼‰ã€‚ä½†åœ¨ Reanimated ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨åŸç”Ÿçº¿ç¨‹ä¸Šå¯¹æ‰€æœ‰æ ·å¼å±æ€§è¿›è¡ŒåŠ¨ç”»æ“ä½œï¼Œè¿™æä¸ºå¼ºå¤§ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šè¿‡ Reanimated åŠ¨ç”»æ“ä½œå¤šä¸ªæ ·å¼å±æ€§çš„ç¤ºä¾‹ï¼ŒåŒ…æ‹¬ widthã€heightã€borderRadiusã€backgroundColor å’Œ borderColorï¼Œä¸”ä¸ä¼šä¸¢å¸§ï¼š

```javascript
import * as React from 'react';
import { View, StyleSheet } from 'react-native';
import Constants from 'expo-constants';
import Animated, {
withRepeat,
withDelay,
withSequence,
withTiming,
interpolateColor,
interpolate,
useAnimatedStyle,
useSharedValue,
} from 'react-native-reanimated';
export default function App() {
// Define the shared animated value
const animatedValue = useSharedValue(0);
React.useEffect(() => {
// Start the animation
animatedValue.value = withRepeat(
withSequence(
withDelay(1000, withTiming(1)),
withDelay(1000, withTiming(0))
),
Infinity,
true
);
}, []);
const animatedStyle = useAnimatedStyle(() => {
return {
width: interpolate(animatedValue.value, [0, 1], [50,
100]),
height: interpolate(animatedValue.value, [0, 1], [50,
100]),
// from square to circle
borderRadius: interpolate(animatedValue.value, [0, 1],
[0, 50]),
backgroundColor: interpolateColor(
animatedValue.value,
[0, 1],
['gold', 'salmon']
),
borderColor: interpolateColor(
animatedValue.value,
[0, 1],
['purple', 'papayawhip']
),
borderWidth: 10,
};
}, [animatedValue.value]);
return (
<View style={styles.container}>
<Animated.View style={animatedStyle} />
</View>
);
}
const styles = StyleSheet.create({
container: {
flex: 1,
justifyContent: 'center',
alignItems: 'center',
paddingTop: Constants.statusBarHeight,
backgroundColor: '#333',
padding: 8,
},
});
```

Reanimated ä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤šåŸºç¡€å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºå¼ºå¤§ã€å¤æ‚ä¸”é«˜æ€§èƒ½çš„åŠ¨ç”»ã€‚

##### Hooks å’Œæ–¹æ³•

###### useSharedValue

å…±äº«å€¼ï¼ˆShared Valuesï¼‰å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œæä¾›å¯¹å˜åŒ–ä½œå‡ºååº”çš„æ–¹å¼ï¼Œé©±åŠ¨åŠ¨ç”»ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå®ƒæ˜¯å“åº”å¼çš„ã€‚ä½œä¸ºå“åº”å¼çš„ï¼Œæ„å‘³ç€ä»»ä½•ä½¿ç”¨è¯¥å…±äº«å€¼çš„åœ°æ–¹éƒ½èƒ½å®æ—¶æ¥æ”¶æ›´æ–°ã€‚
æ•°æ®å­˜å‚¨åœ¨ UI çº¿ç¨‹ä¸Šï¼Œä½†ä¹Ÿå¯ä»¥ä» JS çº¿ç¨‹è®¿é—®ï¼Œå› æ­¤è¢«ç§°ä¸ºâ€œå…±äº«å€¼â€ã€‚å…±äº«å€¼å¯ä»¥æ˜¯æ•°å­—ã€å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²ã€å¯¹è±¡å’Œæ•°ç»„ã€‚

```javascript
const anim = useSharedValue(number | string | boolean | object | array)
```

###### useDerivedValue
å®ƒæ˜¯ä¸€ä¸ªå…±äº«å€¼ï¼Œä½†ç”¨äºä»å…±äº«å€¼ä¸­æ´¾ç”Ÿæˆ–åˆ›å»ºæ–°å€¼ã€‚è¿™åœ¨æ‚¨å¸Œæœ›æŠ½è±¡ä¸€äº›é€»è¾‘ï¼ˆä¾‹å¦‚æ’å€¼ã€æ•°å­¦è¿ç®—ï¼‰æˆ–ä¸ºäº†å¤ç”¨ç›®çš„æ—¶éå¸¸æœ‰ç”¨ã€‚

```javascript
const newAnim = useDerivedValue(() => {
    return anim.value + 100;
}, [anim.value])
```

###### useAnimatedStyle
å½“æ ·å¼å±æ€§éœ€è¦åŸºäºå…±äº«å€¼æ›´æ–°ï¼Œæˆ–æŸä¸ªç‰¹å®šæ ·å¼å±æ€§ä¾èµ–äºå…±äº«å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒã€‚æ­¤é’©å­è¿”å›çš„å°†æ˜¯ä¸€ä¸ªâ€œå“åº”å¼â€çš„æ ·å¼ã€‚

```javascript
const styles = useAnimatedStyle(() => ({
    opacity: anim.value,
    width: anim.value * 10
}, [anim.value])
```

###### useAnimatedProp
è¿™æ˜¯ useAnimatedStyle çš„å¯¹åº”æ–¹æ³•ï¼Œä½†é€‚ç”¨äºéæ ·å¼å±æ€§ï¼Œä¾‹å¦‚ SVG çš„è·¯å¾„ã€è¾“å…¥æ¡†çš„å€¼ç­‰ã€‚

```javascript
const animatedProps = useAnimatedProps(() => ({
    path:`
        M 100,100
        A anim.value, anim.value 0,0,1 10, 20
        A anim.value, anim.value 0,0,1 10, 20
        Q 90,60 50,90
        Q 10,60 10,30 z
    `,
})
```

###### interpolate
æ­¤æ–¹æ³•å…è®¸æ‚¨å°†å€¼ä»ä¸€ä¸ªè¾“å…¥èŒƒå›´ï¼ˆinputRangeï¼‰é‡æ–°æ˜ å°„åˆ°ä¸€ä¸ªè¾“å‡ºèŒƒå›´ï¼ˆoutputRangeï¼‰ã€‚

```javascript
const styles = useAnimatedStyle(() => ({
    width: interpolate(
        anim.value // sharedValue
        [0, 1] // inputRange
        [0, 100] // outputRange
    )
}, [anim.value])
```

###### interpolateColor
ä¸ interpolate ç±»ä¼¼ï¼Œä½†ç”¨äºé¢œè‰²ï¼Œå…¶ä¸­ outputRange æ˜¯ä¸€ä¸ªåŒ…å«é¢œè‰²å€¼çš„æ•°ç»„ã€‚

```javascript
const styles = useAnimatedStyle(() => ({
    color: interpolateColor(
        anim.value // sharedValue
        [0, 1] // inputRange
        [â€œredâ€, â€œblueâ€] // outputRange
    )
}, [anim.value])
```

###### Timing functions
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¡æ—¶å‡½æ•°æ¥ä¸ºå…±äº«å€¼è®¾ç½®åŠ¨ç”»ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ withTimingã€withSpring æˆ– withDecayã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡ withDelayã€withRepeat æˆ– withSequence æ¥ä¿®æ”¹è¿™äº›è®¡æ—¶å‡½æ•°çš„é»˜è®¤è¡Œä¸ºã€‚æœ€æ£’çš„æ˜¯ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±ç»„åˆå®ƒä»¬ï¼š

```javascript
anim.value = withRepeat(
    withSequence(
        withDelay(1000, withTiming(1)
        withDelay(1000, withTiming(0)
    )
    Infinity
    true
)
```
ä¸Šé¢çš„ä»£ç å°†ä»¥åˆå§‹å»¶è¿Ÿ 1000 æ¯«ç§’çš„æ–¹å¼é‡å¤åå‘ä¸€ä¸ªåŠ¨ç”»åºåˆ—ã€‚

###### UI Primitives
ä¸ºäº†ä½¿ UI å…ƒç´ å¯¹ä¸Šè¿°å˜åŒ–åšå‡ºå“åº”ï¼Œéœ€è¦æ³¨æ„ï¼Œåªæœ‰ Animated å…ƒç´ æ‰ä¼šæ‰§è¡ŒåŠ¨ç”»ã€‚Reanimated å¯¼å‡ºäº†ä»¥ä¸‹ UI åŸºç¡€ç»„ä»¶ï¼š

```javascript
import Animated from 'react-native-reanimated'

<Animated.View />
<Animated.Text />
<Animated.Image />
<Animated.ScrollView />
<Animated.FlatList />
```
ä»¥åŠä¸€ä¸ªåä¸º createAnimatedComponent çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å°†ä»»ä½• UI åŸºç¡€ç»„ä»¶/ç»„ä»¶å˜ä¸º Animated ç»„ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†æŠŠ TextInput è½¬æ¢ä¸ºä¸€ä¸ª Animated ç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿå¯¹å…±äº«å€¼çš„å˜åŒ–åšå‡ºå“åº”ï¼š

```javascript
import Animated from 'react-native-reanimated'
import { TextInput } from 'react-native'
const AnimatedTextInput = Animated.
createAnimatedComponent(TextInput)
```

å¦‚æœåœ¨ useAnimatedStyle æˆ– useAnimatedProp ä¸­å­˜åœ¨é‡å¤é€»è¾‘ï¼Œå¯ä»¥å°†å…¶æå–åˆ° useDerivedValue ä¸­ï¼Œå¹¶åœ¨å†…éƒ¨ä½¿ç”¨è¿”å›çš„å€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```javascript
const animatedStyle = useAnimatedStyle(() => {
    return {
        width: interpolate(animatedValue.value, [0, 1], [50, 100]),
        height: interpolate(animatedValue.value, [0, 1], [50,
        100]),
        transform: [{
            translateX: interpolate(animatedValue.value, [0, 1], [50,
        100])
        }]
    };
}, [animatedValue.value]);
```
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº widthã€height å’Œ transform.translateX ä½¿ç”¨äº†ç›¸åŒçš„æ’å€¼é€»è¾‘å’Œç›¸åŒçš„ outputRangeï¼Œå› æ­¤å¯ä»¥å°†å…¶æå–åˆ°ä¸€ä¸ªæ´¾ç”Ÿå€¼ï¼ˆderived valueï¼‰ä¸­ï¼š

```javascript
const interpolatedValue = useDerivedValue(() => {
    return interpolate(animatedValue.value, [0, 1], [50, 100])
}, [animatedValue.value]);

const animatedStyle = useAnimatedStyle(() => {
    return {
        width: interpolatedValue.value,
        height: interpolatedValue.value,
        transform: [{
            translateX: interpolatedValue.value
        }]
    };
}, [interpolatedValue.value]);
```
é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œäº†æŠ½è±¡å’Œå¤ç”¨ï¼Œå‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”æ€§èƒ½æ›´é«˜ï¼Œå› ä¸º interpolatedValue åªä¼šè¢«è®¡ç®—ä¸€æ¬¡ã€‚

##### å°½å¯èƒ½å¤šåœ°ä½¿ç”¨æ’å€¼ï¼ˆInterpolationsï¼‰ã€‚
å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ¨ç”»è¿‡å¤šçš„å…±äº«å€¼éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œä¸å…¶ä¸ºæ¯ä¸ªæ ·å¼å±æ€§åˆ›å»ºä¸€ä¸ª sharedValue å¹¶åˆ†åˆ«åº”ç”¨ withTiming å‡½æ•°ï¼Œä¸å¦‚ä½¿ç”¨å•ä¸ª sharedValue å¹¶é€šè¿‡æ’å€¼æ¥å®ç°åŠ¨ç”»ã€‚è¿™æ ·ä¸ä»…å¯ä»¥æé«˜ä»£ç æ€§èƒ½ï¼Œå‡å°‘é”™è¯¯ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæ‚¨çš„åŠ¨ç”»å°†ç”±ä¸€ä¸ªå…±äº«å€¼åè°ƒç®¡ç†ï¼Œæœªæ¥ä¹Ÿæ›´å®¹æ˜“æ›´æ”¹ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»„ä»¶çš„èµ·å§‹ç¤ºä¾‹ï¼Œæ³¨æ„æ¯ä¸ªæ ·å¼å±æ€§éƒ½å®šä¹‰äº†ä¸€ä¸ªå…±äº«å€¼ã€‚å½“ç»„ä»¶æŒ‚è½½æ—¶ï¼Œæˆ‘ä»¬ä¸ºæ‰€æœ‰ 5 ä¸ªå…±äº«å€¼ï¼ˆwidthã€heightã€borderRadiusã€backgroundColor å’Œ translateYï¼‰å¯åŠ¨åŠ¨ç”»ï¼Œå¹¶ä¼ é€’ä¸åŒçš„å€¼ï¼š
```javascript
function MyComponent() {
const width = useSharedValue(50);
const height = useSharedValue(50);
const borderRadius = useSharedValue(0);
const backgroundColor = useSharedValue(0);
const translateY = useSharedValue(0);

React.useEffect(() => {
    width.value = withTiming(100);
    height.value = withTiming(100);
    borderRadius.value = withTiming(50);
    backgroundColor.value = withTiming(1);
    translateY.value = withTiming(50)
}, [])

const animatedStyle = useAnimatedStyle(() => {
    return {
        width: width.value,
        height: height.value,
        borderRadius: borderRadius.value,
        backgroundColor: interpolateColor(
            backgroundColor.value,
            [0, 1],
            ['gold', 'salmon']
        ),
        transform: [{
            translateY: translateY.value
        }]
    };
});

return <Animated.View style={animatedStyle} />
}
```
æ­£å¦‚æ‚¨å¯èƒ½æƒ³è±¡çš„é‚£æ ·ï¼Œæ·»åŠ å¦ä¸€ä¸ªæ ·å¼å±æ€§ä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§å’Œç»´æŠ¤éš¾åº¦ï¼Œè¿™å¹¶ä¸å¥½ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ä¸ªå…±äº«å€¼ï¼Œå¹¶æ ¹æ®éœ€è¦å¯¹å…¶è¿›è¡Œæ’å€¼ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨å•ä¸ªå…±äº«å€¼é‡å†™ä¸Šè¿°ç»„ä»¶çš„æ–¹å¼ï¼š
```javascript
function MyComponent() {
    // Define the shared animated value
    const animatedValue = useSharedValue(0);
    React.useEffect(() => {
        // Start the animation
        animatedValue.value = withTiming(1);
    }, []);

    const animatedStyle = useAnimatedStyle(() => {
        return {
            width: interpolate(animatedValue.value, [0, 1], [50, 100]),
            height: interpolate(animatedValue.value, [0, 1], [50, 100]),
            borderRadius: interpolate(animatedValue.value, [0, 1], [0, 50]),
            backgroundColor: interpolateColor(
                animatedValue.value,
                [0, 1],
                ['gold', 'salmon']
            ),
            transform: [{
                translateY: interpolate(animatedValue.value, [0, 1],
                [0, 50])
            }]
            };
        }, [animatedValue.value]);

    return <Animated.View style={animatedStyle} />
}
```
##### ä½¿ç”¨ SharedValues æ›¿ä»£ setState æˆ– useRef

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ SharedValue å­˜å‚¨ä¸åŒçš„çŠ¶æ€ï¼Œè€Œä¸ä¼šè§¦å‘çŠ¶æ€å˜åŒ–ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª useLayout é’©å­ï¼Œç”¨äºå°†ç»„ä»¶çš„å¸ƒå±€å€¼å­˜å‚¨åˆ° SharedValue ä¸­ã€‚

```javascript
export const useLayout = () => {
    const layout = useSharedValue<LayoutRectangle>({
        x: 0,
        y: 0,
        width: 0,
        height: 0,
    });

    const onLayout = useCallback<(event: LayoutChangeEvent) => void> ((e) => {
        const {
            nativeEvent: {
            layout: { height, width, x, y },
            },
        } = e;
        layout.value = { height, width, x, y };
    }, []);
    return {
        layout,
        onLayout,
    };
};
```
### ç¬¬ä¸ƒèŠ‚ ç”¨ Rive æ›¿ä»£ Lottie

> åˆ©ç”¨çŠ¶æ€æœºæä¾›å¼ºå¤§ä¸”æµç•…çš„äº¤äº’åŠ¨ç”»ï¼Œä¿æŒ 60FPS æ€§èƒ½

#### é—®é¢˜ï¼šå®æ—¶åŠ¨ç”»å› ä½å¸§ç‡ã€æ–‡ä»¶å¤§å°è¿‡å¤§ä»¥åŠä¸å¤Ÿå¥å£®è€Œå—åˆ°å½±å“
å½“æˆ‘ä»¬è°ˆåˆ°äº¤äº’å¼ç§»åŠ¨åº”ç”¨æ—¶ï¼Œå¾€å¾€ä¼šæƒ³åˆ°ç”¨æˆ·é©±åŠ¨çš„åŠ¨ç”»ã€‚ä¾‹å¦‚ï¼Œåœ¨å®Œæˆç»“è´¦æ—¶ï¼Œå¯ä»¥å±•ç¤ºä¸€ä¸ªæ¼‚äº®çš„ä¸‹å•æˆåŠŸåŠ¨ç”»ã€‚ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­æ˜¯å¼•å¯¼æ­¥éª¤ï¼ˆonboardingï¼‰ï¼Œç”¨æˆ·éœ€è¦ç‚¹å‡»å„ç§æŒ‰é’®æ‰èƒ½ç»§ç»­å‰è¿›ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªç²¾ç¾çš„åŠ¨ç”»ã€‚é‚£ä¹ˆï¼Œå¼€å‘è€…å¦‚ä½•å®ç°è¿™ç§è¡Œä¸ºå‘¢ï¼Ÿ

ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ GIFã€‚å¦‚æœæˆ‘ä»¬æœ‰ 3 ä¸ªå¼•å¯¼æ­¥éª¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦å‡†å¤‡ 3 ä¸ª GIFã€‚è¿™ç§è§£å†³æ–¹æ¡ˆåœ¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼ˆUXï¼‰æ–¹é¢é€šå¸¸å·²ç»è¶³å¤Ÿã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ›´é«˜çš„åŠ¨ç”»ä¿çœŸåº¦ï¼Œæˆ–è€…éœ€è¦é«˜è´¨é‡çš„å…¨å±åŠ¨ç”»æ—¶ï¼ŒGIF ä¼šæ˜¾å¾—ä¸è¶³ã€‚GIF æ–‡ä»¶å¯èƒ½ä¼šè¿…é€Ÿä¸ºåº”ç”¨çš„åŒ…å¤§å°å¢åŠ å‡ å…†å­—èŠ‚ã€‚

é‚£ä¹ˆï¼Œè¿˜æœ‰å“ªäº›æ›¿ä»£é€‰é¡¹å‘¢ï¼Ÿè¿™æ—¶å¯ä»¥è®¨è®º Lottieã€‚Lottie æ˜¯ä¸€ä¸ªé€‚ç”¨äº Android å’Œ iOS çš„ç§»åŠ¨ç«¯åº“ï¼Œç”± Airbnb çš„å¼€å‘è€…åˆ›å»ºï¼Œç”¨äºåˆ©ç”¨ LottieFilesã€‚LottieFiles æ˜¯åŸºäº JSON çš„åŠ¨ç”»æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ Adobe AfterEffects çš„ BodyMoving æ’ä»¶å¯¼å‡ºã€‚Lottie æ‹¥æœ‰ä¸€ä¸ªéå¸¸æ´»è·ƒçš„ç¤¾åŒºï¼Œå…¶ä¸­åŒ…å«è®¸å¤šå…è´¹çš„åŠ¨ç”»èµ„æºã€‚æ‚¨å¯ä»¥è®¿é—® LottieFiles æŸ¥çœ‹ã€‚

åœ¨ React Native ä¸­ï¼ŒLottie åº“éå¸¸å—æ¬¢è¿ï¼Œå¹¶ä¸”è·å¾—äº†ç¤¾åŒºçš„å¹¿æ³›å¥½è¯„ã€‚é€šè¿‡ progress å±æ€§å¯ä»¥æ§åˆ¶åŠ¨ç”»è¿›åº¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å¼æ–¹æ³•ï¼ˆå¦‚ playï¼‰æ¥æ§åˆ¶åŠ¨ç”»ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰è®¸å¤šå®ç”¨çš„å±æ€§å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰åŠ¨ç”»è¡Œä¸ºã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ Lottie JSON åŠ¨ç”» å’Œå¯¹åº”çš„ GIF åŠ¨ç”» çš„æ–‡ä»¶å¤§å°ã€‚

![lottie](lottie.png)

å¦‚æœè¿›è¡Œå¯¹æ¯”ï¼ŒJSON åŠ¨ç”»æ–‡ä»¶å¤§å°ä¸º 46.2 KBï¼Œè€Œå¯¹åº”çš„ GIF æ–‡ä»¶å¤§å°ä¸º 164.5 KBï¼Œå‡ ä¹æ˜¯ JSON çš„ 4 å€ã€‚æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ Optimized Lottie JSON è¿›ä¸€æ­¥å‡å°‘ JSON çš„å¤§å°ï¼Œä½†è¿™æ˜¯ä¸€é¡¹ä»˜è´¹è§£å†³æ–¹æ¡ˆã€‚å›æƒ³ä¹‹å‰æåˆ°çš„ä¸ºæ¯ä¸ªå¼•å¯¼æ­¥éª¤ä½¿ç”¨å•ç‹¬ GIF çš„æ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ”¹ç”¨ Lottieï¼Œå› ä¸ºå®ƒçš„æ–‡ä»¶æ›´å°ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿œç¨‹èµ„æºçš„ Lottie JSON æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°†å…¶æ‰“åŒ…åœ¨åº”ç”¨ä¸­ã€‚ä¸è¿‡ï¼Œä¸ºäº†ç¦»çº¿ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–çš„å·¥ä½œæ¥ç¡®ä¿å…¶å¯ç”¨æ€§ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚å¦‚æœä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„åŠ¨ç”»ï¼Œå¹¶é€šè¿‡è§¦å‘å™¨æ§åˆ¶å®ƒçš„çŠ¶æ€ä¼šæ€ä¹ˆæ ·ï¼Ÿä¾‹å¦‚ï¼Œç‚¹å‡»æŒ‰é’®åï¼ŒåŠ¨ç”»çš„çŠ¶æ€æ”¹å˜ä»¥æ˜¾ç¤ºä¸‹ä¸€æ­¥éª¤ã€‚

å‡è®¾æˆ‘ä»¬å¸Œæœ›æ›´æ”¹åŠ¨ç”»çš„å¤§å°æˆ–åšå…¶ä»–è‡ªå®šä¹‰è°ƒæ•´ï¼Œè¿™åœ¨ LottieFiles æä¾›çš„ç¼–è¾‘å™¨ä¸­æ— æ³•å®Œæˆã€‚ç›¸åï¼Œæˆ‘ä»¬å¿…é¡»å°†æ–‡ä»¶å¯¼å…¥åˆ° Adobe AfterEffectsï¼ˆAEï¼‰ ä¸­ï¼Œè¿›è¡Œè°ƒæ•´åé‡æ–°å¯¼å‡ºä¸º JSONã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ LottieFiles çš„ Web ç¼–è¾‘å™¨ä¸­è‡ªå®šä¹‰å±‚çš„é¢œè‰²ã€‚

ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½æœ‰ä½¿ç”¨ Adobe AE çš„ä¸“ä¸šæŠ€èƒ½ï¼Œä¹Ÿæœªå¿…éƒ½æœ‰åŠ¨ç”»å¸ˆå¯ä»¥å’¨è¯¢ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è‡ªå·±çš„ä¸ªäººé¡¹ç›®ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›èƒ½å¤Ÿç›´æ¥åœ¨ Web ç¼–è¾‘å™¨ä¸­è°ƒæ•´åŠ¨ç”»ï¼Œè€Œä¸éœ€è¦ä¾èµ–ä¸“ä¸šå·¥å…·ã€‚

å…³äº Lottie çš„æ€§èƒ½è¿˜æœ‰å…¶ä»–ç›¸å…³å› ç´ ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®ºã€‚

#### è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨å¼€å‘è€…å‹å¥½çš„å·¥å…·ï¼Œå®ç°æ›´é«˜çš„ FPS å’Œæ›´å°çš„æ–‡ä»¶å¤§å°ã€‚

æœ‰ä¸€ä¸ªæ–°å·¥å…·å« Riveï¼Œå®ƒæ—¨åœ¨æˆä¸º Lottie çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¸ä»…æä¾› Lottie çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜å¸¦æ¥äº†æ›´å¤šç‰¹æ€§ã€‚Rive æä¾›ä¸€ä¸ª Web ç¼–è¾‘å™¨ï¼Œå¯å®æ—¶è‡ªå®šä¹‰åŠ¨ç”»ã€‚è¯¥ç¼–è¾‘å™¨å…è®¸ç”¨æˆ·åˆ›å»ºäº¤äº’å¼åŠ¨ç”»ï¼Œè¿™äº›åŠ¨ç”»èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æä¾›çš„è¾“å…¥è¿›è¡Œäº¤äº’ã€‚åŸºäºè§¦å‘å™¨çš„åŠ¨ç”»åœ¨ç§»åŠ¨å¹³å°ä¸Šæ˜¯ä¸€å¤§ä¼˜åŠ¿ã€‚

è¿˜è®°å¾—æˆ‘ä»¬ä¸ºå¼•å¯¼æ­¥éª¤åŠ¨ç”»é‡‡ç”¨çš„æ–¹æ³•å—ï¼Ÿç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Rive åŠ¨ç”»ï¼Œå¯ä»¥åˆ©ç”¨å…¶çŠ¶æ€æœºã€è§¦å‘å™¨å’Œç”¨æˆ·è¾“å…¥åŠŸèƒ½ï¼Œé€šè¿‡ä¸€ä¸ªåŠ¨ç”»æ–‡ä»¶å®Œæˆå¼•å¯¼æ­¥éª¤çš„æ‰€æœ‰åŠ¨ç”»ã€‚è¿™æå¤§åœ°æ”¹å–„äº†å¼€å‘è€…ä½“éªŒï¼Œæ›´é‡è¦çš„æ˜¯ï¼šRive åŠ¨ç”»æ–‡ä»¶çš„å¤§å°æ¯” Lottie JSON å°å¾—å¤šã€‚æ­¤å¤–ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªå¼•å¯¼æ­¥éª¤ä¿ç•™ä¸åŒçš„æ–‡ä»¶ï¼Œä»è€Œä¸ºåº”ç”¨åŒ…èŠ‚çœäº†ä¸å°‘ KB çš„å¤§å°ã€‚

```javascript
import React, { useRef } from 'react';
import { Button, SafeAreaView, StyleSheet } from 'reactnative';
import Rive, { RiveRef } from 'rive-react-native';
const stateMachineOne = 'State Machine 1';
const App = () => {
 const riveRef = useRef<RiveRef>(null);
 const isRunning = useRef(false);
 const onIsRunning = () => {
 isRunning.current = !isRunning.current;
 riveRef.current?.setInputState(
 stateMachineOne,
 'isRunning',
 isRunning.current,
 );
 };
 const onSideKick = () => {
 riveRef.current?.fireState(stateMachineOne, 'sideKick');
 };
 return (
 <SafeAreaView>
 <Rive
 ref={riveRef}
 resourceName=''character''
 style={styles.character}
 stateMachineName={stateMachineOne}
 autoplay
 />
 <Button title=''Is Running'' onPress={onIsRunning} />
 <Button title=''SideKick'' onPress={onSideKick}
color=''#3e3e3e'' />
 </SafeAreaView>
 );
};
export default App;
const styles = StyleSheet.create({
 character: {
 width: 400,
 height: 400,
 },
});
```

å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæ·»åŠ å¤æ‚åŠ¨ç”»å¯¹å¼€å‘è€…éå¸¸å‹å¥½ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å¿«é€Ÿæ·»åŠ åŸºäºè§¦å‘å™¨æˆ–è¾“å…¥çš„åŠ¨ç”»ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„åªæ˜¯æœ‰å…³çŠ¶æ€æœºã€è¾“å…¥å’Œè§¦å‘å™¨çš„ä¿¡æ¯ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä½åŠ¨ç”»å¸ˆåœ¨ Rive Editor ä¸Šä¸ºé¡¹ç›®åˆ¶ä½œäº†ä¸€ä¸ªç²¾ç¾çš„åŠ¨ç”»ï¼Œæˆ‘ä»¬å¯ä»¥è¯·ä»–ä»¬æä¾›ç›¸å…³ä¿¡æ¯ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªè¡Œåœ¨ Web ç¼–è¾‘å™¨ä¸­æŸ¥æ‰¾è¿™äº›ä¿¡æ¯ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä» FPSã€CPU å’Œå†…å­˜æ¶ˆè€—çš„è§’åº¦è®¨è®ºæ€§èƒ½ã€‚æˆ‘ä»¬å°†å¯¹æ¯”ä¸º Lottie åˆ›å»ºçš„åŠ¨ç”»ä¸åŒæ ·ä¸º Rive åˆ›å»ºçš„åŠ¨ç”»ã€‚æ­¤æ¨æ–‡æ˜¾ç¤ºäº†é’ˆå¯¹ Web å¹³å°çš„åŸºå‡†æµ‹è¯•ã€‚æˆ‘ä»¬ä¼šæ‰©å±•è¿™ä¸€æ¯”è¾ƒï¼Œå°†åŒæ ·çš„åŠ¨ç”»ç”¨äºæˆ‘ä»¬çš„ React Native åº”ç”¨è¿›è¡Œæµ‹è¯•ã€‚

###### Lottie

![Lottie playing our animation at roughly17 FPS both on JS and UI threads](lottie1.png)

###### Rive

![Rive playing our animation at roughly 60 FPS both on JS and UI threads](rive.png)

æˆ‘ä»¬åœ¨ Sony Xperia Z3 è®¾å¤‡ä¸Šä½¿ç”¨ Android Profiler å’Œ React Native åº”ç”¨å†…ç½®çš„ Perf Monitor è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ã€‚ä¸ºäº†é¿å…å¼€å‘æ¨¡å¼ï¼ˆDEV modeï¼‰å¯¼è‡´ JS çº¿ç¨‹çš„èŠ‚æµï¼Œæˆ‘ä»¬ç¦ç”¨äº†å¼€å‘æ¨¡å¼ã€‚

ä¸¤å¼ å›¾ç‰‡æ˜¾ç¤ºäº†ç«ç®­ä¸Šæ–¹çš„å°çª—å£ï¼Œå…¶ä¸­åŒ…å« UI çº¿ç¨‹å’Œ JS çº¿ç¨‹çš„ FPS è¯¦ç»†ä¿¡æ¯ã€‚ç»“æœæ˜¾ç¤ºï¼ŒRive åŠ¨ç”»å‡ ä¹èƒ½ä»¥ 60FPS è¿è¡Œï¼Œè€Œ Lottie åŠ¨ç”»åªèƒ½è¾¾åˆ° 17FPSã€‚

æ¥ä¸‹æ¥å…³æ³¨å›¾ç‰‡å³ä¾§çš„å†…å­˜æ¶ˆè€—è¯¦ç»†è§†å›¾ã€‚å¯ä»¥çœ‹åˆ°ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š
1.	Javaï¼šåˆ†é…ç»™ Java æˆ– Kotlin ä»£ç çš„å†…å­˜ã€‚
2.	Nativeï¼šåˆ†é…ç»™ C æˆ– C++ ä»£ç çš„å†…å­˜ã€‚
3.	Graphicsï¼šç”¨äºå›¾å½¢ç¼“å†²åŒºé˜Ÿåˆ—ä»¥åœ¨å±å¹•ä¸Šæ˜¾ç¤ºåƒç´ çš„å†…å­˜ã€‚

å…·ä½“å†…å­˜æ¶ˆè€—å¯¹æ¯”å¦‚ä¸‹ï¼š
- Javaï¼šLottie ä½¿ç”¨çº¦ 23 MBï¼ŒRive ä½¿ç”¨çº¦ 12 MBã€‚
- Nativeï¼šLottie ä½¿ç”¨çº¦ 49 MBï¼ŒRive ä½¿ç”¨çº¦ 25 MBã€‚
- Graphicsï¼šLottie ä½¿ç”¨çº¦ 123 MBï¼ŒRive ä½¿ç”¨çº¦ 184 MBã€‚

æ€»å†…å­˜æ¶ˆè€—ï¼š
- Lottieï¼š246 MB
- Riveï¼š276 MB

![compare](rivecompare.png)

ç»“æœæ˜¾ç¤ºï¼ŒRive åœ¨é™¤ Graphics ä¹‹å¤–çš„æ‰€æœ‰æ–¹é¢éƒ½ä¼˜äº Lottieã€‚ç»ˆç«¯ç”¨æˆ·å¸Œæœ›åº”ç”¨èƒ½å¤Ÿä»¥ 60FPS è¿è¡Œï¼Œä»¥äº«å—æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚å¦‚æœå¿…é¡»åœ¨å†…å­˜æ¶ˆè€—å’Œ FPS ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¼šé€‰æ‹© FPSï¼Œå› ä¸ºå¤§éƒ¨åˆ†è®¾å¤‡çš„å†…å­˜éƒ½è¶³ä»¥æ»¡è¶³åº”ç”¨çš„éœ€æ±‚ã€‚

#### ä¼˜åŠ¿ï¼šç¼©çŸ­åŠŸèƒ½å¼€å‘è¿‡ç¨‹ä¸­çš„å›å½’å‘¨æœŸï¼Œæå‡ç”¨æˆ·æ»¡æ„åº¦ã€‚

å¦‚æœæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ²¡æœ‰çŠ¶æ€æœºçš„ä¸–ç•Œï¼Œå¼€å‘è€…éœ€è¦åœ¨ä»£ç ä¸­å®ç°åŠ¨ç”»é€»è¾‘ã€‚æ¯æ¬¡åŠ¨ç”»çš„äº¤äº’æ€§å‘ç”Ÿå˜åŒ–ï¼Œå¼€å‘è€…éƒ½éœ€è¦é‡æ–°ä¿®æ”¹ä»£ç ã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å¼€å‘è€…ä½“éªŒã€‚

Rive çš„çŠ¶æ€æœº è®©è®¾è®¡å¸ˆå¯ä»¥åƒç¼–å†™ä»£ç ä¸€æ ·æ€è€ƒï¼Œå¹¶ä¸ºåŠ¨ç”»è®¾è®¡å’Œç»„ç»‡çŠ¶æ€æœºï¼Œè¿™äº›åŠ¨ç”»åœ¨æ¥æ”¶åˆ°ç‰¹å®šè¾“å…¥åä¼šä½œå‡ºäº¤äº’ååº”ã€‚å¼€å‘è€…åªéœ€ä½¿ç”¨è¯¥åŠ¨ç”»å¹¶è§¦å‘ç›¸åº”çš„è¾“å…¥å³å¯å®Œæˆäº¤äº’çš„å®ç°ã€‚å¦‚æœéœ€è¦æ›´æ”¹åŠ¨ç”»ï¼Œåªéœ€æ›´æ¢åŠ¨ç”»æºæ–‡ä»¶ï¼Œè€Œæ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç é€»è¾‘ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚

çº¦ 18.7% çš„ç”¨æˆ·å› ä¸ºå­˜å‚¨é—®é¢˜è€Œå¸è½½åº”ç”¨ï¼Œè¿™ä¼šæŸå®³å…¬å¸çš„æŠ•èµ„å›æŠ¥ç‡ï¼ˆROIï¼‰ã€‚å¼€å‘è€…åº”å§‹ç»ˆå…³æ³¨å‡å°‘åº”ç”¨çš„åŒ…å¤§å°å’Œå­˜å‚¨ä½¿ç”¨é‡ã€‚åœ¨ Rive çš„ CEO å‘å¸ƒçš„ä¸€æ¡æ¨æ–‡ä¸­æåˆ°ï¼Œç›¸åŒçš„åŠ¨ç”»ï¼ŒLottie æ–‡ä»¶çº¦ 24.37 KBï¼Œè€Œ Rive æ–‡ä»¶ä»…çº¦ 2 KBã€‚

æ€»çš„æ¥è¯´ï¼Œæ¯èŠ‚çœçš„ 1 KB éƒ½æœ‰åŠ©äºå‡å°åº”ç”¨çš„å¤§å°ã€‚æˆ‘ä»¬å§‹ç»ˆå¸Œæœ›é€‰æ‹©ä¸€ä¸ªæ—¢èƒ½æä¾›æ›´å¥½çš„å¼€å‘è€…ä½“éªŒã€æ›´æ˜“ç”¨çš„ APIï¼Œåˆèƒ½ä¸ºç»ˆç«¯ç”¨æˆ·å¸¦æ¥æµç•…ä½“éªŒçš„åº“ã€‚

### ç¬¬å…«èŠ‚ ä½¿ç”¨ Skia åœ¨ç”»å¸ƒä¸Šé«˜æ•ˆç»˜åˆ¶

#### é—®é¢˜ï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•éš¾ä»¥å®ç°æ ¸å¿ƒåº”ç”¨è®¾è®¡ç†å¿µ

PO æˆ–è®¾è®¡å›¢é˜Ÿå¯èƒ½å¯¹äº§å“è®¾è®¡æœ‰ç€ä¸å¦¥åçš„æ„¿æ™¯ï¼Œæˆ–è€…è®¾æƒ³äº†ä¸€äº›éš¾ä»¥é€šè¿‡ Rive æˆ– React Native Reanimated åœ¨ä¸ç‰ºç‰²æ€§èƒ½æˆ–è·¨å¹³å°å…¼å®¹æ€§çš„æƒ…å†µä¸‹å®ç°çš„ç‰¹å®šåŠŸèƒ½ã€‚ä¹Ÿè®¸è¿™æ˜¯ä¸ºäº†è·ŸéšæŸç§è®¾è®¡è¶‹åŠ¿ï¼Ÿä¹Ÿè®¸åº”ç”¨å°†ä¼šåŒ…å«å¤§é‡å›¾è¡¨ï¼Œæˆ–è€…æ‹¥æœ‰ä¸€ä¸ªå›¾å½¢ä¸°å¯Œçš„ä»ªè¡¨æ¿ï¼Ÿåˆæˆ–è€…è®¡åˆ’æ‰“é€ ä¸€ä¸ªå…·æœ‰é«˜æ€§èƒ½ä¸”ç¾è§‚çš„å›¾åƒè¿‡æ¸¡æ•ˆæœçš„ç•Œé¢ï¼Ÿ

ä¾‹å¦‚ï¼Œç»„ä»¶é˜´å½±çš„æ¸²æŸ“æ–¹å¼åœ¨ iOS å’Œ Android ä¸Šæœ‰æ‰€ä¸åŒï¼›åœ¨ Android ä¸Šï¼Œé®ç½©ï¼ˆMaskingï¼‰å¯èƒ½è¿è¡Œè¾ƒæ…¢ï¼›æ¨¡ç³Šæ•ˆæœåœ¨ Android ä¸Šçš„æ”¯æŒä¹Ÿæœ‰é™ã€‚æ­¤å¤–ï¼Œå°½ç®¡ Rive æ˜¯ä¸€ä¸ªæ˜“ç”¨ä¸”é«˜æ€§èƒ½çš„å·¥å…·ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚å¯¹æ¨¡ç³Šã€å‘å…‰ã€é˜´å½±å’Œè·¯å¾„æ•ˆæœçš„æ”¯æŒæœ‰é™ã€‚

å½“é‡åˆ°æ­¤ç±»é—®é¢˜æ—¶ï¼Œæ‚¨å¯èƒ½å·²ç»åœ¨è„‘æµ·ä¸­æ„æƒ³äº†å¸Œæœ›åœ¨åº”ç”¨ä¸­å‘ˆç°çš„ç¡®åˆ‡ç”»é¢ã€‚è€Œå¯¹äºè¿™æ ·ç²¾å‡†çš„éœ€æ±‚ï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæä¾›æœ€å¤§æ¸²æŸ“ç®¡çº¿æ§åˆ¶çš„å·¥å…·ã€‚

#### è§£å†³æ–¹æ¡ˆï¼šæˆ–è®¸æ˜¯æ—¶å€™å°è¯•ä½¿ç”¨ Skia äº†

Skia æ˜¯ä¸€ä¸ªå¼€æºçš„ 2D å›¾å½¢åº“ï¼Œæä¾›è·¨å¤šç§ç¡¬ä»¶å’Œè½¯ä»¶å¹³å°é€šç”¨çš„ APIã€‚å®ƒæ˜¯ Google Chrome å’Œ ChromeOSã€Androidã€Flutterã€Mozilla Firefox åŠ Firefox OS ç­‰ä¼—å¤šäº§å“çš„å›¾å½¢å¼•æ“ã€‚

å¾—ç›Šäº Shopifyï¼ŒReact Native å¼€å‘è€…å¯ä»¥é€šè¿‡ @shopify/react-native-skia åº“ä½¿ç”¨å£°æ˜å¼çš„ Skia ç»˜å›¾åŠŸèƒ½ã€‚é€šè¿‡è¿™ä¸ªåº“ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶æ¸²æŸ“ï¼Œç”šè‡³ç²¾ç¡®åˆ°åƒç´ ã€‚å®ƒæ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ä»¥ä¼˜ç§€çš„æ€§èƒ½è¦†ç›–å‡ ä¹ä»»ä½•åœºæ™¯ã€‚

**React Native Skia** çš„ API ä½¿ç”¨ `<Canvas />` å…ƒç´ ï¼Œè¯¥å…ƒç´ æ˜¯åº”ç”¨è§†å›¾æ ‘ä¸­çš„æœ€åä¸€ä¸ªâ€œåŸç”Ÿâ€å…ƒç´ ï¼ŒåŒæ—¶ä½œä¸º Skia ç»˜å›¾çš„æ ¹èŠ‚ç‚¹ã€‚æ‰€æœ‰æ”¾å…¥å…¶ä¸­çš„ react-native-skia å­ç»„ä»¶éƒ½å°†ä½œä¸ºè¯¥åº“çš„å£°æ˜å¼ API ä½¿ç”¨ã€‚åœ¨åº•å±‚ï¼Œå®ƒä½¿ç”¨è‡ªå·±çš„ React æ¸²æŸ“å™¨è¿›è¡Œå·¥ä½œã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ `@shopify/react-native-skia` çš„ç¤ºä¾‹ï¼Œå®ƒåœ¨å›ºå®šå¤§å°çš„ Canvas ä¸Šæ¸²æŸ“äº†ä¸¤ä¸ªåœ†ï¼Œå¹¶å°†å®ƒä»¬æ··åˆåœ¨ä¸€èµ·ï¼š

```javascript
import React from ''react'';
import { useWindowDimensions } from 'react-native';
import { Canvas, Circle, Group, vec } from '@shopifyreactnative-skia';

const App = () => {
    const {width, height} = useWindowDimensions();
    const c = vec(width / 2, height / 2);
    const r = width * 0.33;
    return (
        <Canvas style={{ width, height }}>
            <Group blendMode='multiply'>
                <Circle cx={r} cy={c.y} r={r} color='cyan' />
                <Circle cx={width - r} cy={c.y} r={r} color='magenta' />
            </Group>
        </Canvas>
    );
};
```
![skia](skia.png)

ä»è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ° API çš„æ ¸å¿ƒå…ƒç´ ä¹‹ä¸€â€”â€”<Group /> ç»„ä»¶ã€‚<Group /> å¯ä»¥è¿›è¡Œæ·±åº¦åµŒå¥—ï¼Œå¹¶å¯¹å…¶å­å…ƒç´ åº”ç”¨ä»¥ä¸‹æ“ä½œï¼š
- ç»˜å›¾å±æ€§ (Paint properties) - ç±»ä¼¼äº SVGï¼Œåº”ç”¨äº Group çš„å±æ€§ï¼ˆå¦‚æ ·å¼ã€é¢œè‰²ï¼‰å°†è¢«å­å…ƒç´ ç»§æ‰¿ã€‚
- å˜æ¢ (Transformations) - ç±»ä¼¼äº React Native çš„ transform å±æ€§ï¼Œä½†æœ‰ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«ï¼šåœ¨ React Native ä¸­ï¼Œå˜æ¢çš„åŸç‚¹æ˜¯å¯¹è±¡çš„ä¸­å¿ƒï¼›è€Œåœ¨ Skia ä¸­ï¼Œå˜æ¢çš„åŸç‚¹æ˜¯å¯¹è±¡çš„å·¦ä¸Šè§’ã€‚
- è£å‰ª (Clipping) - clip å±æ€§å®šä¹‰äº†å­å…ƒç´ æ˜¾ç¤ºçš„åŒºåŸŸï¼Œè¶…å‡ºè¯¥åŒºåŸŸçš„éƒ¨åˆ†å°†è¢«éšè—ã€‚é€šè¿‡ invertClip å±æ€§å¯ä»¥åè½¬è£å‰ªåŒºåŸŸã€‚
- ä½å›¾æ•ˆæœ (Bitmap effects) - layer å±æ€§ä¼šåˆ›å»ºå­å…ƒç´ çš„ä½å›¾ç»˜åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ä¸ºä¸€ç»„å…ƒç´ æ„å»ºéœ€è¦åº”ç”¨çš„æ•ˆæœã€‚

ä¸ºäº†è®©å…¶ä¸­ä¸€ä¸ªåœ†å½¢ç§»åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Reanimated ä¸ Skia é…åˆå®ç°åŠ¨ç”»æ•ˆæœã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```javascript
import React from ''react'';
import { useWindowDimensions } from 'react-native';
import { Canvas, Circle, Group, vec } from ''@shopify/reactnative-skia'';
import {
Easing,
 cancelAnimation,
 useSharedValue,
 withRepeat,
 withTiming,
} from ''react-native-reanimated'';
export const useLoop = ({ duration }) => {
const progress = useSharedValue(0);
 useEffect(() => {
 progress.value = withRepeat(
 withTiming(1, { duration, easing: Easing.inOut(Easing.
ease) }),
 -1,
true
 );
return () => {
 cancelAnimation(progress);
 };
 }, [duration, progress]);
return progress;
};
const App = () => {
const ANIMATION_OFFSET = 50;
const {width, height} = useWindowDimensions();
const c = vec(width / 2, height / 2);
const r = width * 0.33;
const progress = useLoop({duration: 2000});
const circleTranslate = useDerivedValue(
 () => mix(progress.value, c.y + ANIMATION_OFFSET, c.y -
ANIMATION_OFFSET),
 [progress],
 );
return (
 <Canvas style={{ width, height }}>
 <Group>
 <Circle cx={r} cy={c.y} r={r} color=''cyan'' />
 <Circle cx={width - r} cy={circleTranslate} r={r}
color=''magenta'' />
 </Group>
 </Canvas>
 );
};
```

æ­£å¦‚æ‚¨å¯èƒ½æ³¨æ„åˆ°çš„ï¼ŒReact Native Skia å¯ä»¥ç›´æ¥æ¥å— Reanimated çš„å€¼ä½œä¸ºå±æ€§ï¼Œè¿™ä½¿å¾—ç”»å¸ƒç»˜å›¾ä¸åŠ¨ç”»çš„é›†æˆå˜å¾—æ— ç¼ï¼Œä»è€Œä¸ºç”¨æˆ·å¸¦æ¥ä»¤äººæ„‰æ‚¦çš„åŠ¨æ€ä½“éªŒã€‚

éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ<Canvas /> é»˜è®¤æ˜¯é€æ˜çš„ï¼Œè¿™éå¸¸é€‚åˆç”¨ä½œåˆ›å»ºä¸€äº›ç‚«é…·è‡ªå®šä¹‰ç»„ä»¶çš„åŸºç¡€ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨ <Canvas /> ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªå¸¦çº¢è‰²æ–¹å—çš„ <View />ã€‚

```javascript
const App = () => {
const ANIMATION_OFFSET = 50;
const {width, height} = useWindowDimensions();
const c = vec(width / 2, height / 2);
const r = width * 0.33;
const progress = useLoop({duration: 2000});
const circleTranslate = useDerivedValue(
 () => mix(progress.value, c.y + ANIMATION_OFFSET, c.y -
ANIMATION_OFFSET),
 [progress],
 );
return (
 <>
 <View
 style={{
 alignItems: 'center',
 justifyContent: 'center',
 ...StyleSheet.absoluteFill,
 }}>
 <View style={{height: 300, width: 300,
backgroundColor: 'red'}} />
 </View>
 <Canvas style={{flex: 1}}>
  <Group>
 <Circle cx={r} cy={c.y} r={r} color=''cyan'' />
 <Circle cx={width - r} cy={circleTranslate} r={r}
color=''magenta'' />
 </Group>
 </Canvas>
 </>
 );
};
```

éœ€è¦è®°ä½çš„æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ <Canvas /> æ¥åº”ç”¨æŸç§æ•ˆæœï¼Œè€Œè¯¥æ•ˆæœéœ€è¦å½±å“åº•å±‚çš„å›¾å±‚ï¼Œè¿™äº›æ›´æ”¹åªä¼šåº”ç”¨åˆ° <Canvas /> å†…çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œåƒ <Shadow /> è¿™æ ·çš„æ•ˆæœä¼šè¢«æ­£ç¡®æ¸²æŸ“ï¼Œä½† <Blur /> åªä¼šå¤„ç†ç”»å¸ƒå†…éƒ¨çš„å…ƒç´ ã€‚

å¦‚æœéœ€è¦æ¨¡ç³Šåº•å±‚å›¾å±‚ï¼Œæ‚¨éœ€è¦æ•è·è¯¥å›¾å±‚çš„å¿«ç…§ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨ makeImageFromView å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥æ”¶æ‚¨æƒ³æ•è·å¿«ç…§çš„ <View /> çš„å¼•ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å›¾åƒæ•°æ®çš„ Promiseï¼Œæ‚¨å¯ä»¥å°†è¯¥å›¾åƒç”¨ä½œ <Canvas /> çš„å›¾å±‚è¿›è¡Œå˜æ¢ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ·»åŠ æ¨¡ç³Šå¡ç‰‡çš„ç¤ºä¾‹ã€‚åœ¨ç»„ä»¶ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°æ¨¡ç³Šæ•ˆæœåªä¼šä½œç”¨äºåœ†å½¢ï¼Œè€Œä¹‹å‰ç¤ºä¾‹ä¸­çš„çº¢è‰²æ–¹å—ä»ç„¶æ˜¯æ¸…æ™°çš„ã€‚ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†æ•è·åº•å±‚è§†å›¾çš„å¿«ç…§å¹¶å°†å…¶ä½œä¸º <Canvas /> ä¸­çš„å›¾åƒå¼•ç”¨ã€‚

```javascript
const pd = PixelRatio.get();
const App = () => {
const {width, height} = useWindowDimensions();
const c = vec(width / 2, height / 2);
const r = width * 0.33;
const CARD_WIDTH = width - 60;
const CARD_HEIGHT = CARD_WIDTH * 0.5;
const ANIMATION_OFFSET = 50;
const clip = useMemo(
 () => rrect(rect(0, 0, CARD_WIDTH, CARD_HEIGHT), 20, 20),
 [CARD_HEIGHT, CARD_WIDTH],
 );
const ref = useRef<View>(null);
const progress = useLoop({duration: 2000});
const x = useSharedValue((width - CARD_WIDTH) / 2);
const y = useSharedValue((height - CARD_HEIGHT) / 2);
const transform = useDerivedValue(() => [
 {translateY: y.value},
 {translateX: x.value},
 ]);
const circleTranslate = useDerivedValue(
 () => mix(progress.value, c.y + ANIMATION_OFFSET, c.y -
ANIMATION_OFFSET),
 [progress],
 );
const [image, setImage] = useState<SkImage | null>(null);
 useEffect(() => {
 makeImageFromView(ref).then(snapshot =>
setImage(snapshot));
 }, []);
return (
 <>
 <View
 ref={ref}
 collapsable={false}
 style={{
 alignItems: 'center',
 justifyContent: 'center',
 ...StyleSheet.absoluteFill,
 }}>
 <View style={{height: 300, width: 300,
backgroundColor: 'red'}} />
 </View>
 <Canvas style={{flex: 1}}>
 <Image
image={image}
x={0}
y={0}
height={(image?.height() || 0) / pd}
width={(image?.width() || 0) / pd}
/>
 <Group>
 <Circle cx={r} cy={c.y} r={r} color=''cyan'' />
 <Circle cx={width - r} cy={circleTranslate} r={r}
color=''magenta'' />
</Group>
 <BackdropBlur blur={20} transform={transform}
clip={clip}>
 <Fill color=''rgba(0, 0, 0, 0.3)'' />
 </BackdropBlur>
 </Canvas>
 </>
 );
};
```

![skia2](skia2.png)

è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©æ‚¨åœ¨ä¸»åº”ç”¨å†…å®¹ä¹‹ä¸Šåˆ›å»ºå¤–è§‚ä¼˜ç¾çš„è·¨å¹³å°å åŠ æ•ˆæœï¼Œä½†éœ€è¦æå‰è§„åˆ’ï¼Œå› ä¸ºæ‚¨éœ€è¦å¯¹åº•å±‚è§†å›¾è®¾ç½®å¼•ç”¨ï¼ˆrefï¼‰ã€‚

React Native Skia çš„å¦ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½æ˜¯è·¯å¾„æ’å€¼ï¼ˆpath interpolationï¼‰ã€‚ç”±äºè®¡ç®—æ˜¯åœ¨åŸç”Ÿç«¯é€šè¿‡ C++ æ‰§è¡Œçš„ï¼Œå› æ­¤é€Ÿåº¦æå¿«ï¼Œä¸ä¼šé˜»å¡ JS çº¿ç¨‹ï¼Œä»è€Œç¡®ä¿ UI å¯¹ç”¨æˆ·æ“ä½œä¿æŒå“åº”ã€‚

åœ¨è¿™ä¸ªç®€å•ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ d3 åº“ç”Ÿæˆä¸¤ä¸ªåŸºäºæ•°æ®çš„æ›²çº¿è·¯å¾„ï¼Œç„¶ååœ¨ç”»å¸ƒä¸Šæ¸²æŸ“å®ƒä»¬ï¼Œå¹¶å®ç°å®ƒä»¬ä¹‹é—´çš„åŠ¨ç”»åˆ‡æ¢ã€‚

```javascript
import React, {useEffect} from 'react';
import {useSharedValue, withRepeat, withTiming} from 'reactnative-reanimated';
import {
Skia,
 usePathInterpolation,
Canvas,
Path,
} from '@shopify/react-native-skia';
import {curveBasis, line, scaleLinear, scaleTime} from 'd3';
const GRAPH_HEIGHT = 500;
const GRAPH_WIDTH = 350;
export const data1 = [
 {date: '2023-12-01T00:00:00.000Z', value: 110},
â€¦
 {date: '2023-12-15T00:00:00.000Z', value: 700},
];
export const data2 = [
 {date: '2023-12-01T00:00:00.000Z', value: 700},
â€¦
 {date: '2023-12-15T00:00:00.000Z', value: 400},
];
const makeGraph = data => {
const max = Math.max(...data.map(val => val.value));
const y = scaleLinear().domain([0, max]).range([GRAPH_
HEIGHT, 35]);
const x = scaleTime()
 .domain([new Date(2023, 12, 1), new Date(2023, 12, 15)])
 .range([10, GRAPH_WIDTH - 10]);
const curvedPath = line()
 .x(d => x(new Date(d.date)))
 .y(d => y(d.value))
 .curve(curveBasis)(data);
return Skia.Path.MakeFromSVGString(curvedPath!);
};
const App = () => {
const progress = useSharedValue(0);
const graphData = [makeGraph(data1), makeGraph(data2)];
 useEffect(() => {
 progress.value = withRepeat(withTiming(1, {duration:1000}), -1, true);
 }, [progress]);
const path = usePathInterpolation(
 progress,
 [0, 1],
 [graphData[0], graphData[1]],
 );
return (
 <Canvas style={{flex: 1}}>
 <Path
 path={path}
 style=''stroke''
 strokeWidth={5}
 strokeCap=''round''
 strokeJoin=''round''
 />
 </Canvas>
 );
};

```

![line](line.png)

usePathInterpolation é’©å­è´Ÿè´£åœ¨åˆ‡æ¢å›¾å½¢æ—¶æ­£ç¡®æ’å€¼è·¯å¾„å€¼ã€‚ä¸ºäº†è®©åŠ¨ç”»çœ‹èµ·æ¥å¹³æ»‘ï¼Œè·¯å¾„å¿…é¡»æ˜¯å¯æ’å€¼çš„ï¼Œå¹¶ä¸”éœ€è¦åŒ…å«ç›¸åŒæ•°é‡å’Œç±»å‹çš„å‘½ä»¤ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ’å€¼æ•ˆæœå¼‚å¸¸ï¼Œç”šè‡³å¯¼è‡´åº”ç”¨å´©æºƒã€‚

#### ä¼˜åŠ¿ï¼šè·å¾—å¼ºå¤§çš„å·¥å…·ï¼Œå¸®åŠ©æ‚¨åˆ›å»ºç‹¬ç‰¹ä¸”é«˜æ€§èƒ½çš„ç”¨æˆ·ç•Œé¢
æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½ã€é«˜åº¦çš„å¯å®šåˆ¶æ€§ä»¥åŠå‡ºè‰²çš„ APIï¼Œå¦‚æœæ‚¨çš„ç›®æ ‡æ˜¯åˆ›å»ºæ—¢åˆ›æ–°åˆå¿«é€Ÿçš„ç”¨æˆ·ç•Œé¢ï¼Œè¿™äº›å°†å¯¹æ‚¨å¤§æœ‰å¸®åŠ©ã€‚å†åŠ ä¸Šä¸å½“å‰å·¥å…·ï¼ˆå¦‚ react-native-gesture-handler å’Œ react-native-reanimatedï¼‰çš„è‰¯å¥½é›†æˆï¼Œå½“æ–°çš„ UI è®¾è®¡è¶‹åŠ¿å‡ºç°æ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªéå¸¸å‡ºè‰²çš„å·¥å…·ã€‚

æˆ‘ä»¬è¿™é‡Œåªè®¨è®ºäº† react-native-skia åŠŸèƒ½çš„ä¸€å°éƒ¨åˆ†ã€‚åƒå›¾åƒå¤„ç†æ»¤é•œã€é®ç½©ã€å¯Œæ–‡æœ¬æ¸²æŸ“ä»¥åŠå¼ºå¤§çš„ç€è‰²å™¨ç­‰åŠŸèƒ½ï¼Œéƒ½ä¸åœ¨æœ¬æŒ‡å—çš„èŒƒå›´ä¹‹å†…ã€‚

äº†è§£æ›´å¤šå…³äº React Native Skia åŠå…¶å¯èƒ½åº”ç”¨çš„æœ€ä½³é€”å¾„æ˜¯æŸ¥çœ‹ä»¥ä¸‹èµ„æºï¼š
- å®˜æ–¹æ–‡æ¡£
- William Candillon çš„ YouTube é¢‘é“
- Daniel Friyia çš„ YouTube é¢‘é“

### ç¬¬ä¹èŠ‚ ä¼˜åŒ–æ‚¨çš„åº”ç”¨ JavaScript åŒ…

#### é—®é¢˜ï¼šReact Native é»˜è®¤çš„ JS æ‰“åŒ…å·¥å…· Metro ç”Ÿæˆçš„åŒ…ä½“ç§¯è¿‡å¤§ã€‚

React Native åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†é€»è¾‘éƒ½ä½äºè¿è¡Œåœ¨ JavaScript å¼•æ“ï¼ˆå¦‚ JavaScriptCore æˆ– Hermesï¼‰ä¸­çš„ JavaScript ä»£ç ä¸­ã€‚ä½†åœ¨å°† JavaScript ä»£ç åŠ è½½åˆ°åº”ç”¨ä¹‹å‰ï¼Œéœ€è¦å…ˆå°†å…¶æ‰“åŒ…ï¼Œé€šå¸¸æ‰“åŒ…ä¸ºä¸€ä¸ªå•ç‹¬çš„ JS æ–‡ä»¶ï¼Œæœ‰æ—¶ä¹Ÿä¼šæ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ã€‚React Native æä¾›äº†ä¸€ä¸ªç”¨äº JavaScript ä»£ç æ‰“åŒ…çš„å†…ç½®å·¥å…·ï¼Œåä¸º Metroã€‚

#### è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å¤–éƒ¨æ’ä»¶æˆ–æ›¿æ¢ä¸ºç¬¬ä¸‰æ–¹æ‰“åŒ…å·¥å…·

åƒå…¶ä»–æ‰“åŒ…å·¥å…·ä¸€æ ·ï¼ŒMetro æ¥æ”¶ä¸€ä¸ªå…¥å£æ–‡ä»¶å’Œå„ç§é€‰é¡¹ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰ä»£ç åŠå…¶ä¾èµ–é¡¹çš„å•ä¸ª JavaScript æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ JavaScript bundleã€‚

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒMetro é€šè¿‡æœ¬åœ°ç¼“å­˜è½¬æ¢åçš„æ¨¡å—æ¥åŠ é€Ÿæ„å»ºã€‚Metro ä¼˜å…ˆè€ƒè™‘æ€§èƒ½è€Œä¸æ˜¯å¯é…ç½®æ€§ï¼Œè€Œå…¶ä»–æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Webpackï¼‰åˆ™æ°æ°ç›¸åã€‚å› æ­¤ï¼Œå½“æ‚¨çš„é¡¹ç›®éœ€è¦è‡ªå®šä¹‰åŠ è½½å™¨æˆ–ä½¿ç”¨ Webpack çš„å¹¿æ³›é…ç½®åŠŸèƒ½æ¥æ‰“åŒ… JavaScript ä»£ç å¹¶æ‹†åˆ†åº”ç”¨é€»è¾‘æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸€äº›é€‚ç”¨äº React Native åº”ç”¨çš„æ›¿ä»£æ‰“åŒ…å·¥å…·ï¼Œè¿™äº›å·¥å…·æä¾›äº†æ›´å¤šçš„é…ç½®é€‰é¡¹ã€‚

ä¸è¿‡ï¼Œæ¯ç§å·¥å…·éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿å’Œå±€é™æ€§ã€‚

###### [Re.Pack](https://re-pack.netlify.app/)

Re.Pack æ˜¯ä¸€ä¸ªåŸºäº Webpack çš„å·¥å…·åŒ…ï¼Œç”¨äºæ„å»º React Native åº”ç”¨ç¨‹åºã€‚å®ƒå®Œå…¨æ”¯æŒ Webpack ç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬åŠ è½½å™¨ã€æ’ä»¶ä»¥åŠç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€åˆ«åï¼ˆaliasesï¼‰ã€ä»£ç æ‹†åˆ†ï¼ˆcode splittingï¼‰ç­‰åŠŸèƒ½ã€‚Re.Pack æ˜¯ Haul çš„ç»§ä»»è€…ï¼Œå°½ç®¡ä¸¤è€…åœ¨æƒè¡¡ä¸åŒæ€§èƒ½éœ€æ±‚å’Œå¼€å‘è€…ä½“éªŒæ–¹é¢æœ‰æ‰€ä¸åŒï¼Œä½†ç›®æ ‡ä¸€è‡´ã€‚

Webpack çš„ç”Ÿæ€ç³»ç»Ÿå¯¹äºè®¸å¤šå¼€å‘è€…æ¥è¯´è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Web æ‰“åŒ…å·¥å…·ï¼ŒåŠ è½½å™¨å’Œæ’ä»¶èƒŒåçš„å¼ºå¤§ç¤¾åŒºæ˜¯å…¶ä¸»è¦ä¼˜åŠ¿ã€‚ç”±äºå…¶é«˜åº¦çš„å¯æ’æ‹”æ€§ï¼ŒWebpack æä¾›äº†æ”¹è¿›æ„å»ºæµç¨‹å’Œæ•´ä½“æ€§èƒ½çš„æ–¹æ³•ï¼Œè‡³å°‘åœ¨ä¸å†…éƒ¨æ¨¡å—å›¾æ„å»ºå’Œå¤„ç†æ— å…³çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š
- JavaScript å’Œ TypeScript çš„è½¬è¯‘ï¼ˆtranspilationï¼‰ã€‚
- ä»£ç å‹ç¼©ï¼ˆminificationï¼‰ã€‚

æ‚¨å¯ä»¥é€šè¿‡åŠ è½½å™¨æ›¿æ¢é»˜è®¤å·¥å…·ä»¥æå‡æ€§èƒ½ï¼Œä¾‹å¦‚ï¼š
- ä½¿ç”¨ esbuild-loader æ›¿æ¢ Babel è½¬è¯‘å™¨å’Œ Terser å‹ç¼©å·¥å…·ã€‚
- ä½¿ç”¨ swc-loader æ›¿ä»£ Babel æˆ–å…¶ä»–å·¥å…·ã€‚

Webpack çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯é€šè¿‡ Tree Shaking å‡å°‘æœ€ç»ˆæ‰“åŒ…ä»£ç çš„ä½“ç§¯ï¼Œä»è€Œæé«˜åº”ç”¨æ€§èƒ½ã€‚Tree Shaking æ˜¯ä¸€ç§æ­»ä»£ç æ¶ˆé™¤æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åˆ†ææºç ä¸­çš„ import å’Œ export è¯­å¥ï¼Œç¡®å®šåº”ç”¨å®é™…ä½¿ç”¨çš„ä»£ç ã€‚ç„¶åï¼ŒWebpack ä¼šä»æœ€ç»ˆæ‰“åŒ…æ–‡ä»¶ä¸­ç§»é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ä»£ç ï¼Œä»è€Œç”Ÿæˆæ›´å°ã€æ›´é«˜æ•ˆçš„åº”ç”¨ã€‚

è¦å®ç° Tree Shakingï¼Œä»£ç éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
- ä½¿ç”¨ ECMAScript æ¨¡å—ï¼ˆå³ import å’Œ export è¯­å¥ï¼‰ç¼–å†™ã€‚
- åœ¨ package.json æ–‡ä»¶ä¸­é€šè¿‡ sideEffects: false å£°æ˜ä»£ç æ— å‰¯ä½œç”¨ï¼Œç¡®ä¿ Webpack å¯ä»¥å®‰å…¨åœ°ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ã€‚

Webpack æ”¯æŒç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ï¼Œä½†ä» React Native 0.72 å¼€å§‹ï¼ŒMetro ä¹Ÿä»¥å®éªŒå½¢å¼æä¾›äº†å¯¹ç¬¦å·é“¾æ¥çš„æ”¯æŒã€‚ä» v0.73 å¼€å§‹ï¼Œè¯¥åŠŸèƒ½é»˜è®¤å¯ç”¨ã€‚ç¬¦å·é“¾æ¥åœ¨ monorepo ä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ä¸åŒçš„å·¥ä½œç©ºé—´ä¹‹é—´é«˜æ•ˆåœ°å…±äº« node_modulesï¼Œä»è€Œä¼˜åŒ–ä¾èµ–ç®¡ç†å’Œæ„å»ºæµç¨‹ã€‚

Re.Pack æä¾›äº†ä½¿ç”¨å¼‚æ­¥ä»£ç å—ï¼ˆasynchronous chunksï¼‰çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†åº”ç”¨çš„æ‰“åŒ…æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œå¹¶æ ¹æ®éœ€è¦æŒ‰éœ€åŠ è½½ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ JavaScriptCore å¼•æ“ï¼Œè¿™ç§æ–¹å¼å¯ä»¥æ˜¾è‘—æ”¹å–„åº”ç”¨çš„åˆå§‹åŠ è½½æ—¶é—´ã€‚

ç„¶è€Œï¼Œå½“ä¸ Hermes å¼•æ“ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¿™ç§ä¼˜åŒ–çš„æ•ˆæœå¯èƒ½ä¸é‚£ä¹ˆæ˜¾è‘—ï¼Œå› ä¸º Hermes ä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯ï¼ˆmemory mappingï¼‰ï¼Œå¯ä»¥ç›´æ¥ä» RAM åŠ¨æ€è¯»å–å­—èŠ‚ç ä¸­æ‰€éœ€çš„éƒ¨åˆ†ã€‚è¿™ç§æ‹†åˆ†å¯èƒ½ä¼šå¯¹ç›®æ ‡æ˜¯ä½ç«¯ Android è®¾å¤‡ã€ä¸”æ‰“åŒ…æ–‡ä»¶éå¸¸å¤§çš„åº”ç”¨äº§ç”Ÿä¸€å®šçš„ç§¯æå½±å“ã€‚

ä½†è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ›´æœ‰è¶£çš„ç‚¹ï¼Webpack å¹¶ä¸åœ¨æ„åŠ¨æ€ä»£ç å—æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿä¸­åŠ è½½è¿˜æ˜¯ä»è¿œç¨‹åŠ è½½ã€‚å› æ­¤ï¼Œå®ƒå…è®¸åŠ¨æ€åŠ è½½ä¸€å¼€å§‹å¹¶æœªåŒ…å«åœ¨åº”ç”¨æ‰“åŒ…æ–‡ä»¶ä¸­çš„ä»£ç â€”â€”å¯ä»¥ç›´æ¥ä»è¿œç¨‹æœåŠ¡å™¨æˆ– CDN è·å–ã€‚

è¿™ç§æ–¹å¼ä¸ä»…å¯ä»¥è¿›ä¸€æ­¥å‡å°‘åº”ç”¨çš„åˆå§‹åŠ è½½æ—¶é—´ï¼Œè¿˜èƒ½æ˜¾è‘—å‡å°åº”ç”¨çš„å®‰è£…åŒ…å¤§å°ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ä¸ºä»…é’ˆå¯¹åº”ç”¨æŸäº›éƒ¨åˆ†çš„ OTAï¼ˆOver-The-Airï¼‰æ›´æ–° æä¾›äº†å¯èƒ½æ€§ï¼Œä»è€Œæ›´åŠ é«˜æ•ˆåœ°ç®¡ç†å’Œå‘å¸ƒæ›´æ–°ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒWebpack 5 å¼•å…¥äº†å¯¹ æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰ æ¦‚å¿µçš„æ”¯æŒã€‚è¿™ä¸€åŠŸèƒ½å…è®¸å¯¹ä»£ç è¿›è¡Œåˆ†å—ï¼ˆcode-splittingï¼‰ï¼Œå¹¶åœ¨ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«è¿™äº›åˆ†å—ï¼ˆæˆ–ä»£ç å—ï¼‰ã€‚

æ¨¡å—è”é‚¦è¿˜å¸®åŠ©åˆ†å¸ƒå¼å’Œç‹¬ç«‹å›¢é˜Ÿæ›´å¿«åœ°äº¤ä»˜å¤§å‹åº”ç”¨ç¨‹åºã€‚å®ƒèµ‹äºˆå›¢é˜Ÿé€‰æ‹©ä»»æ„ UI æ¡†æ¶çš„è‡ªç”±ï¼Œå¹¶å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ï¼ŒåŒæ—¶ä»ç„¶ä½¿ç”¨ç›¸åŒçš„æ„å»ºåŸºç¡€è®¾æ–½ã€‚

Re.Pack 3 å¼€ç®±å³æ”¯æŒè¿™ä¸€åŠŸèƒ½ï¼Œå¹¶æä¾›äº†è®¸å¤šåœ¨è¿™äº›åœºæ™¯ä¸­éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚ä¾‹å¦‚ï¼ŒCodeSigningPlugin å¯ä»¥å¸®åŠ©æ‚¨éªŒè¯è¿œç¨‹åŠ è½½ä»£ç åŒ…çš„å®Œæ•´æ€§ï¼Œç¡®ä¿ä»£ç çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚

æ‰€æœ‰è¿™äº›é…ç½®å’Œçµæ´»æ€§éƒ½ä¼šå¯¹æ„å»ºè¿‡ç¨‹äº§ç”Ÿå½±å“ã€‚ç”±äºæ”¯æŒæ›´å¤šçš„è‡ªå®šä¹‰é€‰é¡¹ï¼ŒRe.Pack çš„æ„å»ºé€Ÿåº¦ä¼šæ¯”é»˜è®¤çš„ Metro æ‰“åŒ…å·¥å…·ç¨æ…¢ã€‚

ä» Metro åˆ‡æ¢åˆ° Re.Pack æ—¶ï¼Œå¯èƒ½éœ€è¦è§£å†³ä¸€äº›è§£æé”™è¯¯ï¼Œå› ä¸ºè¿™ä¸¤ç§æ‰“åŒ…å·¥å…·ä½¿ç”¨çš„ç®—æ³•ä¸åŒã€‚æ­¤å¤–ï¼Œä¸ Metro ç›¸æ¯”ï¼Œå¿«é€Ÿåˆ·æ–°ï¼ˆFast Refreshï¼‰ åŠŸèƒ½å­˜åœ¨ä¸€å®šé™åˆ¶ã€‚åœ¨ä½¿ç”¨ Webpack å’Œ Re.Pack æ—¶ï¼Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ å’Œ React Refresh åŠŸèƒ½æœ‰æ—¶å¯èƒ½éœ€è¦é‡æ–°åŠ è½½æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚

åœ¨ä½¿ç”¨ æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰ æ—¶ï¼ŒHMR åŠŸèƒ½ä»…é™äºåˆ·æ–°æ¥è‡ªä¸»æœºçš„éƒ¨åˆ†åº”ç”¨ç¨‹åºä»£ç ï¼Œè€Œå¯¹äºè¿œç¨‹æ¨¡å—ï¼Œåˆ™éœ€è¦è¿›è¡Œå®Œæ•´é‡è½½ã€‚

å¦‚æœæ‚¨ä¸éœ€è¦ Webpack ç”Ÿæ€ç³»ç»Ÿæä¾›çš„å¤§é‡è‡ªå®šä¹‰åŠŸèƒ½ï¼Œæˆ–è€…ä¸è®¡åˆ’æ‹†åˆ†åº”ç”¨ç¨‹åºä»£ç ï¼Œé‚£ä¹ˆæ‚¨å®Œå…¨å¯ä»¥ç»§ç»­ä½¿ç”¨é»˜è®¤çš„ Metro æ‰“åŒ…å·¥å…·ã€‚

###### [react-native-esbuild](https://github.com/oblador/react-native-esbuild)

react-native-esbuild çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å…¶æ„å»ºé€Ÿåº¦éå¸¸å¿«ã€‚å®ƒåœ¨åº•å±‚ä½¿ç”¨ ESBuild ä½œä¸ºæ‰“åŒ…å·¥å…·ï¼Œå³ä½¿æ²¡æœ‰ç¼“å­˜ï¼Œä¹Ÿèƒ½æ˜¾è‘—æå‡æ‰“åŒ…æ€§èƒ½ã€‚å®ƒè¿˜æä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚ Tree Shakingï¼Œå¹¶ä¸”ç›¸æ¯”äº Metro æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„å¯é…ç½®æ€§æ›´å¼ºã€‚ESBuild æ‹¥æœ‰è‡ªå·±çš„ç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ’ä»¶ã€è‡ªå®šä¹‰è½¬æ¢å™¨å’Œç¯å¢ƒå˜é‡æ”¯æŒã€‚è¯¥åŠ è½½å™¨é»˜è®¤å¯ç”¨äº .tsã€.tsxã€.mts å’Œ .cts æ–‡ä»¶ï¼Œè¿™æ„å‘³ç€ ESBuild å†…ç½®æ”¯æŒè§£æ TypeScript è¯­æ³•ï¼Œå¹¶èƒ½å¤Ÿç§»é™¤ç±»å‹æ³¨è§£ã€‚ç„¶è€Œï¼ŒESBuild ä¸è¿›è¡Œä»»ä½•ç±»å‹æ£€æŸ¥ï¼Œå› æ­¤æ‚¨ä»éœ€è¦åœ¨ ESBuild è¿è¡Œçš„åŒæ—¶å•ç‹¬è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚è¿™éƒ¨åˆ†å·¥ä½œéœ€è¦é¢å¤–çš„å·¥å…·å®Œæˆï¼Œè€Œä¸æ˜¯ ESBuild è‡ªèº«çš„åŠŸèƒ½ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œreact-native-esbuild å­˜åœ¨ä¸€äº›æƒè¡¡ç‚¹ï¼Œå› æ­¤åœ¨é€‰æ‹©æ‰“åŒ…å·¥å…·æ—¶ï¼Œå…³æ³¨è¿™äº›é™åˆ¶ä¹Ÿéå¸¸é‡è¦ã€‚

ä¸æ”¯æŒ Hermesï¼šHermes æ˜¯ React Native çš„é»˜è®¤ JavaScript å¼•æ“ï¼Œè€Œ react-native-esbuild æ— æ³•ä¸å…¶å…¼å®¹ã€‚æ²¡æœ‰å¿«é€Ÿåˆ·æ–°ï¼ˆFast Refreshï¼‰æˆ–çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHot Module Replacementï¼‰ï¼šä¸ Metro çš„åŠŸèƒ½ç›¸æ¯”ï¼Œè¿™äº›ç‰¹æ€§ç¼ºå¤±ã€‚ç„¶è€Œï¼Œè¯¥åº“æ”¯æŒ å®æ—¶é‡è½½ï¼ˆLive Reloadï¼‰ ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆã€‚

###### [rnx-kit](https://microsoft.github.io/rnx-kit/)

å¾®è½¯çš„ rnx-kit æ˜¯ Metro çš„ä¸€ä¸ªæœ‰è¶£æ‰©å±•ã€‚å®ƒæ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡ React Native å¼€å‘å·¥å…·çš„åŒ…ã€‚ä»å†å²ä¸Šçœ‹ï¼Œå®ƒåœ¨ Metro å®˜æ–¹æ”¯æŒä¹‹å‰ï¼Œå°±å®ç°äº†å¯¹ç¬¦å·é“¾æ¥çš„æ”¯æŒã€‚ä¸ Metro ç›¸æ¯”ï¼Œå¦ä¸€ä¸ªå¥½å¤„æ˜¯é€šè¿‡ä½¿ç”¨ ESBuild è¿›è¡Œæ‰“åŒ…ï¼Œå¯ä»¥å¼€ç®±å³ç”¨åœ°æä¾› tree shaking åŠŸèƒ½ã€‚

Metro æ”¯æŒ TypeScript æºæ–‡ä»¶ï¼Œä½†å®ƒä»…å°†å…¶è½¬è¯‘ä¸º JavaScriptã€‚Metro ä¸æ‰§è¡Œä»»ä½•ç±»å‹æ£€æŸ¥ã€‚è€Œ rnx-kit è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡é…ç½®ï¼Œæ‚¨å¯ä»¥å¯ç”¨ç±»å‹æ£€æŸ¥ã€‚TypeScript çš„è­¦å‘Šå’Œé”™è¯¯ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­ã€‚

æ­¤å¤–ï¼Œrnx-kit æä¾›äº†å¯¹é‡å¤ä¾èµ–å’Œå¾ªç¯ä¾èµ–çš„å¼€ç®±å³ç”¨æ£€æµ‹ã€‚è¿™å¯¹äºå‡å°‘åŒ…çš„å¤§å°ã€æå‡æ€§èƒ½ä»¥åŠé˜²æ­¢å¾ªç¯ä¾èµ–é—®é¢˜éå¸¸æœ‰ç”¨ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦è‡ªå·±è§£å†³è¿™äº›é—®é¢˜ï¼Œä½†å¹¸è¿çš„æ˜¯ï¼Œrnx-kit çš„æ–‡æ¡£æä¾›äº†æœ‰å…³å¦‚ä½•å¤„ç†å®ƒä»¬çš„ä¸€äº›è§è§£ã€‚

#### ä¼˜åŠ¿ï¼šå‘ç”¨æˆ·äº¤ä»˜æ›´å°‘çš„ JavaScriptã€‚èŠ‚çœå¼€å‘è€…æ‰“åŒ…æ—¶é—´ã€‚

æ‰“åŒ…å·¥å…·çš„é€‰æ‹©å–å†³äºå…·ä½“æƒ…å†µã€‚ä¸å¯èƒ½ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºé€‰æ‹©å”¯ä¸€çš„æ‰“åŒ…å·¥å…·ã€‚

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œåœ¨ React Native ä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨ Webpackï¼ˆé€šè¿‡ Re.Packï¼‰æˆ– ESBuildï¼ˆé€šè¿‡ rnx-kit æˆ– react-native-esbuildï¼‰å®ç° Tree Shakingã€‚ä¸åŒæ‰“åŒ…å·¥å…·å¯¹ Tree Shaking çš„å®ç°æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œå› æ­¤æ£€æŸ¥ä¸¤è€…çš„ç»“æœå¹¶ç¡®å®šæœ€é€‚åˆæ‚¨çš„åº”ç”¨æ˜¯å¯è¡Œçš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡ rnx-kit å®ç°çš„ Tree Shaking ä»å¤„äºæµ‹è¯•é˜¶æ®µï¼Œä½†ç›®å‰çš„ç»“æœç›¸å½“ä¹è§‚ã€‚é€šå¸¸å¯ä»¥é¢„æœŸåŒ…å¤§å°çš„å·®å¼‚åœ¨ 0% åˆ° 20% ä¹‹é—´ï¼Œåœ¨å°‘æ•°æƒ…å†µä¸‹ç”šè‡³å¯èƒ½è¶…è¿‡è¿™ä¸€èŒƒå›´ã€‚

å¦‚æœæ‚¨éœ€è¦ Webpack ç”Ÿæ€ç³»ç»Ÿæä¾›çš„è‡ªå®šä¹‰é€‰é¡¹ï¼Œæˆ–è€…è®¡åˆ’æ‹†åˆ†åº”ç”¨ç¨‹åºä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Re.Packï¼Œå› ä¸ºå®ƒæ‹¥æœ‰é«˜åº¦å¯å®šåˆ¶çš„é…ç½®ã€å¤§é‡ç¤¾åŒºç»´æŠ¤çš„åŠ è½½å™¨å’Œæ’ä»¶ã€‚å¦‚æœæ‚¨è§‰å¾— Webpack ç”Ÿæ€ç³»ç»Ÿè¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆæœ€å¥½ç»§ç»­ä½¿ç”¨é»˜è®¤çš„ Metro æ‰“åŒ…å·¥å…·ï¼Œæˆ–è€…å°è¯•å…¶ä»–æ‰“åŒ…å·¥å…·é€‰é¡¹ï¼Œå¦‚ react-native-esbuild å’Œ rnx-kitï¼Œå®ƒä»¬è¿˜æä¾›äº†ä¸€äº›ä¼˜åŠ¿ï¼Œä¾‹å¦‚å‡å°‘æ„å»ºæ—¶é—´ï¼ˆåº•å±‚ä½¿ç”¨ esbuildï¼‰ã€æ”¯æŒç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ä»¥åŠå¼€ç®±å³ç”¨çš„ TypeScript æ”¯æŒã€‚ä½†è¯·æ³¨æ„ï¼Œåœ¨é‡‡ç”¨æ–°çš„æ‰“åŒ…ç³»ç»Ÿæ—¶ï¼Œå§‹ç»ˆè¦å…³æ³¨å…¶å¸¦æ¥çš„æƒè¡¡ç‚¹ã€‚

